var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function s(t){try{h(n["throw"](t))}catch(e){a(e)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,s)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,a&&(o=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],a=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,a,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},GameagentView=function(t){function e(){var e=t.call(this)||this;return e.backdropView=new BackdropGame,e.darknessView=new BackgroundStart,e.butView=new ButStart,e.peopleView=new PeopleView,e}return __extends(e,t),e.prototype.init=function(){var t=this;this.addChild(this.backdropView),this.backdropView.start(),this.addChild(this.peopleView),setTimeout(function(){t.backdropView.end(),t.addChild(t.darknessView),t.addChild(t.butView),t.butView.anew(),t.butView.anewBut.addEventListener(egret.TouchEvent.TOUCH_TAP,t.startPlay,t)},5e3)},e.prototype.endBut=function(){console.log("暂停游戏"),this.backdropView.end()},e.prototype.startPlay=function(){var t=new ChangeEvent(ChangeEvent.CHANGE_EVENT);t.eventType=CloneView.CLONEVIEW,t.obj=this,SwitcherView.getInstance().dispatchEvent(t),this.removeChildren()},e.prototype.endView=function(){this.butView.anewBut.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.butView.anewBut.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startPlay,this)},e.GAMEAGENT_VIEW="gameagentview",e}(egret.Sprite);__reflect(GameagentView.prototype,"GameagentView");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ChangeEvent=function(t){function e(e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),t.call(this,e,i,n)||this}return __extends(e,t),e.CHANGE_EVENT="changeevent",e}(egret.Event);__reflect(ChangeEvent.prototype,"ChangeEvent");var SwitcherView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.gameagentView=new GameagentView,this.startView=new StartView,this.cloneView=new CloneView,this.addChild(this.startView),this.startView.init(),this.addEventListener(ChangeEvent.CHANGE_EVENT,this.onChangeScene,this)},e.prototype.start=function(){this.addEventListener(ChangeEvent.CHANGE_EVENT,this.onChangeScene,this)},e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.onChangeScene=function(t){switch(t.obj.endView(),this.removeChildren(),console.log(this),console.log(this.startView.parent),console.log(t.eventType),t.eventType){case StartView.START_VIEW:this.startView.init(),this.addChild(this.startView);break;case GameagentView.GAMEAGENT_VIEW:console.log("进入正式"),this.gameagentView=new GameagentView,this.gameagentView.init(),this.addChild(this.gameagentView);break;case CloneView.CLONEVIEW:console.log("进入克隆页面"),this.cloneView=new CloneView,this.cloneView.init(),this.addChild(this.cloneView)}},e}(egret.Sprite);__reflect(SwitcherView.prototype,"SwitcherView");var CloneView=function(t){function e(){var e=t.call(this)||this;return e.backdropView=new BackdropGame,e.darknessView=new BackgroundStart,e.butView=new ButStart,e.peopleView=new PeopleView,e}return __extends(e,t),e.prototype.init=function(){var t=this;this.addChild(this.backdropView),this.backdropView.start(),this.addChild(this.peopleView),setTimeout(function(){t.backdropView.end(),t.addChild(t.darknessView),t.addChild(t.butView),t.butView.anew(),t.butView.anewBut.addEventListener(egret.TouchEvent.TOUCH_TAP,t.startPlay,t)},5e3)},e.prototype.endBut=function(){console.log("暂停游戏"),this.backdropView.end()},e.prototype.startPlay=function(){var t=new ChangeEvent(ChangeEvent.CHANGE_EVENT);t.eventType=GameagentView.GAMEAGENT_VIEW,t.obj=this,SwitcherView.getInstance().dispatchEvent(t)},e.prototype.endView=function(){this.butView.anewBut.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.butView.anewBut.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startPlay,this)},e.CLONEVIEW="cloneview",e}(egret.Sprite);__reflect(CloneView.prototype,"CloneView");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){this.addChild(SwitcherView.getInstance())},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var StartView=function(t){function e(){var e=t.call(this)||this;return e.backdropView=new BackdropGame,e.darknessView=new BackgroundStart,e.butView=new ButStart,e}return __extends(e,t),e.prototype.init=function(){this.addChild(this.backdropView),this.addChild(this.darknessView),this.addChild(this.butView),this.butView.init(),this.butView.startBut.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startPlay,this)},e.prototype.endBut=function(){console.log("暂停游戏"),this.backdropView.end()},e.prototype.startPlay=function(){var t=new ChangeEvent(ChangeEvent.CHANGE_EVENT);t.eventType=GameagentView.GAMEAGENT_VIEW,t.obj=this,SwitcherView.getInstance().dispatchEvent(t)},e.prototype.endView=function(){console.log("执行"),this.removeChildren(),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startPlay,this)},e.START_VIEW="startview",e}(egret.Sprite);__reflect(StartView.prototype,"StartView");var BackdropGame=function(t){function e(){var e=t.call(this)||this;return e.imgAdd=3,e.timer=new egret.Timer(10,0),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.loading,e),e.timer.start(),e}return __extends(e,t),e.prototype.loading=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=new egret.Bitmap;t.texture=RES.getRes("bj_png"),this.textureHeight=t.texture.textureHeight,this.imgNum=Math.ceil(this.stageH/this.textureHeight)+1,this.bjArr=[];for(var e=0;e<this.imgNum;e++){var i=new egret.Bitmap;i.texture=RES.getRes("bj_png");var n=this.textureHeight*e-(this.textureHeight*this.imgNum-this.stageH);i.y=n,i.width=this.stageW,this.addChild(i),this.bjArr.push(i)}},e.prototype.start=function(){this.timer.addEventListener(egret.TimerEvent.TIMER,this.startRoll,this),this.timer.start()},e.prototype.startRoll=function(){for(var t=0;t<this.imgNum;t++){var e=this.bjArr[t];e.y+=this.imgAdd,e.y>this.stageH&&(e.y=this.bjArr[0].y-this.textureHeight,this.bjArr.pop(),this.bjArr.unshift(e))}},e.prototype.end=function(){this.timer.stop()},e}(egret.Sprite);__reflect(BackdropGame.prototype,"BackdropGame");var PeopleView=function(t){function e(){var e=t.call(this)||this;return e.isAdd=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){var t=RES.getRes("playerqixing_json"),e=RES.getRes("playerqixing_png"),i=new egret.MovieClipDataFactory(t,e);this.people=new egret.MovieClip(i.generateMovieClipData("benpao")),this.people.scaleX=1,this.people.scaleY=1,this.people.x=(this.stage.stageWidth-this.people.width)/2.8,this.people.y=300,this.addChild(this.people),console.log(this),this.people.gotoAndPlay("start",-1)},e}(egret.Sprite);__reflect(PeopleView.prototype,"PeopleView");var BackgroundStart=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){this.cover=new egret.Shape,this.cover.graphics.beginFill(0,.5),this.cover.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.cover.graphics.endFill(),this.addChild(this.cover)},e}(egret.Sprite);__reflect(BackgroundStart.prototype,"BackgroundStart");var ButStart=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.startBut=new egret.Bitmap,this.startBut.texture=RES.getRes("start_png"),this.startBut.width=this.startBut.texture.textureWidth/3,this.startBut.height=this.startBut.texture.textureHeight/3,this.startBut.x=(375-this.startBut.width)/2,this.startBut.y=400,this.startBut.touchEnabled=!0,this.addChild(this.startBut)},e.prototype.anew=function(){this.anewBut=new egret.Bitmap,this.anewBut.texture=RES.getRes("anew_png"),this.anewBut.width=this.anewBut.texture.textureWidth/3,this.anewBut.height=this.anewBut.texture.textureHeight/3,this.anewBut.x=(375-this.anewBut.width)/2,this.anewBut.y=400,this.anewBut.touchEnabled=!0,this.addChild(this.anewBut)},e}(egret.Sprite);__reflect(ButStart.prototype,"ButStart");