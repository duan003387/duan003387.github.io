System.register("chunks:///_virtual/AdditionItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AItemRenerer.ts"],(function(t){"use strict";var e,n,r,i;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,r=t._decorator},function(t){i=t.default}],execute:function(){var o;n._RF.push({},"fb8b0hKb45CGrTFyj9+rP2J","AdditionItem",void 0);var c=r.ccclass;r.property,t("AdditionItem",c("AdditionItem")(o=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.start=function(){},r.dataChanged=function(){},n}(i))||o);n._RF.pop()}}}));

System.register("chunks:///_virtual/AdEvent.ts",["cc"],(function(e){"use strict";var t,d;return{setters:[function(e){t=e.cclegacy,d=e._decorator}],execute:function(){e({AdEventType:void 0,AdType:void 0,LoadAdResult:void 0,ShowAdResult:void 0}),t._RF.push({},"01719WOQcVB7qL/5nPqR2k8","AdEvent",void 0);var i,n;d.ccclass,d.property;!function(e){e[e.Unkown=-1]="Unkown",e[e.Loaded=0]="Loaded",e[e.FailedToLoad=1]="FailedToLoad",e[e.Closed=2]="Closed",e[e.FakeClose=3]="FakeClose",e[e.LeavingApplication=4]="LeavingApplication",e[e.CompleteAndClosed=5]="CompleteAndClosed",e[e.RequestStarted=6]="RequestStarted",e[e.PlayStarted=7]="PlayStarted",e[e.PlayEnded=8]="PlayEnded",e[e.NewAddPulled=9]="NewAddPulled",e[e.PlayError=10]="PlayError",e[e.PermissionError=11]="PermissionError",e[e.PermissionGranted=12]="PermissionGranted",e[e.Inited=13]="Inited",e[e.InitFailed=14]="InitFailed"}(i||(i=e("AdEventType",{}))),function(e){e[e.Banner=0]="Banner",e[e.Interstitial=1]="Interstitial",e[e.Rewarded=2]="Rewarded",e[e.Feed=3]="Feed",e[e.FullScreen=4]="FullScreen"}(n||(n=e("AdType",{})));var o,s;e("ShowAdOptions",(function(){this.tag="",this.adType=null,this.timeout=0}));!function(e){e[e.Success=0]="Success",e[e.NotLoaded=1]="NotLoaded",e[e.Unkown=3]="Unkown",e[e.Unsupport=500]="Unsupport"}(o||(o=e("ShowAdResult",{}))),function(e){e[e.Success=0]="Success",e[e.NotInited=1]="NotInited",e[e.Unsupport=500]="Unsupport"}(s||(s=e("LoadAdResult",{})));e("AdEvent",function(){function e(){this.eventType=null,this.adType=n.Rewarded,this.sessionId=void 0,this.tag=void 0,this.adId=void 0,this.anlysis=void 0,this.adUnitId=void 0,this.errCode=void 0,this.errMsg=void 0}return e.prototype.AdEvent=function(e,t,d,i,n,o,s,r){void 0===n&&(n=""),void 0===o&&(o=""),void 0===s&&(s=0),void 0===r&&(r=""),this.tag=t,this.adId=i,this.eventType=e,this.sessionId=d,this.anlysis=n,this.adUnitId=o,this.errCode=s,this.errMsg=r},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/AItemRenerer.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,i,a,n,c,s,o,r,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,a=t.initializerDefineProperty,n=t.assertThisInitialized,c=t.createClass},function(t){s=t.cclegacy,o=t._decorator,r=t.Node,l=t.Component}],execute:function(){var h,u,d,f;s._RF.push({},"594c9hs+KRD1aCqF6BfhOw5","AItemRenerer",void 0);var p=o.ccclass,C=o.property;t("default",(h=C({displayName:"是否添加点击事件"}),p((f=e((d=function(t){function e(){for(var e,i=arguments.length,c=new Array(i),s=0;s<i;s++)c[s]=arguments[s];return e=t.call.apply(t,[this].concat(c))||this,a(e,"isClick",f,n(e)),e.callback=void 0,e.cbThis=void 0,e._data=void 0,e}i(e,t);var s=e.prototype;return s.dataChanged=function(){},s.refreshData=function(){this.dataChanged()},s.onDestroy=function(){this._data=null},s.setTouchCallback=function(t,e){this.callback=t,this.cbThis=e,this.node&&(this.node.hasEventListener(r.EventType.TOUCH_END)&&this.node.off(r.EventType.TOUCH_END,this.onClickCallback,this),this.node.on(r.EventType.TOUCH_END,this.onClickCallback,this))},s.onClickCallback=function(t){this.callback&&this.callback.call(this.cbThis,this.data)},c(e,[{key:"data",get:function(){return this._data},set:function(t){this._data=t,this.dataChanged()}}]),e}(l)).prototype,"isClick",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=d))||u));s._RF.pop()}}}));

System.register("chunks:///_virtual/AVirtualScrollView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AItemRenerer.ts"],(function(t){"use strict";var i,e,s,o,n,h,a,r,l,c,d,u,m,g,p,f,L;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,s=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){n=t.cclegacy,h=t._decorator,a=t.Prefab,r=t.Layout,l=t.Vec2,c=t.UITransform,d=t.Tween,u=t.tween,m=t.v3,g=t.easing,p=t.instantiate,f=t.ScrollView},function(t){L=t.default}],execute:function(){var C,y,v,I;n._RF.push({},"b88e75AU8BBlJaa0FYaBofw","AVirtualScrollView",void 0);var T=h.ccclass,x=h.property;t("default",(C=x({type:a,serializable:!0,displayName:"渲染预制体"}),T((I=i((v=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),h=0;h<e;h++)n[h]=arguments[h];return i=t.call.apply(t,[this].concat(n))||this,s(i,"itemRenderer",I,o(i)),i.callback=void 0,i.cbThis=void 0,i.verticalCount=void 0,i.horizontalCount=void 0,i.itemW=void 0,i.itemH=void 0,i.interval=void 0,i.itemPool=void 0,i.itemList=void 0,i.itemRendererList=void 0,i.dataList=void 0,i.startPos=void 0,i.contentLayout=void 0,i.oldIdx=0,i.newIdx=0,i}e(i,t);var n=i.prototype;return n.onLoad=function(){this.itemList=[],this.itemPool=[],this.itemRendererList=[],this.contentLayout=this.content.getComponent(r),this.contentLayout.enabled=!1;var t=this.itemRenderer.data;this.startPos=new l(t.getComponent(c).width*t.getComponent(c).anchorX+this.contentLayout.paddingLeft,-(t.getComponent(c).height*t.getComponent(c).anchorY+this.contentLayout.paddingTop)),this.itemW=t.getComponent(c).width+this.contentLayout.spacingX,this.itemH=t.getComponent(c).height+this.contentLayout.spacingY,this.horizontalCount=Math.ceil(this.node.getComponent(c).width/this.itemW)+1,this.verticalCount=Math.ceil(this.node.getComponent(c).height/this.itemH)+1,this.contentLayout.type==r.Type.GRID&&(this.contentLayout.startAxis==r.AxisDirection.HORIZONTAL?this.horizontalCount=Math.floor(this.node.getComponent(c).width/this.itemW):this.verticalCount=Math.floor(this.node.getComponent(c).height/this.itemH))},n.onDestroy=function(){this.dataList=null,this.itemList=null,this.itemRendererList=null,clearInterval(this.interval)},n._moveContent=function(i){d.stopAllByTarget(this.content),this.isAutoScrolling()||this.isScrolling()||(this.getScrollOffset().y>this.getMaxScrollOffset().y&&u(this.content).to(Math.abs(this.getScrollOffset().y-this.getMaxScrollOffset().y)/2e3,{position:m(this.getMaxScrollOffset().x,this.getMaxScrollOffset().y,0)},{easing:g.sineOut}).start(),this.getScrollOffset().y<0&&u(this.content).to(Math.abs(this.getScrollOffset().y-0)/2e3,{position:m()},{easing:g.sineOut}).start()),t.prototype._moveContent.call(this,i),++this.oldIdx},n.setTouchItemCallback=function(t,i){this.callback=t,this.cbThis=i},n.onItemTap=function(t){this.callback&&this.callback.call(this.cbThis,t)},n.refreshData=function(t){Array.isArray(t)?this.dataList=t:this.dataList=[t],this.interval&&clearInterval(this.interval),this.addItem(),this.refreshContentSize(),this.interval=setInterval(this.refreshItem.bind(this),50)},n.addItem=function(){var t=0;switch(this.contentLayout.type){case r.Type.HORIZONTAL:t=this.horizontalCount;break;case r.Type.VERTICAL:t=this.verticalCount;break;case r.Type.GRID:t=this.horizontalCount*this.verticalCount}t=Math.min(t,this.dataList.length);var i=this.itemList.length;if(i<t)for(var e=null,s=i;s<t;s++){var o=this.itemPool.length>0?this.itemPool.shift():p(this.itemRenderer);this.content.addChild(o),this.itemList.push(o),e=o.getComponent(L),this.itemRendererList.push(e),e.isClick&&e.setTouchCallback(this.onItemTap,this)}else for(var n,h=this.content.children.length;h>t;)n=this.itemList[h-1],this.content.removeChild(n),this.itemList.splice(h-1,1),this.itemRendererList.splice(h-1,1),this.itemPool.push(n),h=this.content.children.length},n.refreshContentSize=function(){var t=this.contentLayout,i=this.dataList.length;switch(this.contentLayout.type){case r.Type.VERTICAL:this.content.getComponent(c).height=t.paddingTop+i*this.itemH+t.paddingBottom;break;case r.Type.HORIZONTAL:this.content.getComponent(c).width=t.paddingLeft+i*this.itemW+t.paddingRight;break;case r.Type.GRID:this.contentLayout.startAxis==r.AxisDirection.HORIZONTAL?this.content.getComponent(c).height=t.paddingTop+Math.ceil(i/this.horizontalCount)*this.itemH+t.paddingBottom:this.contentLayout.startAxis==r.AxisDirection.VERTICAL&&(this.content.getComponent(c).width=t.paddingLeft+Math.ceil(i/this.verticalCount)*this.itemW+t.paddingRight)}},n.refreshItem=function(){if(this.oldIdx!=this.newIdx)switch(this.newIdx=this.oldIdx,this.contentLayout.type){case r.Type.HORIZONTAL:this.refreshHorizontal();break;case r.Type.VERTICAL:this.refreshVertical();break;case r.Type.GRID:this.refreshGrid()}},n.refreshHorizontal=function(){var t=Math.floor(Math.abs(this.getContentPosition().x)/this.itemW);(t<0||this.getContentPosition().x>0)&&(t=0);var i=t+this.horizontalCount;i>this.dataList.length&&(i=this.dataList.length,t=Math.max(i-this.horizontalCount,0));for(var e,s,o=0,n=this.itemList.length,h=0;h<n;h++)s=(t+h)%n,e=this.itemList[s],o=this.startPos.x+(t+h)*this.itemW,e.setPosition(o,e.position.y),this.itemRendererList[s].data=this.dataList[t+h]},n.refreshVertical=function(){var t=Math.floor(Math.abs(this.getContentPosition().y)/this.itemH);(t<0||this.getContentPosition().y<0)&&(t=0);var i=t+this.verticalCount;i>this.dataList.length&&(i=this.dataList.length,t=Math.max(i-this.verticalCount,0));for(var e,s,o=0,n=this.itemList.length,h=0;h<n;h++)s=(t+h)%n,e=this.itemList[s],o=this.startPos.y+-(t+h)*this.itemH,e.setPosition(e.position.x,o),this.itemRendererList[s].data=this.dataList[t+h]},n.refreshGrid=function(){var t=this.contentLayout.startAxis==r.AxisDirection.VERTICAL,i=Math.floor(Math.abs(this.getContentPosition().y)/this.itemH)*this.horizontalCount;t?(i=Math.floor(Math.abs(this.getContentPosition().x)/this.itemW)*this.verticalCount,this.getContentPosition().x>0&&(i=0)):this.getContentPosition().y<0&&(i=0),i<0&&(i=0);var e=i+this.horizontalCount*this.verticalCount;e>this.dataList.length&&(e=this.dataList.length,i=Math.max(e-this.horizontalCount*this.verticalCount,0));for(var s,o,n=0,h=0,a=this.itemList.length,l=0;l<a;l++)o=(i+l)%a,s=this.itemList[o],t?(n=this.startPos.x+Math.floor((i+l)/this.verticalCount)*this.itemW,h=this.startPos.y+-(i+l)%this.verticalCount*this.itemH):(n=this.startPos.x+(i+l)%this.horizontalCount*this.itemW,h=this.startPos.y+-Math.floor((i+l)/this.horizontalCount)*this.itemH),s.setPosition(n,h),this.itemRendererList[o].data=this.dataList[i+l]},i}(f)).prototype,"itemRenderer",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=v))||y));n._RF.pop()}}}));

System.register("chunks:///_virtual/BaseUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var t,o,n,i,a,r,s,p,c,l,u,y,m,f,d,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.createClass},function(e){r=e.cclegacy,s=e._decorator,p=e.Node,c=e.UIOpacity,l=e.tween,u=e.v3,y=e.easing,m=e.isValid,f=e.resources,d=e.js,h=e.Component}],execute:function(){var P,v,_,g,T,U,I,M;e({LayerType:void 0,PopType:void 0}),r._RF.push({},"f1dd1nPGrpMJ7om/7VDnMTW","BaseUI",void 0),function(e){e[e.No=0]="No",e[e.PopUp=1]="PopUp",e[e.max=2]="max"}(I||(I=e("PopType",{}))),function(e){e[e.normal=0]="normal",e[e.popup=1]="popup",e[e.topMost=2]="topMost",e[e.max=3]="max"}(M||(M=e("LayerType",{})));var b=s.ccclass,x=s.property;e("BaseUI",(P=b("BaseUI"),v=x({type:p,visible:function(){return this.m_PopType!==I.max}}),P(((U=function(e){function t(){for(var t,o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,n(t,"m_PopPart",T,i(t)),t.m_layerType=M.normal,t.m_PopType=I.max,t.resMap=new Map,t}o(t,e),t.getUrl=function(){return"ui/"+this.prefabUrl};var r=t.prototype;return r.onDestroy=function(){this.resMap.forEach((function(e){e.decRef(),e=null}))},r.OnMsg=function(e){},r.onShow=function(){if(this.node.active=!0,this.node.setSiblingIndex(1e4),this.m_PopType!==I.No){var e=this.node.getComponent(c);e&&l(e).set({opacity:0}).to(.2,{opacity:255}).start()}null!=this.m_PopPart&&this.m_PopType!=I.max&&this.m_PopType==I.PopUp&&l(this.m_PopPart).set({scale:u(.7,.7,.7)}).to(.4,{scale:u(1,1,1)},{easing:y.backOut}).start()},r.onHide=function(e){var t=this;return void 0===e&&(e=!1),new Promise((function(o){if(t.m_PopType!==I.No){var n=t.node.getComponent(c);n&&l(n).to(.15,{opacity:0}).call((function(){n.opacity=255,t.hideImp(e),o()})).start()}else t.hideImp(e),o()}))},r.hideImp=function(e){e?this.node&&m(this.node)&&this.node.destroy():this.node.active=!1},r.loadRes=function(e,t,o){var n=this;f.load(e,t,(function(i,a){n.resMap.has(e+d.getClassName(t))||(n.resMap.set(e+d.getClassName(t),a),a.addRef()),o(i,a)}))},a(t,[{key:"layerType",get:function(){return this.m_layerType}}]),t}(h)).prefabUrl="BaseUI",T=t((g=U).prototype,"m_PopPart",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=g))||_));r._RF.pop()}}}));

System.register("chunks:///_virtual/BattleArrow.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventDispatcher.ts","./EventType.ts","./GameController.ts","./GameData.ts","./GameSettings.ts","./GuideManager.ts","./ReadTablesManager.ts","./Utils.ts","./CameraCtrl.ts","./NodeLayers.ts"],(function(t){"use strict";var e,n,i,r,a,o,s,l,u,c,p,f,g,h,d,m,v,y,b,w,T,E,A,x,C,G,_,S,B,L,R,D;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){a=t.cclegacy,o=t._decorator,s=t.Node,l=t.CCFloat,u=t.Label,c=t.tween,p=t.easing,f=t.Tween,g=t.v2,h=t.math,d=t.v3,m=t.log,v=t.ParticleSystem,y=t.find,b=t.UITransform,w=t.Component},function(t){T=t.EventDispatcher},function(t){E=t.EventType},function(t){A=t.GameController},function(t){x=t.GameData},function(t){C=t.GameSettings},function(t){G=t.GuideManager,_=t.GuideStage},function(t){S=t.ReadTablesManager},function(t){B=t.ScriptLocalization,L=t.UIUtils},function(t){R=t.CameraCtrl},function(t){D=t.NodeLayers}],execute:function(){var P,I,N,U,z,O,M,F,W,H,k,Q,X,j,V,Z,q;a._RF.push({},"9167dgFhuVNhrOPo5tQ/fQw","BattleArrow",void 0);var J=o.ccclass,K=o.property;t("BattleArrow",(P=J("BattleArrow"),I=K(s),N=K({type:l,displayName:"箭头可转动的最大角度"}),U=K(u),z=K(u),O=K(s),M=K(s),F=K(s),P((k=e((H=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a))||this,i(e,"arrow",k,r(e)),i(e,"maxAngle",Q,r(e)),i(e,"text_3dpower",X,r(e)),i(e,"missText",j,r(e)),i(e,"MagicBuffBlue",V,r(e)),i(e,"StarExplosionBlue",Z,r(e)),i(e,"turntable",q,r(e)),e}n(e,t);var a=e.prototype;return a.onLoad=function(){T.ins.addEventListener(E.POWER_CHANGE,this.onPowerChange,this),T.ins.addEventListener(E.NEXT_GUIDE_STAGE,this.UpdateGuideStage,this,!0)},a.onDestroy=function(){T.ins.removeEventListener(E.POWER_CHANGE,this.onPowerChange,this),T.ins.removeEventListener(E.NEXT_GUIDE_STAGE,this.UpdateGuideStage,this)},a.onEnable=function(){this.text_3dpower.node.active=this.turntable.active=this.arrow.active=!0,this.missText.node.active=!1;var t=C.ins.arrowAnimTime;this.arrow.angle=Math.random()>.5?this.maxAngle:-this.maxAngle,c(this.arrow).repeatForever(c().to(t,{angle:-this.maxAngle},{easing:p.sineInOut}).to(t,{angle:this.maxAngle},{easing:p.sineInOut})).start()},a.onDisable=function(){f.stopAllByTarget(this.arrow)},a.getCurAngle=function(){return f.stopAllByTarget(this.arrow),this.arrow.angle},a.getResultDirection=function(){return f.stopAllByTarget(this.arrow),g(0,1).rotate(h.toRadian(this.getCurAngle()))},a.startTextAnim=function(t){var e=this;this.text_3dpower.node.active=this.turntable.active=this.arrow.active=!1,this.missText.node.active=!0,this.missText.string=""+x.ins.ARROW_TIP[t];var n=this.missText.node.position;0===t||1===t?(this.playEffect(this.MagicBuffBlue),this.playEffect(this.StarExplosionBlue)):this.playEffect(this.StarExplosionBlue),c(this.missText.node).set({scale:d(0,0,0),position:d(n.x,n.y,100)}).to(.5,{position:d(n.x,n.y,400),scale:d(2.5,2.5,2.5)},{easing:p.backOut}).delay(1).set({position:d(n.x,n.y,100)}).call((function(){e.node.active=!1})).start()},a.onPowerChange=function(){if(m("战力改变"),A.ins.battleFieldInited){var t=x.ins.CountPower();this.text_3dpower.string="战力:"+t}},a.playEffect=function(t){t.getComponent(v).play(),t.getComponentsInChildren(v).forEach((function(t){t.play()}))},a.UpdateGuideStage=function(){var t=0;if(G.ins.CurrStage===_.ARROW_TIP||G.ins.CurrStage===_.BATTLE_BUTTON){if(t=D.Guide_Game,G.ins.CurrStage===_.ARROW_TIP){var e=S.ins.getLocalizationStr(B.D_Guide_Zero),n=R.instance.camera.convertToUINode(this.turntable.worldPosition,y("Canvas"));y("Canvas").getComponent(b).convertToWorldSpaceAR(n,n),n.add(d(60,180,0)),G.ins.startCurStageGuide(1,null,e,n),L.changeNodeLayer(this.turntable,t)}}else t=D.DEFAULT,L.changeNodeLayer(this.turntable,t)},e}(w)).prototype,"arrow",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(H.prototype,"maxAngle",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),X=e(H.prototype,"text_3dpower",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(H.prototype,"missText",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(H.prototype,"MagicBuffBlue",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(H.prototype,"StarExplosionBlue",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(H.prototype,"turntable",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=H))||W));a._RF.pop()}}}));

System.register("chunks:///_virtual/BuffUtil.ts",["cc"],(function(T){"use strict";var A;return{setters:[function(T){A=T.cclegacy}],execute:function(){A._RF.push({},"3d9eauwOfNJyKsndxlFLXng","BuffUtil",void 0);var _=T("BuffUtil",function(){function T(){}return T.ApplyBuff=function(T,A,_){var E=A[_];return E>0?T[_]*(1+.01*E):T[_]},T.ApplyDebuff=function(T,A,_){var E=A[_];return E>0?T[_]*(1-.01*E):T[_]},T}());_.ATTR_NAME_HP="hp",_.ATTR_NAME_ATTACK="at",_.ATTR_NAME_ATTACK_SPEED="atspeed",_.ATTR_NAME_ATTACK_RANGE="attrange",_.ATTR_NAME_SPEED="speed",_.ATTR_NAME_DAMAGE_RANGE="attscope",_.ATTR_HP=0,_.ATTR_ATTACK=1,_.ATTR_ATTACK_SPEED=2,_.ATTR_ATTACK_RANGE=3,_.ATTR_SPEED=4,_.ATTR_DMG_RANGE=5,_.ATTR_COUNT=6,_.ATTR_NAME_TO_CODE=new Map([[_.ATTR_NAME_HP,_.ATTR_HP],[_.ATTR_NAME_ATTACK,_.ATTR_ATTACK],[_.ATTR_NAME_ATTACK_SPEED,_.ATTR_ATTACK_SPEED],[_.ATTR_NAME_ATTACK_RANGE,_.ATTR_ATTACK_RANGE],[_.ATTR_NAME_SPEED,_.ATTR_SPEED],[_.ATTR_NAME_DAMAGE_RANGE,_.ATTR_DMG_RANGE]]),A._RF.pop()}}}));

System.register("chunks:///_virtual/CameraCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameController.ts","./EventDispatcher.ts","./EventType.ts"],(function(t){"use strict";var e,i,o,s,n,r,a,h,u,c,l,p,d,f,g,m,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){n=t.cclegacy,r=t._decorator,a=t.v3,h=t.Camera,u=t.Vec3,c=t.find,l=t.math,p=t.lerp,d=t.Component},function(t){f=t.GameController,g=t.GameState},function(t){m=t.EventDispatcher},function(t){v=t.EventType}],execute:function(){var C,P,T,b,y,E;n._RF.push({},"8636bqJMbRESohMLxyjHJAi","CameraCtrl",void 0);var A=r.ccclass,D=r.property;a(),t("CameraCtrl",(C=A("CameraCtrl"),P=D(h),C(((E=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).speedFactor=.04,e._tempVec3=new u,e.isFollow=!0,e.lookAtOffset=a(),e.cube=null,e.targetPos=a(),e.targetHeight=55,e.MaxtHeight=65,e.camera=null,e.cubeDefaultPos=a(),o(e,"guideCamera",y,s(e)),e.getBoundTime=1,e.lerpRatio=1,e}i(e,t);var n=e.prototype;return n.setTargetPos=function(t){u.add(this.targetPos,t,this.lookAtOffset)},n.onLoad=function(){e.instance=this,this.cube=c("Cube"),this.camera=this.node.getComponent(h),this.cubeDefaultPos.set(this.cube.position.x,0,this.cube.position.z),this.lookAtOffset=this.node.position.clone().subtract(this.cubeDefaultPos).multiplyScalar(1),this.targetPos.set(this.node.position),this.guideCamera.node.setPosition(this.node.position),this.guideCamera.node.eulerAngles=this.node.eulerAngles.clone(),this.guideCamera.fov=this.camera.fov,m.ins.addEventListener(v.CONTINUE_BATTLE,this.resetTargetPos,this)},n.onDestroy=function(){m.ins.removeEventListener(v.CONTINUE_BATTLE,this.resetTargetPos,this)},n.start=function(){},n.getBound=function(){var t=999999999999,e=-999999999999,i=999999999999,o=-999999999999;f.ins.steerEntities.forEach((function(s){s.node.position.x>e&&(e=s.node.position.x),s.node.position.x<t&&(t=s.node.position.x),s.node.position.z>o&&(o=s.node.position.z),s.node.position.z<i&&(i=s.node.position.z)}));var s=e-t-22;this.targetPos.set((t+e)/2,0,(i+o)/2).add(this.lookAtOffset),this.targetHeight=Math.min(55+s,this.MaxtHeight)},n.update=function(t){if(this.isFollow){if(f.ins.curtState===g.DragSoldier)this.targetHeight=30;else if(f.ins.curtState===g.Ing)this.getBoundTime+=t,this.getBoundTime>=.3&&(this.getBoundTime=0,this.getBound());else{if(f.ins.curtState===g.Over)return;f.ins.curtState===g.StandBy&&this.resetTargetPos()}if(Math.abs(this.targetHeight-this.camera.fov)>l.EPSILON){var e=p(this.camera.fov,this.targetHeight,t*this.lerpRatio);this.camera.fov=e}u.lerp(this._tempVec3,this.node.position,this.targetPos,t*this.lerpRatio),this.node.position=this._tempVec3}},n.resetTargetPos=function(){this.targetPos.set(this.cubeDefaultPos).add(this.lookAtOffset),this.targetHeight=55,this.isFollow=!0},n.checkIsReset=function(){return this.node.position.equals(this.targetPos,.1)},e}(d)).instance=null,y=e((b=E).prototype,"guideCamera",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=b))||T));n._RF.pop()}}}));

System.register("chunks:///_virtual/CheaterUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./PlayerData.ts","./LocalStorageMgr.ts","./PlayerFormationMgr.ts"],(function(e){"use strict";var t,n,o,r,i,a,s,c,l,u,g,p,d,y;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,o=e._decorator,r=e.find,i=e.Input,a=e.EditBox,s=e.ToggleContainer,c=e.Label},function(e){l=e.LayerType,u=e.PopType,g=e.BaseUI},function(e){p=e.PlayerData},function(e){d=e.LocalStorageMgr},function(e){y=e.PlayerFormationMgr}],execute:function(){var f,h;n._RF.push({},"1ba46ksjcxA6LgMCmqgaebz","CheaterUI",void 0);var m=o.ccclass;o.property,e("default",m("CheaterUI")(((h=function(e){function n(){for(var t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))||this).m_layerType=l.normal,t.m_PopType=u.max,t}t(n,e);var o=n.prototype;return o.onLoad=function(){r("coinSet/Button",this.node).on(i.EventType.TOUCH_END,this.addCoin,this),r("storgeReset",this.node).on(i.EventType.TOUCH_END,this.onStorgeReset,this)},o.onDestroy=function(){},o.onEnable=function(){},o.OnMsg=function(){},o.addCoin=function(){var e=r("coinSet/EditBox",this.node).getComponent(a).textLabel.string;e=e.replace(/[^0-9]/g,""),p.ins.Coin+=Number(e)},o.onStorgeReset=function(){d.clear(),this.restart()},o.buySoldier=function(){var e=r("buySoldier/ToggleGroup",this.node).getComponent(s).activeToggles(),t=r("buySoldier/ToggleGroup-001",this.node).getComponent(s).activeToggles();y.ins.BuySoldier(e[0].node.getChildByName("Label").getComponent(c).string,Number(t[0].node.name.replace("Toggle","")))},o.enterLevel=function(){var e=r("enterLevel/EditBox",this.node).getComponent(a).textLabel.string;e=e.replace(/[^0-9]/g,""),p.ins.CurrUnlockGK=Number(e),this.restart()},o.restart=function(){window.tt?window.tt.restartMiniProgramSync():location.reload()},n}(g)).prefabUrl="CheaterUI",f=h))||f);n._RF.pop()}}}));

System.register("chunks:///_virtual/DoubleAttackSpeedUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UIManager.ts","./PlayerData.ts"],(function(e){"use strict";var t,n,i,r,l,o,a,u,c,p,s,b,f,y,d,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){l=e.cclegacy,o=e._decorator,a=e.Node,u=e.Label,c=e.Sprite,p=e.SpriteFrame,s=e.Input},function(e){b=e.LayerType,f=e.PopType,y=e.BaseUI},function(e){d=e.default},function(e){g=e.PlayerData}],execute:function(){var B,h,S,m,P,U,D,I,L,v,w,z,F,T,A,_,C,k;l._RF.push({},"90f91LBKzJOabNMO2PmCv5X","DoubleAttackSpeedUI",void 0);var E=o.ccclass,O=o.property;e("default",(B=E("DoubleAttackSpeedUI"),h=O(a),S=O(u),m=O(u),P=O(c),U=O(p),D=O(p),I=O(a),B(((k=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),o=0;o<n;o++)l[o]=arguments[o];return(t=e.call.apply(e,[this].concat(l))||this).m_layerType=b.normal,t.m_PopType=f.PopUp,i(t,"cloeBtn",w,r(t)),i(t,"titleLabel",z,r(t)),i(t,"conditionLabel",F,r(t)),i(t,"titleBg",T,r(t)),i(t,"purpleBgSPF",A,r(t)),i(t,"yellowBgSPF",_,r(t)),i(t,"adBtn",C,r(t)),t.isSpeedUI=!1,t}n(t,e);var l=t.prototype;return l.onLoad=function(){this.cloeBtn.on(s.EventType.TOUCH_END,this.onClose,this),this.adBtn.on(s.EventType.TOUCH_END,this.onAdBtn,this)},l.onDestroy=function(){},l.onEnable=function(){},l.OnMsg=function(e){this.isSpeedUI=e;var t=e?"双倍攻速":"双倍金币";this.titleLabel.string=""+t,this.conditionLabel.string="激活本场"+t,this.titleBg.spriteFrame=e?this.purpleBgSPF:this.yellowBgSPF},l.onAdBtn=function(){g.ins.IsDoubleAtSpeed=!0,this.onClose()},l.onClose=function(){d.ins.closeUI(t)},t}(y)).prefabUrl="DoubleAttackSpeedUI",w=t((v=k).prototype,"cloeBtn",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(v.prototype,"titleLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(v.prototype,"conditionLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(v.prototype,"titleBg",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(v.prototype,"purpleBgSPF",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(v.prototype,"yellowBgSPF",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(v.prototype,"adBtn",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=v))||L));l._RF.pop()}}}));

System.register("chunks:///_virtual/DropEffectUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,i,r,n,c,a,f,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){c=t.cclegacy,a=t._decorator,f=t.Node,l=t.Component}],execute:function(){var o,s,u,h,p,v,d,_,g,b,S,y,w,m,z,E;c._RF.push({},"5e277xgRmVLw6vW2HIpgEbn","DropEffectUI",void 0);var j=a.ccclass,D=a.property;t("DropEffectUI",(o=j("DropEffectUI"),s=D(f),u=D(f),h=D(f),p=D(f),v=D(f),d=D(f),o(((E=function(t){function e(){for(var e,i=arguments.length,c=new Array(i),a=0;a<i;a++)c[a]=arguments[a];return e=t.call.apply(t,[this].concat(c))||this,r(e,"effct_uplevel",b,n(e)),r(e,"effct_turn",S,n(e)),r(e,"effct_jade",y,n(e)),r(e,"lightStars",w,n(e)),r(e,"superStars",m,n(e)),r(e,"effct_star",z,n(e)),e}i(e,t);var c=e.prototype;return c.onLoad=function(){e.ins=this},c.start=function(){this.effct_uplevel.active=!1,this.effct_turn.active=!1,this.effct_jade.active=!1,this.node.active=!1},c.update=function(t){},c.ShowUpEffect=function(t){this.effct_star.active=!0,this.effct_uplevel.active=t,t&&(this.effct_jade.active=!1)},c.ShowTurnEffect=function(t){this.effct_star.active=!0,this.effct_turn.active=t,t&&(this.effct_jade.active=!1)},c.ShowStarsEffect=function(t,e){if(this.effct_star.active=!0,0==t){this.node.active=!1,this.effct_turn.active=!1,this.effct_uplevel.active=!1,this.effct_jade.active=!1;for(var i=0;i<this.lightStars.children.length;i++)this.lightStars.children[i].active=!1}else if(this.node.active=!0,this.lightStars.active=e<=5,this.superStars.active=e>5,e>5)for(var r=e-5,n=0;n<this.superStars.children.length;n++)this.superStars.children[n].active=n<r;else for(var c=0;c<this.lightStars.children.length;c++)this.lightStars.children[c].active=c<e},c.ShowAltarPrice=function(t,e,i){},c.setActive=function(t){this.node.active=t},c.setPosition=function(t){this.node.setPosition(t)},e}(l)).ins=null,b=e((g=E).prototype,"effct_uplevel",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(g.prototype,"effct_turn",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=e(g.prototype,"effct_jade",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(g.prototype,"lightStars",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(g.prototype,"superStars",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(g.prototype,"effct_star",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=g))||_));c._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyMapController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameEnum.ts","./ReadTablesManager.ts","./EnmyMapClass.ts","./ResManager.ts","./Entity.ts","./GameController.ts","./GameData.ts","./EntityAnim.ts"],(function(e){"use strict";var t,n,a,r,i,o,s,l,u,c,d,h,p,f,y,M,m,v,w,g,G,E,b,C,I,P,x,L;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.initializerDefineProperty,r=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,u=e.Prefab,c=e.NodePool,d=e.instantiate,h=e.v3,p=e.Component,f=e.log,y=e.Vec3,M=e.math},function(e){m=e.GameMode},function(e){v=e.ReadTablesManager},function(e){w=e.EnmyMapInfoModel,g=e.MapTypeModel,G=e.MapLevelModel,E=e.EnemyLatticeData},function(e){b=e.ResManager},function(e){C=e.Entity},function(e){I=e.GameController},function(e){P=e.UnitCategory,x=e.GameData},function(e){L=e.EntityAnim}],execute:function(){var D,T,B,R,S,A;s._RF.push({},"d909c6PLa9LWbJvnXhAu+qo","EnemyMapController",void 0);var k=l.ccclass,N=l.property;e("EnemyMapController",(D=k("EnemyMapController"),T=N(u),D(((A=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,a(t,"shadowPrefab",S,r(t)),t.shadowNodePool=new c,t}n(t,e);var s=t.prototype;return s.onLoad=function(){t.ins=this},s.InitEnemyMap=function(){var e=i(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=m.GM_NORMAL),e.next=3,this.createModelInfo(t,!0,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),s.InitGuideMap=function(){var e=i(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.ins.LoadGuideMap(t);case 2:return n=e.sent,e.next=5,this.InitEnemyMapLattice(n,0,t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.createModelInfo=function(){var e=i(o().mark((function e(t,n,a){var r,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=!0),void 0===a&&(a=m.GM_NORMAL),r=v.ins.GetMapAssetPath(t,a),e.next=5,b.instance.loadJsonAsset(r);case 5:return i=e.sent,s=v.ins.readMapsDataByContent(i),e.next=9,this.InitEnemyMapLattice(s,t,n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}(),s.InitEnemyMapLattice=function(){var e=i(o().mark((function e(t,n,a){var r,i,s,l,u,c,p,m,v,w,E,b,P;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===a&&(a=!0),r=0,i=1,s=this.GetMapBuffList(),l={width:0,height:0},0!=(u=this.InitEnemyUnits(t,l)).length){e.next=9;break}return f("获取敌人格子列表数据失败 map"+n),e.abrupt("return");case 9:c=I.ins.enemyMaterials[M.randomRangeInt(0,2)],l.width=-l.width/2,p=0;case 12:if(!(p<u.length)){e.next=32;break}return m=u[p],v=m.typeModel,w=m.levelModel,null==v&&(v=g.GetDataById(0)),r+=v.gold,null==w&&(w=G.GetDataById(0)),e.next=21,this.GetModelObjectBySoldierType(v.type,w.level);case 21:E=e.sent,(b=d(E)).addComponent(L),(P=b.getComponent(C)).SetLevel(w.level),P.SetTotalBuffs(s),a?(I.ins.enemySoldierContainer.addChild(b),b.setPosition(new y(l.width*i+i+m.width*i,0,-(t.height-m.height-1)*i-25)),b.eulerAngles=new y(0,0,0),P.isEnemy=!0,P.setMaterial(c)):(I.ins.mySoldierContainer.addChild(b),b.setPosition(h(l.width*i+i+m.width*i,0,-(m.height-t.height)*i-2.48*6/2)),b.eulerAngles=new y(0,180,0),P.isEnemy=!1,P.setMaterial(I.ins.playerMaterial)),this.createShadow(P);case 29:p++,e.next=12;break;case 32:f("当前地图的怪物携带金币总和="+r);case 33:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}(),s.InitEnemyUnits=function(e,t){var n=[],a=e.width,r=e.height;t.width=a,t.height=r;for(var i=e.typeData,o=e.levelData,s=i.data,l=o.data,u=w.GetTypeTilesetFirstGid(e),c=w.GetLevelTilesetFirstGid(e),d=0,h=0,p=0;p<s.length;p++){var f=null;if(s[p]>0){f=new E;var y=s[p]-u;f.id=y;var M=l[p]-c;f.width=d,f.height=h,f.typeModel=g.GetDataById(y),f.levelModel=G.GetDataById(M),n.push(f)}++d>=a&&(d=0,h++)}return n},s.GetMapBuffList=function(){return[]},s.GetModelObjectBySoldierType=function(){var e=i(o().mark((function e(t,n){var a,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.UNIT_ORIGINS.get(t),r="soldierPrefabs/"+a+n,e.next=4,b.instance.loadUnit(r);case 4:return i=e.sent,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s.createShadow=function(e){var t=this.shadowNodePool.get();t||(t=d(this.shadowPrefab)),I.ins.soldierShadowContainer.addChild(t),e.shadow=t,t.setWorldPosition(e.node.worldPosition.x,.02,e.node.worldPosition.z),e.isGeneral||e.unitCat===P.Paladin?t.scale=h(.01,.01,.01):t.scale=h(.006,.006,.006)},t}(p)).ins=null,S=t((R=A).prototype,"shadowPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=R))||B));s._RF.pop()}}}));

System.register("chunks:///_virtual/EnmyMapClass.ts",["cc"],(function(i){"use strict";var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"b8412t+/YVP0LCz9lgt05yV","EnmyMapClass",void 0);i("EnmyMapInfoModel",function(){function i(){this.height=void 0,this.infinite=void 0,this.nextlayerid=void 0,this.nextobjectid=void 0,this.orientation=void 0,this.renderorder=void 0,this.tiledversion=void 0,this.tileheight=void 0,this.tilewidth=void 0,this.type=void 0,this.version=void 0,this.width=void 0,this.tilesets=void 0,this.typeData=void 0,this.levelData=void 0}return i.GetLevelTilesetFirstGid=function(i){for(var t=0;t<i.tilesets.length;t++)if(null!=i.tilesets[t].source&&-1!==i.tilesets[t].source.indexOf("level.tsx"))return i.tilesets[t].firstgid;return-1},i.GetTypeTilesetFirstGid=function(i){for(var t=0;t<i.tilesets.length;t++){var e=i.tilesets[t];if(null!=e.source&&-1!==e.source.indexOf("type.tsx"))return e.firstgid}return-1},i}()),i("PositionDataModel",(function(){this.data=void 0,this.id=void 0,this.name=void 0,this.opacity=void 0,this.type=void 0,this.visible=void 0,this.width=void 0,this.height=void 0,this.x=void 0,this.y=void 0})),i("Tileset",(function(){this.firstgid=void 0,this.source=void 0})),i("EnemyLatticeData",(function(){this.id=void 0,this.width=void 0,this.height=void 0,this.typeModel=void 0,this.levelModel=void 0})),i("EnemyTypeModel",(function(){this.id=void 0,this.gold=void 0,this.type=void 0})),i("EnemyLevelModel",(function(){this.id=void 0,this.level=void 0}));i("MapTypeModel",function(){function i(i){this.columns=void 0,this.imageheight=void 0,this.imagewidth=void 0,this.margin=void 0,this.name=void 0,this.spacing=void 0,this.tilecount=void 0,this.tiledversion=void 0,this.tileheight=void 0,this.tilewidth=void 0,this.version=void 0,this.columns=i.columns,this.imageheight=i.imageheight,this.imagewidth=i.imagewidth,this.margin=i.margin,this.name=i.name,this.spacing=i.spacing,this.tilecount=i.tilecount,this.tiledversion=i.tiledversion,this.tileheight=i.tileheight,this.tilewidth=i.tilewidth,this.version=i.version}return i.prototype.addList=function(t){i.typeList.push(t)},i.GetDataById=function(t){return i.typeList.find((function(i){return i.id===t}))},i}()).typeList=[],i("MapLevelModel",function(){function i(i){this.columns=void 0,this.imageheight=void 0,this.imagewidth=void 0,this.name=void 0,this.margin=void 0,this.spacing=void 0,this.tilecount=void 0,this.tiledversion=void 0,this.tileheight=void 0,this.tilewidth=void 0,this.version=void 0,this.columns=i.columns,this.imageheight=i.imageheight,this.imagewidth=i.imagewidth,this.name=i.name,this.margin=i.margin,this.spacing=i.spacing,this.tilecount=i.tilecount,this.tiledversion=i.tiledversion,this.tileheight=i.tileheight,this.tilewidth=i.tilewidth,this.version=i.version}return i.prototype.addList=function(t){i.levelList.push(t)},i.GetDataById=function(t){return i.levelList.find((function(i){return i.id==t}))},i}()).levelList=[];i("GeneralLevelModel",(function(){this.level=void 0,this.hp=void 0,this.attack=void 0,this.speed=void 0,this.attackSpeed=void 0,this.attackRange=void 0,this.coinType=void 0,this.coinNum=void 0}));t._RF.pop()}}}));

System.register("chunks:///_virtual/Entity.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameController.ts","./SteerEntity.ts","./GameData.ts","./BuffUtil.ts","./GameSettings.ts","./ReadTablesManager.ts","./EntityAnim.ts","./ProjectileEmitter.ts"],(function(t){"use strict";var i,e,a,s,n,r,o,h,c,l,u,d,f,y,S,g,p,k,v,m,T,A,P,x,D,E,q,R,I;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,a=t.initializerDefineProperty,s=t.assertThisInitialized,n=t.createClass},function(t){r=t.cclegacy,o=t._decorator,h=t.v3,c=t.v2,l=t.Quat,u=t.Enum,d=t.SkeletalAnimation,f=t.Animation,y=t.SkinnedMeshRenderer,S=t.MeshRenderer,g=t.Vec2,p=t.math,k=t.ParticleSystem},function(t){v=t.GameController,m=t.GameState},function(t){T=t.SteerEntity},function(t){A=t.GameData,P=t.UnitCategory},function(t){x=t.BuffUtil},function(t){D=t.GameSettings},function(t){E=t.ReadTablesManager},function(t){q=t.EntityAnim,R=t.AnimationState},function(t){I=t.ProjectileType}],execute:function(){var M,F,w,C,b,_,G;t({AttackRange:void 0,HitEffectType:void 0,State:void 0}),r._RF.push({},"263d3NMUEhPjIE32BtmMAGo","Entity",void 0);var L,B=o.ccclass,H=o.property,z=h(),K=c(),O=c(),N=(c(),c(),c()),U=c(),W=c(),j=new l,Q=t("Death",(function(){this.entity=null,this.tol=0}));!function(t){t[t.ExplosionBlue=0]="ExplosionBlue",t[t.HitBlue=1]="HitBlue"}(L||(L=t("HitEffectType",{})));var V,J,X=t("TargetInfo",(function(){this.distance=void 0,this.entity=void 0}));!function(t){t[t.Normal=0]="Normal",t[t.Mid=1]="Mid",t[t.Long=2]="Long"}(V||(V=t("AttackRange",{}))),function(t){t[t.Standby=0]="Standby",t[t.Battle=1]="Battle",t[t.Dead=2]="Dead",t[t.KnockOut=3]="KnockOut",t[t.EditFormation=4]="EditFormation",t[t.Repel=5]="Repel",t[t.Stun=6]="Stun",t[t.Intensify=7]="Intensify",t[t.doSkill=8]="doSkill"}(J||(J=t("State",{})));t("AssaultProperty",(function(){this.maxSpeed=0,this.velocity=c(),this.acceleration=c(),this.assaultDuration=0,this.assaultDirection=c()}));var Y=c();t("Entity",(M=B("Entity"),F=H({type:u(V),displayName:"攻击距离类型",visible:function(){return!this.isGeneral}}),w=H({type:u(L),displayName:"打击特效"}),M((_=i((b=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).isFollowVelocityDir=!0,i.currState=J.Standby,i.skeletalAnimation=null,i.anim=null,i.lastAttackTime=0,a(i,"rangeType",_,s(i)),i.shadow=null,i.destination=c(),i.currentSoldierSkillData=null,i.isSelfHaveSkill=!1,i.attackers=[],i.detectTimer=0,a(i,"hitEffectType",G,s(i)),i.squadPosOffset=c(),i.foreignForce=c(),i.acceleration=c(),i.maxAcceleration=6,i.targetInRange=!1,i.attackTargetInFront=!1,i.isInSquad=!1,i.rotateWithSquad=!1,i.hasTarget=!1,i._dt=0,i.moving=!1,i.force_R=.01,i.stuckTime=0,i.stucking=!1,i.attackDistSq=0,i.attacking=!1,i.targetLastPos=c(),i.boundForce=2e3,i.currSquad=void 0,i.isSelfSkillPlaying=!1,i.tmpList=[],i}e(i,t);var r=i.prototype;return r.onLoad=function(){var i;t.prototype.onLoad.call(this),this.skeletalAnimation=this.node.getComponent(d),null==(i=this.skeletalAnimation)||i.on(f.EventType.FINISHED,this.onAnimationFinished,this),this.anim=this.node.getComponent(q)},r.start=function(){this.anim.changeState(R.Idle)},r.init=function(){var t;this.currState=J.Battle,this.position.set(this.node.position.x,this.node.position.z),null==(t=this.shadow)||t.setPosition(this.node.position.x,.02,this.node.position.z),this.entityProperty.level>5&&!this.isEnemy&&!this.isGeneral&&(this.SetCurrentSoldierSkillData(),this.isSelfHaveSkill=!0),this.anim.changeState(R.Run)},r.setMaterial=function(t){this.node.getComponentsInChildren(y).forEach((function(i){i.setMaterial(t,0)})),this.node.getComponentsInChildren(S).forEach((function(i){i.setMaterial(t,0)}))},r.SetLevel=function(t){this.entityProperty.level=t;var i=A.ins.GetUnitAttrs(this.unitCat,t,this.isGeneral);this.entityProperty.hp=this.entityProperty.maxHp=i[x.ATTR_HP],this.entityProperty.damage=i[x.ATTR_ATTACK],this.entityProperty.attackInterval=i[x.ATTR_ATTACK_SPEED],this.entityProperty.attackRange=i[x.ATTR_ATTACK_RANGE],this.entityProperty.damageRange=i[x.ATTR_DMG_RANGE],this.entityProperty.maxSpeed=i[x.ATTR_SPEED],this.angularSpeed=D.ins.s_unitAngularSpeed},r.updateShadowLocalPosition=function(){var t;null==(t=this.shadow)||t.setPosition(this.node.position.x,.02,this.node.position.z)},r.updateShadowWorldPosition=function(){var t;null==(t=this.shadow)||t.setWorldPosition(this.node.worldPosition.x,.02,this.node.worldPosition.z)},r.fixedUpdate=function(t){if(this._dt=t,this.updateShadowLocalPosition(),v.ins.curtState===m.Ing&&this.currState!==J.Dead&&this.currState!==J.KnockOut){if(J.Battle==this.currState){this._steeredForce.set(0,0),this.foreignForce.set(0,0);var i=this.updateForces();this.isInSquad&&this.ExeSquadState(),this.exeLockTarget(t),this.forward.set(this.velocity),this.hasTarget&&this.exeAttack(t),this.ExeMove(i,t)}this.lastAttackTime-=t}},r.ExeMove=function(t,i){if(this.currState!=J.doSkill)if(this.isInSquad){var e=c();g.add(e,this.squadPosOffset,this.currSquad.position),this.setPosition(e)}else{if(this.moving||t){D.ins.isMapBoundarySquare&&(this.velocity.x*=this.force_R*i,this.velocity.y*=this.force_R*i);var a=this.position,s=this.destination.x-a.x,n=this.destination.y-a.y,r=s*s+n*n;if(r>0){var o=60/(r=Math.sqrt(r));this._steeredForce.x=s*o,this._steeredForce.y=n*o}}var h=this._steeredForce.x+this.foreignForce.x,l=this._steeredForce.y+this.foreignForce.y;this.acceleration.x=h,this.acceleration.y=l;var u=this.acceleration.x*this.acceleration.x+this.acceleration.y*this.acceleration.y;if(this.maxAcceleration=6,u>this.maxAcceleration*this.maxAcceleration&&0==t){u=Math.sqrt(u);var d=this.maxAcceleration/u;this.acceleration.x*=d,this.acceleration.y*=d}if(this.velocity.x+=this.acceleration.x*i,this.velocity.y+=this.acceleration.y*i,(u=this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y)>this.entityProperty.maxSpeed*this.entityProperty.maxSpeed){u=Math.sqrt(u);var f=this.entityProperty.maxSpeed/u;this.velocity.x*=f,this.velocity.y*=f}var y=this.position;y.x+=this.velocity.x*i,y.y+=this.velocity.y*i,this.setPosition(y)}},r.setPosition=function(t){this.position.set(t),this.node.setPosition(h(t.x,0,t.y))},r.MoveTo=function(t){this.destination=t,this.moving=!0,this.stucking=!1,this.stuckTime=0},r.StopMove=function(){this.moving=!1,this.stucking=!1,this.stuckTime=0,this.velocity.set(0,0),this.acceleration.set(0,0)},r.exeAttack=function(t){if(this.attackTarget.currState===J.Dead)this.attackTarget=null,this.hasTarget=!1;else{g.squaredDistance(this.position,this.attackTarget.position)<=this.attackDistSq?(this.targetInRange=!0,this.moving&&this.StopMove()):(this.targetInRange=!1,this.moving?this.destination=this.attackTarget.position:this.MoveTo(this.attackTarget.position)),g.subtract(Y,this.attackTarget.position,this.position),this.forward.set(Y);var i=W.set(-this.node.forward.x,-this.node.forward.z),e=p.toDegree(this.forward.signAngle(i)),a=Math.min(this.angularSpeed*t,Math.abs(e)),s=e<0?a:-a,n=this.node.getRotation(),r=this._rotateQuat(s,j.set(n.x,n.y,n.z,n.w));if(this.node.setRotation(r),this.lastAngle+=s,this.isInSquad&&this.rotateWithSquad){K.set(-this.node.forward.x,-this.node.forward.z);var o=g.angle(this.position,K);this.attackTargetInFront=Math.abs(p.toDegree(o))<=3}else{var h=g.subtract(N,this.attackTarget.position,this.position);U.set(-this.node.forward.x,-this.node.forward.z);var c=g.angle(h,W);this.attackTargetInFront=Math.abs(p.toDegree(c))<=15}this.targetInRange&&this.attackTargetInFront&&this.lastAttackTime<=0&&(this.attacking||(this.attacking=!0),this.lastAttackTime=this.entityProperty.attackInterval,this.attack())}},r.exeLockTarget=function(t){if(this.detectTimer-=t,this.detectTimer<=0){var i=null;!(i=this.isInSquad&&this.currSquad.isRushing?this.SearchTarget(this,4):this.GetAttackTarget())||this.hasTarget&&i==this.attackTarget||this.SetTarget(i),this.hasTarget?(this.detectTimer=p.randomRange(.3,.38),this.isInSquad&&this.currSquad.isRushing&&(this.rotateWithSquad=!1)):this.detectTimer=p.randomRange(.1,.24)}},r.SetTarget=function(t){this.hasTarget&&t==this.attackTarget||(this.hasTarget&&this.attackTarget.RemoveAttacker(this),this.attacking=!1,this.attackTarget=t,this.targetLastPos=t.position,t.AddAttacker(this),this.attackDistSq=this.entityProperty.attackRange+this.radius*this.Scale,this.attackDistSq*=this.attackDistSq,this.hasTarget=!0)},r.ExeSquadState=function(){for(var t=this.radius*this.Scale,i=null,e=!1,a=this.currSquad.sid,s=0;s<v.ins.steerEntities.length;s++){var n=v.ins.steerEntities[s];if(n.alive){if(n.isEnemy===this.isEnemy){if(n.isInSquad&&n.currSquad.sid===a)continue;if(n.id===this.id)continue}var r=t+n.radius;if(g.distance(n.position,this.position)<=r){e=!0,i=n;break}}}e&&(this.LeaveSquad(),i.isInSquad&&i.LeaveSquad())},r.attack=function(){this.lastAttackTime=this.entityProperty.attackInterval,this.anim.changeState(R.Attack)},r.OnAttackTrigger=function(){this.attackTarget&&(V.Long==this.rangeType?this.DoLongRangeAttack():this.DoShortRangeAttack())},r.DoShortRangeAttack=function(){this.entityProperty.damageRange<=0&&this.HurtTarget(this.attackTarget)},r.DoLongRangeAttack=function(){var t=v.ins.createProjectile(this.unitCat===P.Mage?I.MagicBall:I.Arrow);t.node.setPosition(z.set(this.node.position).add(h(0,1.5,0))),t.damage=this.entityProperty.damage,t.damageRange=this.entityProperty.damageRange,t.isEnemy=this.isEnemy,t.hitEffectType=this.hitEffectType;var i=this.arrowTargetPosForecast(this.attackTarget,t);t.init(i)},r.HurtTarget=function(t){var i=t.node.worldPosition.clone();t.TakeDamage(this.entityProperty.damage),i.y+=1.8,this.showHitEffect(i)},r.arrowTargetPosForecast=function(t,i){var e=g.distance(t.position,this.position)/i.speed;return O.set(this.attackTarget.velocity).multiplyScalar(e),K.set(this.attackTarget.position).add(O),z.set(K.x,0,K.y)},r.TakeDamage=function(t){this.entityProperty.hp-=t,this.entityProperty.hp<=0&&(this.entityProperty.hp=0,this.killSelf())},r.killSelf=function(){if(J.Dead!=this.currState&&J.KnockOut!=this.currState){v.ins.onEntityKilled(this);var t=new Q;t.entity=this,v.ins.AddToDeadPool(t),this.isAssaultIng=!1,this.currState=J.Dead,this.anim.changeState(R.Die),this.LeaveSquad(!1)}},r.showHitEffect=function(t){var i=v.ins.createHitParticle(this.hitEffectType);i.HitEffectType=this.hitEffectType,i.setWorldPosition(t),i.getComponentsInChildren(k).forEach((function(t){t.play()})),i.getComponent(k).scheduleOnce((function(){v.ins.freeHitParticle(i)}),1)},r.GetAttackTarget=function(){for(var t=null,i=this.isEnemy?v.ins.mySoldiers:v.ins.enemySoldiers,e=1e22,a=1e22,s=null,n=0;n<i.length;n++){var r=i[n];if(r.currState!==J.Dead&&this!=r){var o=g.squaredDistance(this.position,r.position);r.attackers.length<6&&o<e&&(t=r,e=o),o<a&&(s=r,a=o)}}return t||(t=s),t},r.onAnimationFinished=function(t,i){i.name==R.Attack&&this.anim.changeState(R.Run),i.name,R.Die},r.SetTotalBuffs=function(t){if(t){var i=A.ins.GetUnitAttrs(this.unitCat,this.entityProperty.level,this.isGeneral);this.entityProperty.hp=this.entityProperty.maxHp=x.ApplyBuff(i,t,x.ATTR_HP),this.entityProperty.damage=x.ApplyBuff(i,t,x.ATTR_ATTACK),this.entityProperty.attackInterval=x.ApplyDebuff(i,t,x.ATTR_ATTACK_SPEED),this.entityProperty.maxSpeed=x.ApplyBuff(i,t,x.ATTR_SPEED)}},r.SetCurrentSoldierSkillData=function(){switch(null!=this.currentSoldierSkillData&&(this.currentSoldierSkillData=null),this.unitCat){case P.SwordMan:this.currentSoldierSkillData=E.ins.GetCurrentSoldierSkillsData(1);break;case P.Axe:this.currentSoldierSkillData=E.ins.GetCurrentSoldierSkillsData(2);break;case P.Spearman:this.currentSoldierSkillData=E.ins.GetCurrentSoldierSkillsData(3);break;case P.Archer:this.currentSoldierSkillData=E.ins.GetCurrentSoldierSkillsData(4);break;case P.Mage:this.currentSoldierSkillData=E.ins.GetCurrentSoldierSkillsData(5);break;case P.Paladin:this.currentSoldierSkillData=E.ins.GetCurrentSoldierSkillsData(6);break;default:this.currentSoldierSkillData=null}},r.SetAttackSpeedByAdBuff=function(t){this.entityProperty.attackInterval/=t},r.RemoveAttacker=function(t){var i=this.attackers.findIndex((function(i){return i===t.id}));-1!==i&&this.attackers.splice(i,1)},r.AddAttacker=function(t){-1===this.attackers.indexOf(t.id)&&this.attackers.push(t.id)},r.OnEntityKilled=function(t){this.attackTarget===t&&(this.GiveupCurrTarget(),this.StopMove()),this.RemoveAttacker(t)},r.GiveupCurrTarget=function(){this.attackTarget=null,this.hasTarget=!1,this.attacking=!1,this.targetInRange=!1,this.attackTargetInFront=!1},r.updateForces=function(){for(var t=!1,i=this.position,e=this.radius*this.Scale,a=v.ins.steerEntities,s=0;s<a.length;s++){var n=a[s];if(n.currState!==J.Dead&&n!==this){var r=e+n.radius,o=n.position,h=-o.x+i.x,c=-o.y+i.y,l=h*h+c*c;if(l<=r*r*4)if(l>0){var u=1,d=(l=Math.sqrt(l))-r;if(d>0)u=30/l/(d*d);else u=100/l;this.foreignForce.x+=h*u,this.foreignForce.y+=c*u}else this.foreignForce.x+=100}}if(D.ins.isMapBoundarySquare){var f=D.ins.lengthOfSquare,y=new g;i.x<0-f?(t=!0,y.x=0-f-i.x):i.x>0+f&&(t=!0,y.x=-(i.x-(0+f))),i.y<0-f?(t=!0,y.y=0-f-i.y):i.y>0+f&&(t=!0,y.y=-(i.y-(0+f))),this.foreignForce.x+=y.x*this.boundForce,this.foreignForce.y+=y.y*this.boundForce}else{var S=0-i.x,p=0-i.y,k=S*S+p*p;if(k>D.ins.sqSafeDist){var m=200/(k=Math.sqrt(k)-D.ins.safeDist)*(k*k);this.foreignForce.x+=S*m,this.foreignForce.y+=p*m}}return t},r.JoinSquad=function(t){if(this.isInSquad){if(t==this.currSquad)return;this.LeaveSquad()}this.isSelfSkillPlaying||(this.currSquad=t,this.currSquad.AddMember(this),this.isInSquad=!0)},r.LeaveSquad=function(t){void 0===t&&(t=!0),this.isInSquad&&(this.currSquad.RemoveMember(this),t&&(this.acceleration.set(this.currSquad.acceleration),this.velocity.set(this.currSquad.velocity)),this.currSquad=null,this.rotateWithSquad=!1,this.isInSquad=!1)},r.SearchTarget=function(t,i){for(var e=t.isEnemy,a=t.position,s=this.isEnemy?v.ins.mySoldiers:v.ins.enemySoldiers,n=i*i,r=0;r<s.length;r++){var o=s[r];if(o.alive&&o.isEnemy!==e){var h=g.squaredDistance(a,o.position);if(h<=n){var c=new X;c.entity=o,c.distance=h,this.tmpList.push(c)}}}var l=null;return this.tmpList.length>0&&(l=this.tmpList[0].entity),this.tmpList.length=0,l},n(i,[{key:"alive",get:function(){return this.currState!==J.Dead}}]),i}(T)).prototype,"rangeType",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return V.Normal}}),G=i(b.prototype,"hitEffectType",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L.HitBlue}}),C=b))||C));r._RF.pop()}}}));

System.register("chunks:///_virtual/EntityAnim.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Entity.ts"],(function(t){"use strict";var n,i,e,o,a,r;return{setters:[function(t){n=t.inheritsLoose},function(t){i=t.cclegacy,e=t._decorator,o=t.SkeletalAnimation,a=t.Component},function(t){r=t.Entity}],execute:function(){var c;t("AnimationState",void 0),i._RF.push({},"db775aYY4hE0oq7YCBEdxqP","EntityAnim",void 0);var u,s=e.ccclass;e.property;!function(t){t.Idle="idle",t.Attack="attack",t.Run="run",t.Die="death_a"}(u||(u=t("AnimationState",{})));t("EntityAnim",s("EntityAnim")(c=function(t){function i(){for(var n,i=arguments.length,e=new Array(i),o=0;o<i;o++)e[o]=arguments[o];return(n=t.call.apply(t,[this].concat(e))||this).entity_=null,n.animator_=null,n}n(i,t);var e=i.prototype;return e.onLoad=function(){this.animator_=this.node.getComponent(o),this.entity_=this.node.getComponent(r)},e.SetAnimSpeed=function(t){this.animator_.clips.forEach((function(n){n.speed=t}))},e.PlayVictory=function(){this.animator_},e.changeState=function(t){var n;null==(n=this.animator_)||n.play(t)},e.AttackTrigger=function(){this.entity_.OnAttackTrigger()},i}(a))||c);i._RF.pop()}}}));

System.register("chunks:///_virtual/EntityProperty.ts",["cc"],(function(t){"use strict";var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"93d0cCuKwlAa7UO4MfiujfA","EntityProperty",void 0);t("EntityProperty",(function(){this.maxHp=100,this.hp=this.maxHp,this.damage=11.5,this.attackInterval=0,this.attackRange=0,this.damageRange=0,this.maxSpeed=0,this.level=0}));e._RF.pop()}}}));

System.register("chunks:///_virtual/EventDispatcher.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,n;return{setters:[function(t){e=t.createClass},function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"0af0bglAxxITL7cSRpuTh1O","EventDispatcher",void 0);var i=t("EventDispatcher",function(){function t(){this.eventList={}}var n=t.prototype;return n.dispatchEvent=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var s=this.eventList[t];s&&s.forEach((function(t){t[0].apply(t[1],n)}))},n.addEventListener=function(t,e,n,i){void 0===i&&(i=!1);var s=this.eventList[t];s?s.forEach((function(t){t[0]!=e||t[1]})):(s=[],this.eventList[t]=s),s.push([e,n]),i&&e.call(n)},n.removeEventListener=function(t,e,n){var i=this.eventList[t];if(i)for(var s=i.length-1;s>=0;s--)i[s][0]==e&&i[s][1]==n&&i.splice(s,1);i&&0==i.length&&(this.eventList[t]=null,delete this.eventList[t])},e(t,null,[{key:"ins",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}());i._instance=null,window.EventDispatcher=i,n._RF.pop()}}}));

System.register("chunks:///_virtual/EventType.ts",["cc"],(function(E){"use strict";var T;return{setters:[function(E){T=E.cclegacy}],execute:function(){var _;E("EventType",void 0),T._RF.push({},"a8816+YhkdNEr7hKdwubCpo","EventType",void 0),function(E){E.START_BATTLE="START_BATTLE",E.CONTINUE_BATTLE="CONTINUE_BATTLE",E.LEVEL_CHANGE="LEVEL_CHANGE",E.COIN_CHANGE="COIN_CHANGE",E.BATTLE_COIN_CHANGE="BATTLE_COIN_CHANGE",E.CARDLEVEL_CHANGE="CARDLEVEL_CHANGE",E.LATTICE_CHANGE="LATTICE_CHANGE",E.POWER_CHANGE="POWER_CHANGE",E.TEMPLE_BTN="TEMPLE_BTN",E.GENERALLEVEL_CHANGE="GENERALLEVEL_CHANGE",E.UPDATE_AVERAGECOIN="UPDATE_AVERAGECOIN",E.NEXT_GUIDE_STAGE="NEXT_GUIDE_STAGE",E.GOLD_DROP="GOLD_DROP",E.AD_EVENT="AD_EVENT",E.Main_Time="Main_Time",E.PLAY_COINBURST_EFFECT="PLAY_COINBURST_EFFECT"}(_||(_=E("EventType",{}))),T._RF.pop()}}}));

System.register("chunks:///_virtual/FormationGrid.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerData.ts","./GameData.ts","./EventDispatcher.ts","./EventType.ts"],(function(t){"use strict";var i,e,n,o,r,l,a,s,c,u,f,h,d,p,v;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,a=t.Node,s=t.math,c=t.log,u=t.ParticleSystem,f=t.Component},function(t){h=t.PlayerData},function(t){d=t.GameData},function(t){p=t.EventDispatcher},function(t){v=t.EventType}],execute:function(){var m,g,y,E,C,D,L,A,b,P,G;r._RF.push({},"5149e4AZlBE3YyC0kb+7yoQ","FormationGrid",void 0);var M=l.ccclass,N=l.property;t("FormationGrid",(m=M("FormationGrid"),g=N(a),y=N(a),E=N(a),C=N(a),m((A=i((L=function(t){function i(){for(var i,e=arguments.length,r=new Array(e),l=0;l<e;l++)r[l]=arguments[l];return i=t.call.apply(t,[this].concat(r))||this,n(i,"dropPointEffect",A,o(i)),n(i,"MergeEffect",b,o(i)),n(i,"LevelUpEffect",P,o(i)),n(i,"AddgridEffect",G,o(i)),i.data=null,i.isLock=!1,i.index=0,i.interval=void 0,i.intervalRandom=void 0,i.Timing=0,i.coinNum=void 0,i.goldDropMultiple=1,i.AverageCoinNum=10,i.level=void 0,i.currentLevel=0,i.unit=null,i}e(i,t);var r=i.prototype;return r.start=function(){},r.update=function(t){var i;null!=this&&null!=(i=this.data)&&i.m&&this.intervalRandom>0&&(this.Timing+=t,this.Timing>=this.intervalRandom&&(this.level!=this.currentLevel&&(this.currentLevel=this.level,this.GetCoinAddition(this.data.m.category,this.currentLevel)),this.CoinAddition(),this.intervalRandom=s.randomRange(this.interval-.3,this.interval+.3),this.Timing=0))},r.GetCoinAddition=function(t,i){this.unit=d.ins.GetUnitConf(t,i),this.interval=this.unit.intervalTime,this.intervalRandom=s.randomRange(this.interval-.3,this.interval+.3),this.coinNum=this.unit.coinNum,this.AverageCoinNum=this.unit.averageCoinNum},r.InitState=function(t,i){void 0===i&&(i=!1),this.isLock=0===t,!this.isLock&&c("第"+this.index+"个格子解锁"),this.node.getChildByName("Frame_Active").active=1===t,this.node.getChildByName("Frame_Lock").active=!0,i&&this.playAddgridEffect()},r.CoinAddition=function(){h.ins.GetDoubleCoinRunning()?this.goldDropMultiple=2:this.goldDropMultiple=1,p.ins.dispatchEvent(v.GOLD_DROP,this.node.worldPosition,this.coinNum*this.goldDropMultiple),h.ins.PayOrAddCoin(this.coinNum*this.goldDropMultiple,0)},r.SetData=function(){var t;null!=this&&null!=(t=this.data)&&t.m&&(this.level=this.data.m.level,this.currentLevel=this.level,this.GetCoinAddition(this.data.m.category,this.currentLevel))},r.reset=function(){this.index=0,this.isLock=!1,this.data=null},r.playMergeEffect=function(){this.MergeEffect.getComponent(u).play(),this.MergeEffect.getComponentsInChildren(u).forEach((function(t){t.play()}))},r.playAddgridEffect=function(){this.AddgridEffect.getComponentsInChildren(u).forEach((function(t){t.play()}))},r.playDropPointEffect=function(){this.dropPointEffect.getComponentsInChildren(u).forEach((function(t){t.play()}))},r.stopDropPointEffect=function(){this.dropPointEffect.getComponentsInChildren(u).forEach((function(t){t.stop()}))},r.playLevelUpEffect=function(){this.LevelUpEffect.getComponentsInChildren(u).forEach((function(t){t.play()}))},r.stopLevelUpEffect=function(){this.LevelUpEffect.getComponentsInChildren(u).forEach((function(t){t.stop()}))},i}(f)).prototype,"dropPointEffect",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=i(L.prototype,"MergeEffect",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=i(L.prototype,"LevelUpEffect",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=i(L.prototype,"AddgridEffect",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=L))||D));r._RF.pop()}}}));

System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CameraCtrl.ts","./Entity.ts","./QuadTree.ts","./ProjectileEmitter.ts","./EnemyMapController.ts","./ReadTablesManager.ts","./GameData.ts","./SoldierDrag.ts","./PlayerData.ts","./PlayerFormationMgr.ts","./BattleArrow.ts","./GameMapList.ts","./UIManager.ts","./HomeUI.ts","./EventDispatcher.ts","./EventType.ts","./EnmyMapClass.ts","./GameOverUI.ts","./GuideManager.ts","./Utils.ts","./GameSettings.ts","./EntityAnim.ts","./SquadController.ts","./WindowDataController.ts"],(function(e){"use strict";var t,n,i,r,o,a,s,l,u,c,d,h,f,m,p,y,E,v,g,S,C,b,P,w,G,L,T,M,A,x,I,B,D,N,R,_,k,O,U,H,z,F,W,K,V,j,q,Q,Y,J,X,Z;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.createClass,a=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){l=e.cclegacy,u=e.v3,c=e.v2,d=e._decorator,h=e.Prefab,f=e.Material,m=e.Label,p=e.Node,y=e.NodePool,E=e.find,v=e.macro,g=e.UITransform,S=e.math,C=e.instantiate,b=e.Pool,P=e.director,w=e.Vec2,G=e.Component},function(e){L=e.CameraCtrl},function(e){T=e.Entity,M=e.HitEffectType},function(e){A=e.Quadtree},function(e){x=e.ProjectileEmitter},function(e){I=e.EnemyMapController},function(e){B=e.ReadTablesManager},function(e){D=e.GameData},function(e){N=e.SoldierDrag},function(e){R=e.PlayerData},function(e){_=e.PlayerFormationMgr},function(e){k=e.BattleArrow},function(e){O=e.GameMapList},function(e){U=e.default},function(e){H=e.default},function(e){z=e.EventDispatcher},function(e){F=e.EventType},function(e){W=e.MapTypeModel},function(e){K=e.default},function(e){V=e.GuideManager,j=e.GuideState,q=e.GuideStage},function(e){Q=e.ScriptLocalization},function(e){Y=e.GameSettings},function(e){J=e.EntityAnim},function(e){X=e.SquadController},function(e){Z=e.WindowDataController}],execute:function(){var $,ee,te,ne,ie,re,oe,ae,se,le,ue,ce,de,he,fe,me,pe,ye,Ee,ve,ge,Se,Ce,be,Pe,we,Ge;e("GameState",void 0),l._RF.push({},"be236EAEm9ISamzb+7OVBh1","GameController",void 0),function(e){e[e.StandBy=0]="StandBy",e[e.DragSoldier=1]="DragSoldier",e[e.Ing=2]="Ing",e[e.Over=3]="Over"}(Ge||(Ge=e("GameState",{})));u();var Le=c(),Te=d.ccclass,Me=d.property;e("GameController",($=Te("GameController"),ee=Me(h),te=Me(f),ne=Me(f),ie=Me(x),re=Me(m),oe=Me({type:h,displayName:"普通打击特效"}),ae=Me({type:h,displayName:"范围爆炸打击特效"}),se=Me(k),le=Me(_),ue=Me(p),ce=Me(h),$(((we=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,i(t,"archerLeaderPrefab",fe,r(t)),i(t,"playerMaterial",me,r(t)),i(t,"enemyMaterials",pe,r(t)),i(t,"projectileEmitter",ye,r(t)),i(t,"countLabel",Ee,r(t)),t.hitEffectNodePool=new Map,i(t,"HitBluePrefab",ve,r(t)),i(t,"ExplosionBluePrefab",ge,r(t)),t.mySoldierContainer=null,t.enemySoldierContainer=null,t.tombstoneContainer=null,t.soldierShadowContainer=null,t.mySoldiers=[],t.enemySoldiers=[],t._curtState=null,t.steerEntities=[],t.myEntitytree=null,t.enemyEntitytree=null,t.HaveEnemyGeneral=!0,t.goldDropMultiple=0,t.isSpecial=!1,t.isNormal=!0,t.battleFieldInited=!1,t.currPowerup=1,t.currPowerlevel=1,i(t,"battleArrow",Se,r(t)),i(t,"playerFormationMgr",Ce,r(t)),i(t,"GameWorld",be,r(t)),i(t,"TombstonePrefab",Pe,r(t)),t.tempVec3=u(),t.dt=0,t.tombstoneNodePool=new y,t.CurrAttackSpeed=0,t.CurrHpAdBuff=0,t.deathPool=[],t}n(t,e);var l=t.prototype;return l.onLoad=function(){t.ins=this,this.mySoldierContainer=E("MySoldierContainer"),this.enemySoldierContainer=E("EnemySoldierContainer"),this.tombstoneContainer=E("TombstoneContainer"),this.soldierShadowContainer=E("SoldierShadowContainer"),this.battleArrow.node.active=!1,z.ins.addEventListener(F.START_BATTLE,this.startBattle,this),z.ins.addEventListener(F.CONTINUE_BATTLE,this.continueBattle,this),z.ins.addEventListener(F.GENERALLEVEL_CHANGE,this.onGenerallLevelChange,this),this.schedule(this.Tick_1s,1,v.REPEAT_FOREVER)},l.onDestroy=function(){z.ins.removeEventListener(F.START_BATTLE,this.startBattle,this),z.ins.removeEventListener(F.CONTINUE_BATTLE,this.continueBattle,this),z.ins.removeEventListener(F.GENERALLEVEL_CHANGE,this.onGenerallLevelChange,this)},l.start=function(){D.ins.Initialize(),this.init(),this.initHitParticleNodePool()},l.init=function(){var e=a(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={x:0,y:0,width:60,height:60},this.myEntitytree=new A(t),n={x:0,y:0,width:60,height:60},this.enemyEntitytree=new A(n),e.next=6,B.ins.init();case 6:return R.ins.ReadSaveData(),V.ins.init(),Z.ins.init(),e.next=11,this.initBattlefield();case 11:V.ins.startGuide();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.initBattlefield=function(){var e=a(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.ins.RemoveAll(),U.ins.showLoading(),E("Canvas").getChildByName("initTipLabel").active=!0,D.ins.curBattleLevel=R.ins.CurrUnlockGK,this.deathPool.length=0,e.next=7,this.initEnemy();case 7:return e.next=9,this.initPlayer();case 9:return this.battleArrow.node.active=!0,U.ins.hideLoading(),e.next=13,U.ins.showUI(H,!0);case 13:this.curtState=Ge.StandBy,this.battleFieldInited=!0,z.ins.dispatchEvent(F.POWER_CHANGE),E("Canvas").getChildByName("initTipLabel").active=!1,Y.ins.enableGuide&&2===R.ins.CurrUnlockGK&&V.ins.currGuideState!==j.Completed&&(V.ins.CurrStage=q.SOLDIER_UPGRADE);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.checkSoldierDragGuide=function(){if(Y.ins.enableGuide&&2===R.ins.CurrUnlockGK&&V.ins.currGuideState!==j.Completed&&V.ins.CurrStage===q.SOLDIER_UPGRADE&&V.ins.currGuideState!==j.Started)if(R.ins.SoldierUpgradeCount>0)V.ins.CurrStage=q.DOUBLE_MONEY_EARNINGS;else if(L.instance.checkIsReset()){var e=L.instance.camera.convertToUINode(this.battleArrow.turntable.worldPosition,E("Canvas"));E("Canvas").getComponent(g).convertToWorldSpaceAR(e,e),e.add(u(20,0,0)),V.ins.startCurStageGuide(0,null,B.ins.getLocalizationStr(Q.D_Guide_Three),e),this.playerFormationMgr.InitUpgradeGuide()}},l.initEnemy=function(){var e=a(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!D.ins.IsGuideBattle){e.next=3;break}return I.ins.InitGuideMap(!0),e.abrupt("return");case 3:if(!(this.HaveEnemyGeneral&&O.ins.GetNextMap()>5)){e.next=6;break}return e.next=6,this.createEnemySoldierLeader();case 6:return e.next=8,I.ins.InitEnemyMap(O.ins.GetNextMap());case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.initPlayer=function(){var e=a(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.createMySoldierLeader(),!D.ins.IsGuideBattle){e.next=6;break}return e.next=4,I.ins.InitGuideMap(!1);case 4:e.next=8;break;case 6:return e.next=8,this.playerFormationMgr.init();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),l.startBattle=function(){var e=this;this.mySoldiers=this.mySoldierContainer.getComponentsInChildren(T).concat([]),this.enemySoldiers=this.enemySoldierContainer.getComponentsInChildren(T).concat([]),this.steerEntities=[].concat(this.mySoldiers,this.enemySoldiers);var t=1;this.steerEntities.forEach((function(n){e.tempVec3.set(n.node.worldPosition),n.node.setParent(e.GameWorld),n.node.setWorldPosition(e.tempVec3),n.id=t,t++}));var n=this.battleArrow.getCurAngle();this.currPowerlevel=D.ins.GetArrowPowerupLevel(n);var i=this.battleArrow.getResultDirection();i.y=-i.y,this.scheduleOnce((function(){e.battleArrow.startTextAnim(e.currPowerlevel),c(0,1).rotate(S.toRadian(S.randomRange(-30,30))),e.steerEntities.forEach((function(e){e.node.removeComponent(N),e.init()})),Y.ins.enableSquadRushTest&&X.ins.InitRushSquads(i,e.currPowerlevel),e.playerFormationMgr.clear(),e.curtState=Ge.Ing}),.3)},l.update=function(e){if(this.dt=e,this.checkSoldierDragGuide(),this.curtState===Ge.Ing){this.countLabel.string="士兵个数："+this.steerEntities.length,this.myEntitytree.clear(),this.enemyEntitytree.clear();for(var t=0;t<this.mySoldiers.length;t++){var n=this.mySoldiers[t];this.myEntitytree.insert({x:n.position.x,y:n.position.y,width:2*n.radius,height:2*n.radius,entity:n})}for(var i=0;i<this.enemySoldiers.length;i++){var r=this.enemySoldiers[i];this.enemyEntitytree.insert({x:r.position.x,y:r.position.y,width:2*r.radius,height:2*r.radius,entity:r})}this.steerEntities.forEach((function(t){t.fixedUpdate(e)})),X.ins.Tick();for(var o=this.deathPool.length,a=null,s=0;s<o;)(a=this.deathPool[s]).tol+=e,a.tol>=2.4?(this.createTombstone(a.entity),a.entity.node.destroy(),I.ins.shadowNodePool.put(a.entity.shadow),a.entity.shadow=null,this.deathPool.splice(s,1),o--):s++}},l.onGameOver=function(){var e=a(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.curtState=Ge.Over,t&&(this.isSpecial?(R.ins.ChangeSpacialMapLevel(),this.isNormal=!1):(R.ins.ChangeGK(),R.ins.IsDoubleAtSpeed=!1,this.isNormal=!0)),V.ins.CurrStage!==q.FIRST_BATTLE){e.next=5;break}return V.ins.startCurStageGuide(.8),e.abrupt("return");case 5:return e.next=7,U.ins.showUI(K,!0);case 7:U.ins.OnMsg(K,t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),l.continueBattle=function(){for(var e=this,t=0;t<this.steerEntities.length;t++)this.createTombstone(this.steerEntities[t]),this.steerEntities[t].node.destroy(),I.ins.shadowNodePool.put(this.steerEntities[t].shadow),this.steerEntities[t].shadow=null,this.deathPool.splice(t,1);this.tombstoneContainer.children.forEach((function(t){e.tombstoneNodePool.put(t)})),this.scheduleOnce((function(){e.GameWorld.destroyAllChildren(),e.mySoldiers.length=e.enemySoldiers.length=e.steerEntities.length=0,e.tombstoneContainer.destroyAllChildren(),e.soldierShadowContainer.destroyAllChildren(),e.initBattlefield()}))},l.onEntityKilled=function(e){var t=W.GetDataById(e.unitCat);if(t&&e.isEnemy&&D.ins.EnemyDropCoins&&(R.ins.GetDoubleCoinRunning()?this.goldDropMultiple=2:this.goldDropMultiple=1,D.ins.SetGold(t.gold*this.goldDropMultiple)),X.ins.OnEntityKilled(e),e.isEnemy){var n=this.enemySoldiers.findIndex((function(t){return t===e}));-1!==n&&this.enemySoldiers.splice(n,1)}else{var i=this.mySoldiers.findIndex((function(t){return t===e}));-1!==i&&this.mySoldiers.splice(i,1)}var r=this.steerEntities.findIndex((function(t){return t===e}));-1!==r&&this.steerEntities.splice(r,1);for(var o=e.id,a=this.steerEntities.length,s=null,l=0;l<a;l++)(s=this.steerEntities[l]).alive&&s.id!==o&&s.OnEntityKilled(e);0!==this.enemySoldiers.length?0!==this.mySoldiers.length||this.onGameOver(!1):this.onGameOver(!0)},l.createTombstone=function(e){var t=this.tombstoneNodePool.get();t||(t=C(this.TombstonePrefab)),this.tombstoneContainer.addChild(t),t.setWorldPosition(e.node.worldPosition)},l.createMySoldierLeader=function(){var e=C(this.archerLeaderPrefab);e.addComponent(J),this.mySoldierContainer.addChild(e),e.setPosition(u(0,0,-10.47)),e.eulerAngles=u(0,180,0),I.ins.createShadow(e.getComponent(T)),e.getComponent(T).SetLevel(R.ins.CurrGeneralLevel),e.getComponent(T).setMaterial(this.playerMaterial)},l.createEnemySoldierLeader=function(){var e=t.ins.enemyMaterials[S.randomRangeInt(0,2)],n=C(this.archerLeaderPrefab);n.addComponent(J),this.enemySoldierContainer.addChild(n),n.setPosition(u(-this.enemySoldierContainer.position.x,0,-20));var i=n.getComponent(T);I.ins.createShadow(i),i.isEnemy=!0;var r=R.ins.CurrUnlockGK;i.SetLevel(r>500?500:r),i.setMaterial(e)},l.createProjectile=function(e){return this.projectileEmitter.create(e)},l.initHitParticleNodePool=function(){var e=this;this.hitEffectNodePool.set(M.HitBlue,new b((function(){return C(e.HitBluePrefab)}),5,(function(e){e.removeFromParent()}))),this.hitEffectNodePool.set(M.ExplosionBlue,new b((function(){return C(e.ExplosionBluePrefab)}),5,(function(e){e.removeFromParent()})))},l.createHitParticle=function(e){var t=this.hitEffectNodePool.get(e).alloc();return null==t.parent&&P.getScene().addChild(t),t.active=!0,t},l.freeHitParticle=function(e){e.active=!1,this.hitEffectNodePool.get(e.HitEffectType).free(e)},l.onGenerallLevelChange=function(){var e,t=null==(e=this.mySoldierContainer.getComponentsInChildren(T))?void 0:e.find((function(e){return e.isGeneral}));t&&t.SetLevel(R.ins.CurrGeneralLevel)},l.SetFightStartState=function(e,t,n){this.playerFormationMgr.EnableDrags(!1),this.CurrAttackSpeed=t,this.CurrHpAdBuff=n},l.AddToDeadPool=function(e){-1===this.deathPool.indexOf(e)&&this.deathPool.push(e)},l.Tick_1s=function(){z.ins.dispatchEvent(F.Main_Time)},l.TraverseEnemyInCircle=function(e,n,i,r,o){for(var a=(i?t.ins.myEntitytree:t.ins.enemyEntitytree).retrieve({x:e.y,y:e.y,width:2*n,height:2*n}),s=0;s<a.length;s++){var l,u,c,d=a[s];if(null!=d&&null!=(l=d.entity)&&l.position){d.entity.radius;w.squaredDistance(null==d||null==(u=d.entity)?void 0:u.position,Le.set(e.x,e.y))<=(null==d||null==(c=d.entity)?void 0:c.radius)&&r&&o&&r.call(o,d.entity)}}},o(t,[{key:"curtState",get:function(){return this._curtState},set:function(e){this._curtState=e,U.ins.OnMsg(H,this.curtState)}}]),t}(G)).ins=null,fe=t((he=we).prototype,"archerLeaderPrefab",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),me=t(he.prototype,"playerMaterial",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pe=t(he.prototype,"enemyMaterials",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ye=t(he.prototype,"projectileEmitter",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ee=t(he.prototype,"countLabel",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=t(he.prototype,"HitBluePrefab",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=t(he.prototype,"ExplosionBluePrefab",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=t(he.prototype,"battleArrow",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ce=t(he.prototype,"playerFormationMgr",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),be=t(he.prototype,"GameWorld",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pe=t(he.prototype,"TombstonePrefab",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=he))||de));l._RF.pop()}}}));

System.register("chunks:///_virtual/GameData.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventDispatcher.ts","./EventType.ts","./BuffUtil.ts","./Entity.ts","./GameController.ts","./GameSettings.ts","./PlayerData.ts","./ReadTablesManager.ts","./ResManager.ts","./UnitConfig.ts","./Utils.ts"],(function(t){"use strict";var e,n,i,a,r,o,s,u,l,c,h,T,A,f,_,d,p;return{setters:[function(t){e=t.createClass,n=t.asyncToGenerator,i=t.regeneratorRuntime},function(t){a=t.cclegacy,r=t.instantiate},function(t){o=t.EventDispatcher},function(t){s=t.EventType},function(t){u=t.BuffUtil},function(t){l=t.Entity},function(t){c=t.GameController},function(t){h=t.GameSettings},function(t){T=t.PlayerData},function(t){A=t.ReadTablesManager},function(t){f=t.ResManager},function(t){_=t.UnitData,d=t.UnitConfig},function(t){p=t.Utils}],execute:function(){var E;t("UnitCategory",void 0),a._RF.push({},"35937NoxgxHhLnMycY3z0n7","GameData",void 0),function(t){t[t.SwordMan=0]="SwordMan",t[t.Axe=1]="Axe",t[t.Spearman=2]="Spearman",t[t.Archer=3]="Archer",t[t.Mage=4]="Mage",t[t.Paladin=5]="Paladin",t[t.Invalid=-1]="Invalid"}(E||(E=t("UnitCategory",{})));var g=t("GameData",function(){function t(){this.SoldierLatticeWidth=6,this.SoldierLatticeHeight=6,this.latticeMinNum=12,this.BATTLE_POWERUP=[1,1.1,1.3,2],this.ARROW_ANGLE_LEVELS=[-1,30,20,8],this.ARROW_TIP=["完美","漂亮","不错","哎呀"],this.arrowSwayTime=.8,this.unitConfig=void 0,this.ShouldShowGameResult=!0,this.EnemyDropCoins=!0,this.ShouldShowHomePanel=!0,this.ShouldShowStageUI=!0,this.ShouldShowEarningsX2=!0,this.ShouldShowAttackSpeedX2=!0,this._curBattleLevel=0,this.IsGuideBattle=!1,this.CurrFightGotGold=0}var a=t.prototype;return a.GetArrowPowerup=function(t){var e=this.GetArrowPowerupLevel(t);return this.BATTLE_POWERUP[this.BATTLE_POWERUP.length-e-1]},a.GetArrowPowerupLevel=function(t){t=Math.abs(t);for(var e=this.BATTLE_POWERUP.length-1;e>0;e--)if(t<=this.ARROW_ANGLE_LEVELS[e])return this.BATTLE_POWERUP.length-e-1;return this.BATTLE_POWERUP.length-1},a.Initialize=function(){this.LoadUnitConf()},a.LoadUnitConf=function(){var e=n(i().mark((function e(){var n,a,r,o,s,u,l,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.unitConfig=new Map,e.next=3,f.instance.loadJsonAsset("b_tables_json/soldiersvalue");case 3:for(n=e.sent,a=0;a<n.length;a++)r=n[a],(o=new d).hp=r.hp,o.attack=r.at,o.speed=r.speed,o.attackSpeed=r.atspeed,o.attackRange=r.attrange,o.damageRange=r.attscope,o.coinNum=r.coin_num,o.intervalTime=r.time,o.averageCoinNum=r.coin_hour,o.powerValue=r.power_value,s=r.type,u=r.level,l=t.NAME_TO_UNIT_CATEGORY.get(s),(c=this.unitConfig.get(l))?c.Set(u,o):((c=new _).Set(u,o),this.unitConfig.set(l,c));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.GetUnitConf=function(t,e){var n=this.unitConfig.get(t);return n?n.GetByLevel(e):null},a.GetUnitAttrs=function(t,e,n){var i=new Array(u.ATTR_COUNT);if(n){var a=A.ins.GetGeneralData(e);i[u.ATTR_HP]=a.hp,i[u.ATTR_ATTACK]=a.attack,i[u.ATTR_ATTACK_RANGE]=a.attackRange,i[u.ATTR_ATTACK_SPEED]=a.attackSpeed,i[u.ATTR_SPEED]=a.speed,i[u.ATTR_DMG_RANGE]=0}else{var r=this.GetUnitConf(t,e);i[u.ATTR_HP]=r.hp,i[u.ATTR_ATTACK]=r.attack,i[u.ATTR_ATTACK_SPEED]=r.attackSpeed,i[u.ATTR_ATTACK_RANGE]=r.attackRange,i[u.ATTR_SPEED]=r.speed,i[u.ATTR_DMG_RANGE]=r.damageRange}return i},a.SetGold=function(t){this.CurrFightGotGold+=t,o.ins.dispatchEvent(s.BATTLE_COIN_CHANGE,"1")},a.SetAllGold=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!0),-1!=t?(this.CurrFightGotGold=t,e&&n&&o.ins.dispatchEvent(s.BATTLE_COIN_CHANGE,"1")):n&&o.ins.dispatchEvent(s.BATTLE_COIN_CHANGE,"-1")},a.IniGold=function(){T.ins.PayOrAddCoin(this.CurrFightGotGold,0),this.CurrFightGotGold=0},a.GetGoldNum=function(){return this.CurrFightGotGold},a.CountPower=function(){for(var t=this,e=0,n=new Map,i=[E.SwordMan,E.Axe,E.Spearman,E.Archer,E.Mage,E.Paladin],a=function(t){var e=i[t],a=new Array(u.ATTR_COUNT),r=T.ins.GetUnitShopBuff(e);null!=r&&r.forEach((function(t){var e=u.ATTR_NAME_TO_CODE[t.type];a[e]+=t.num}));var o=T.ins.GetUnitShopBuff(e,!0);null!=o&&o.forEach((function(t){var e=u.ATTR_NAME_TO_CODE[t.type];a[e]+=t.num})),n[e]=a},o=0;o<i.length;o++)a(o);var s=c.ins.mySoldierContainer.getComponentsInChildren(l),h=[];return s.forEach((function(t){var e=r(t);e.entityProperty=p.merge({},t.entityProperty),e.unitCat=t.unitCat,h.push(e)})),h.forEach((function(i){if(i.isGeneral);else{var a=n.get(i.unitCat);a&&i.SetTotalBuffs(a)}e+=t.EntityPower(i.entityProperty.maxHp,i.entityProperty.damage,i.entityProperty.attackInterval,i.entityProperty.maxSpeed,i.entityProperty.level,i.unitCat),i=null})),e},a.EntityPower=function(t,e,n,i,a,r){var o=0;o+=5*t,o+=50*e,o+=10*(1+2*(1-n)),o+=i;var s=this.GetUnitConf(r,a);return null!=s&&(o*=s.powerValue),o=Math.floor(o)},e(t,[{key:"IsAltarModeOpen",get:function(){return T.ins.Lattice>=this.latticeMinNum&&h.ins.isAltarModeOpen}},{key:"curBattleLevel",get:function(){return this._curBattleLevel},set:function(t){this._curBattleLevel=t,o.ins.dispatchEvent(s.LEVEL_CHANGE,t)}}],[{key:"ins",get:function(){return t._instance||(t._instance=new t),t._instance}}]),t}());g._instance=null,g.NAME_TO_UNIT_CATEGORY=new Map([["sword",E.SwordMan],["hammer",E.Axe],["bow",E.Archer],["gun",E.Spearman],["mage",E.Mage],["knight",E.Paladin]]),g.UNIT_CATEGORY_TO_NAME=void 0,g.UNIT_ORIGINS=new Map([["sword","Swordman_"],["hammer","Axe_"],["gun","Spearman_"],["bow","Archer_"],["mage","Mage_"],["knight","Paladin_"]]),g.ABValue="",a._RF.pop()}}}));

System.register("chunks:///_virtual/GameEnum.ts",["cc"],(function(e){"use strict";var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){var G;e("GameMode",void 0),t._RF.push({},"42700XYZrdJOLOGy0LxKbHp","GameEnum",void 0),function(e){e[e.GM_NORMAL=0]="GM_NORMAL",e[e.GM_BOSS=1]="GM_BOSS",e[e.GM_HEROS=2]="GM_HEROS",e[e.GM_REFRESH=3]="GM_REFRESH"}(G||(G=e("GameMode",{}))),t._RF.pop()}}}));

System.register("chunks:///_virtual/GameMapList.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerData.ts"],(function(n){"use strict";var t,a,i;return{setters:[function(n){t=n.createClass},function(n){a=n.cclegacy},function(n){i=n.PlayerData}],execute:function(){a._RF.push({},"6ba5dCqIyxG56tgCXk/znkj","GameMapList",void 0),n("GameMapList",function(){function n(){this.maxNormMapId=158,this.minInfMapId=2e4,this.maxInfMapId=20079}var a=n.prototype;return a.IsMapExist=function(n){return n>=1&&n<=this.maxNormMapId||n>=this.minInfMapId&&n<=this.maxInfMapId},a.IsInfMap=function(n){return n>=this.minInfMapId&&n<=this.maxInfMapId},a.NextMapId=function(n){return n<this.maxNormMapId?n+1:n==this.maxNormMapId?this.minInfMapId:n+1},a.GetNextMap=function(){var n=this.maxInfMapId-this.minInfMapId+1,t=-1,a=i.ins.CurrUnlockGK;if(a<=this.maxNormMapId)t=a;else{var s=(a-this.maxNormMapId)%n;s>0?t=2e4+s-1:1==s?t=2e4:0==s&&(t=this.maxInfMapId)}return t},a.GetCurrMapLoopTimes=function(){var n=this.maxInfMapId-this.minInfMapId+1;return(i.ins.CurrUnlockGK-this.maxNormMapId)/n+1},t(n,null,[{key:"ins",get:function(){return n._instance||(n._instance=new n),n._instance}}]),n}())._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/GameOverUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventDispatcher.ts","./EventType.ts","./BaseUI.ts","./UIManager.ts","./Turntable.ts","./GameData.ts"],(function(t){"use strict";var e,n,i,r,a,o,l,u,s,c,p,f,b,h,m,v,y,d,T,C;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){a=t.cclegacy,o=t._decorator,l=t.Node,u=t.Label,s=t.SpriteFrame,c=t.Input,p=t.Sprite,f=t.log},function(t){b=t.EventDispatcher},function(t){h=t.EventType},function(t){m=t.LayerType,v=t.PopType,y=t.BaseUI},function(t){d=t.default},function(t){T=t.Turntable},function(t){C=t.GameData}],execute:function(){var G,E,N,g,B,I,S,F,L,_,U,A,O,P;a._RF.push({},"3c45a245+lB3KGnS7Z29A2f","GameOverUI",void 0);var w=o.ccclass,D=o.property;t("default",(G=w("GameOverUI"),E=D(l),N=D(u),g=D(s),B=D(s),I=D(T),G(((P=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).m_layerType=m.normal,e.m_PopType=v.max,i(e,"ContinueBtn",L,r(e)),i(e,"resultLabel",_,r(e)),i(e,"winSPF",U,r(e)),i(e,"loseSPF",A,r(e)),i(e,"turntable",O,r(e)),e.coinNum=0,e}n(e,t);var a=e.prototype;return a.onLoad=function(){this.ContinueBtn.on(c.EventType.TOUCH_END,this.ContinueBattle,this),this.turntable.node.active=!1},a.OnMsg=function(t){this.coinNum=C.ins.GetGoldNum(),this.StartAnimation(t)},a.StartAnimation=function(t){this.resultLabel.node.parent.getComponent(p).spriteFrame=t?this.winSPF:this.loseSPF,this.resultLabel.string="战斗"+(t?"胜利":"失败"),t?(this.turntable.node.active=!0,this.turntable.startRotate(this.tuntableCallBack,this)):this.turntable.node.active=!1},a.tuntableCallBack=function(t){f("当前倍数result"+t);this.coinNum;for(var e=t;e>1;)e--,this.coinNum;C.ins.SetAllGold(this.coinNum),C.ins.GetGoldNum()>0?this.FlyCoin():b.ins.dispatchEvent(h.BATTLE_COIN_CHANGE,"0")},a.ContinueBattle=function(){d.ins.closeUI(e),b.ins.dispatchEvent(h.CONTINUE_BATTLE)},a.FlyCoin=function(t){C.ins.IniGold(),b.ins.dispatchEvent(h.BATTLE_COIN_CHANGE,"0")},e}(y)).prefabUrl="GameOver/GameOverUI",L=e((F=P).prototype,"ContinueBtn",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(F.prototype,"resultLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(F.prototype,"winSPF",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(F.prototype,"loseSPF",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(F.prototype,"turntable",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=F))||S));a._RF.pop()}}}));

System.register("chunks:///_virtual/GameSettings.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var i,t,r,a,n,l,u,s,o,p;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,u=e.v2,s=e.CCBoolean,o=e.CCFloat,p=e.Component}],execute:function(){var b,f,c,y,d,h,m,w,g,S,A,z,N,B,D,v,q,_,M,R,T,C,G,F,O,L,x,k,E,P,j,H,I,J,V,Y;n._RF.push({},"49b22+/MvZCYLV3ERm0iEBk","GameSettings",void 0);var Z=l.ccclass,K=l.property;u(),e("GameSettings",(b=Z("GameSettings"),f=K({type:s,displayName:"是否开启冲锋？"}),c=K({type:[o],displayName:"冲锋加速度",visible:function(){return this.enableSquadRushTest}}),y=K({type:[o],displayName:"冲锋最大速度限制",visible:function(){return this.enableSquadRushTest}}),d=K({type:[o],displayName:"冲锋持续时间",visible:function(){return this.enableSquadRushTest}}),h=K({type:o,tooltip:"士兵转向速度(度/秒)",displayName:"士兵转向速度(度/秒)"}),m=K({type:s,displayName:"是否调整箭头Buff？"}),w=K({type:[o],displayName:"箭头加成",visible:function(){return this.isSetArrowBuff}}),g=K({type:[o],displayName:"箭头角度档位",visible:function(){return this.isSetArrowBuff}}),S=K({type:o,displayName:"箭头摇摆时间",visible:function(){return this.isSetArrowBuff}}),A=K({type:s,displayName:"是否开启空投奖励"}),z=K({type:s,displayName:"是否开启空boss详情"}),N=K({type:s,displayName:"是否开启祭坛模式？"}),B=K({type:s,displayName:"是否开启新手引导？"}),D=K({type:o,displayName:"地图宽度"}),v=K({type:o,displayName:"地图高度"}),q=K({type:s,displayName:"是否是圆形地图限制"}),b(((Y=function(e){function i(){for(var i,t=arguments.length,n=new Array(t),l=0;l<t;l++)n[l]=arguments[l];return i=e.call.apply(e,[this].concat(n))||this,r(i,"enableSquadRushTest",R,a(i)),r(i,"rushAcceleration",T,a(i)),r(i,"rushMaxSpeed",C,a(i)),r(i,"assaultDuration",G,a(i)),r(i,"s_unitAngularSpeed",F,a(i)),r(i,"isSetArrowBuff",O,a(i)),r(i,"arrowBuffs",L,a(i)),r(i,"arrowAngles",x,a(i)),r(i,"arrowAnimTime",k,a(i)),i.altarJadeShopRefreshTimer=86400,r(i,"isAir_DropAward",E,a(i)),r(i,"isOpen_BossDes",P,a(i)),i.FeedSwitch=!1,i.FullScreenSwitch=!1,r(i,"isAltarModeOpen",j,a(i)),r(i,"enableGuide",H,a(i)),r(i,"width",I,a(i)),r(i,"height",J,a(i)),i.radius=0,i.safeDist=0,i.lengthOfSquare=0,i.sqSafeDist=0,r(i,"isMapBoundarySquare",V,a(i)),i}return t(i,e),i.prototype.onLoad=function(){i.ins=this,this.radius=.5*Math.min(this.width,this.height),this.safeDist=.72*this.radius,this.sqSafeDist=this.safeDist*this.safeDist},i}(p)).ins=null,R=i((M=Y).prototype,"enableSquadRushTest",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=i(M.prototype,"rushAcceleration",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C=i(M.prototype,"rushMaxSpeed",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),G=i(M.prototype,"assaultDuration",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F=i(M.prototype,"s_unitAngularSpeed",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O=i(M.prototype,"isSetArrowBuff",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=i(M.prototype,"arrowBuffs",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[1,1.1,1.3,2]}}),x=i(M.prototype,"arrowAngles",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[-1,30,20,8]}}),k=i(M.prototype,"arrowAnimTime",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),E=i(M.prototype,"isAir_DropAward",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=i(M.prototype,"isOpen_BossDes",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=i(M.prototype,"isAltarModeOpen",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=i(M.prototype,"enableGuide",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=i(M.prototype,"width",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),J=i(M.prototype,"height",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),V=i(M.prototype,"isMapBoundarySquare",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=M))||_));n._RF.pop()}}}));

System.register("chunks:///_virtual/GuideLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GuideManager.ts","./EventDispatcher.ts","./EventType.ts","./GameData.ts","./CameraCtrl.ts"],(function(t){"use strict";var e,i,o,n,a,s,r,l,c,h,d,u,p,g,v,y,m,f,w,C,S,k,T,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,r=t.Node,l=t.v3,c=t.Input,h=t.UITransform,d=t.v2,u=t.Tween,p=t.tween,g=t.easing,v=t.UIOpacity,y=t.find,m=t.Label,f=t.Component},function(t){w=t.GuideManager,C=t.GuideStage},function(t){S=t.EventDispatcher},function(t){k=t.EventType},function(t){T=t.GameData},function(t){b=t.CameraCtrl}],execute:function(){var B,D,I,P,E,L,O,_,A,G,U,z,N,R,x;a._RF.push({},"a9e2de9zoRJ6rvhIVOOQurq","GuideLayer",void 0);var F=s.ccclass,M=s.property;t("GuideLayer",(B=F("GuideLayer"),D=M(r),I=M(r),P=M(r),E=M(r),L=M(r),O=M(r),B((G=e((A=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a))||this,o(e,"mask",G,n(e)),o(e,"hand",U,n(e)),o(e,"handShadow",z,n(e)),o(e,"Click",N,n(e)),o(e,"Dialog",R,n(e)),o(e,"StoryBoard",x,n(e)),e.target=null,e}i(e,t);var a=e.prototype;return a.onLoad=function(){this.init(),this.Click.scale=l()},a.init=function(){this.node.on(c.EventType.TOUCH_START,this._onMaskTouchStart,this),this.node.on(c.EventType.TOUCH_END,this._onMaskTouchEnd,this)},a._onMaskTouchStart=function(t){var e=t.getUILocation(),i=this.mask.parent.getComponent(h).convertToNodeSpaceAR(l(e.x,e.y));this.mask.getComponent(h).getBoundingBox().contains(d(i.x,i.y))?t.preventSwallow=!0:t.preventSwallow=!1},a._onMaskTouchEnd=function(t){var e=t.getUILocation(),i=this.mask.parent.getComponent(h).convertToNodeSpaceAR(l(e.x,e.y));this.mask.getComponent(h).getBoundingBox().contains(d(i.x,i.y))?(t.preventSwallow=!0,console.log("点击到了空洞"),this.Hide()):t.preventSwallow=!1},a.setMaskTarget=function(t){this.target=t,t&&(this.mask.setWorldPosition(this.target.worldPosition),this.Click.setWorldPosition(this.target.worldPosition))},a.update=function(t){if(this.target){this.mask.setWorldPosition(this.target.worldPosition);var e=this.target.getComponent(h).getBoundingBox();this.mask.getComponent(h).width=e.width,this.mask.getComponent(h).height=e.height}else this.mask.getComponent(h).width=this.mask.getComponent(h).height=0},a.Hide=function(){this.node.active=!1},a.StartUpgradeFingers=function(t,e){u.stopAllByTarget(this.hand),u.stopAllByTarget(this.handShadow),this.hand.active=this.handShadow.active=!0;var i=b.instance.camera.convertToUINode(t.worldPosition,this.node),o=b.instance.camera.convertToUINode(e.worldPosition,this.node);i.y-=25,o.y-=25;var n=i.clone().add(l(-3,-10)),a=o.clone().add(l(-3,-10));this.hand.setPosition(i.clone()),this.handShadow.setPosition(n.clone()),p(this.hand).repeatForever(p().set({scale:l(.6,.6,.6)}).to(1,{position:o.clone()},{easing:g.sineOut}).set({scale:l(),position:i.clone()}).delay(1)).start(),p(this.handShadow).repeatForever(p().set({scale:l(.6,.6,.6)}).to(1,{position:a.clone()},{easing:g.sineOut}).set({scale:l(),position:n.clone()}).delay(1)).start()},a.playHandClickAni=function(){var t=this;u.stopAllByTarget(this.hand),u.stopAllByTarget(this.handShadow),this.Click.active=this.hand.active=this.handShadow.active=!0;var e=this.mask.position.clone().add(l(30,-50)),i=this.mask.position.clone().add(l(10,-120)),o=this.mask.position;this.hand.setPosition(e.clone()),this.handShadow.setPosition(i.clone()),p(this.hand).repeatForever(p().to(.25,{scale:l(.8,.8,.8),position:o.clone()},{easing:g.quadIn}).call((function(){p(t.Click).set({scale:l()}).to(.3,{scale:l(1,1,1)}).start(),p(t.Click.getComponent(v)).set({opacity:255}).to(.3,{opacity:20}).start()})).to(.25,{scale:l(1,1,1),position:e.clone()},{easing:g.quadOut})).start(),p(this.handShadow).repeatForever(p().to(.25,{scale:l(.8,.8,.8),position:o.clone()},{easing:g.quadIn}).to(.25,{scale:l(1,1,1),position:i.clone()},{easing:g.quadOut})).start(),p(this.handShadow.getComponent(v)).repeatForever(p().to(.25,{opacity:170},{easing:g.quadIn}).to(.25,{opacity:100},{easing:g.quadOut})).start()},a.showDialog=function(t,e){if(t&&""!==t){this.Dialog.active=!0;var i=y("bg/Label",this.Dialog).getComponent(m);i.string=t,i.updateRenderer(),this.Dialog.getChildByName("bg").getComponent(h).height=i.node.getComponent(h).height+70,e&&this.Dialog.setWorldPosition(e)}else this.Dialog.active=!1},a.playStory=function(){var t=this;this.StoryBoard.active=!0,p(this.StoryBoard.getComponent(v)).set({opacity:0}).to(1,{opacity:255}).delay(2).to(1,{opacity:0}).call((function(){t.reset(),w.ins.CurrStage=C.SOLDIER_CARD,T.ins.IsGuideBattle=!1,S.ins.dispatchEvent(k.CONTINUE_BATTLE)})).start()},a.reset=function(){this.StoryBoard.active=this.Dialog.active=this.hand.active=this.handShadow.active=this.Click.active=!1},e}(f)).prototype,"mask",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(A.prototype,"hand",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(A.prototype,"handShadow",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(A.prototype,"Click",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(A.prototype,"Dialog",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(A.prototype,"StoryBoard",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=A))||_));a._RF.pop()}}}));

System.register("chunks:///_virtual/GuideManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventDispatcher.ts","./EventType.ts","./GuideLayer.ts","./GameData.ts","./PlayerData.ts","./GameSettings.ts","./PlayerFormationMgr.ts"],(function(t){"use strict";var e,i,a,s,r,n,u,o,h,d,g,c,l,S,L,E,b,T,_;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,a=t.initializerDefineProperty,s=t.assertThisInitialized,r=t.createClass},function(t){n=t.cclegacy,u=t._decorator,o=t.Prefab,h=t.Mask,d=t.instantiate,g=t.director,c=t.Component},function(t){l=t.EventDispatcher},function(t){S=t.EventType},function(t){L=t.GuideLayer},function(t){E=t.GameData},function(t){b=t.PlayerData},function(t){T=t.GameSettings},function(t){_=t.PlayerFormationMgr}],execute:function(){var G,C,y,D,R,B;t({GuideStage:void 0,GuideState:void 0}),n._RF.push({},"8fb459LvFhNg7QABi11v9St","GuideManager",void 0);var f,p,O=u.ccclass,A=u.property;!function(t){t[t.NOP=-1]="NOP",t[t.ARROW_TIP=0]="ARROW_TIP",t[t.BATTLE_BUTTON=1]="BATTLE_BUTTON",t[t.FIRST_BATTLE=2]="FIRST_BATTLE",t[t.SOLDIER_CARD=3]="SOLDIER_CARD",t[t.SOLDIER_UPGRADE=4]="SOLDIER_UPGRADE",t[t.DOUBLE_MONEY_EARNINGS=5]="DOUBLE_MONEY_EARNINGS",t[t.COMPLETED=6]="COMPLETED"}(f||(f=t("GuideStage",{}))),function(t){t[t.Pending=0]="Pending",t[t.Started=1]="Started",t[t.Completed=2]="Completed"}(p||(p=t("GuideState",{})));t("GuideManager",(G=O("GuideManager"),C=A(o),G(((B=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,a(e,"guidePrefab",R,s(e)),e._CurrStage=f.NOP,e.guideLayer=null,e.blockButtons=!1,e.currGuideState=p.Pending,e.buttonWhitelist=[],e}i(e,t);var n=e.prototype;return n.onLoad=function(){e.ins=this},n.init=function(){this.blockButtons=!1,T.ins.enableGuide&&(this.CurrStage=b.ins.CurrGuideStage,this.CurrStage>f.DOUBLE_MONEY_EARNINGS?E.ins.ShouldShowEarningsX2=!0:E.ins.ShouldShowEarningsX2=!1,this.CurrStage<=f.FIRST_BATTLE?E.ins.IsGuideBattle=!0:E.ins.IsGuideBattle=!1,this.currGuideState=this.CurrStage>=f.DOUBLE_MONEY_EARNINGS?p.Completed:p.Pending)},n.startGuide=function(){T.ins.enableGuide&&(this.CurrStage===f.NOP?this.CurrStage=f.ARROW_TIP:this.CurrStage=this.CurrStage)},n.startCurStageGuide=function(t,e,i,a){var s=this;if(void 0===t&&(t=1),T.ins.enableGuide){switch(this.currGuideState=p.Started,this.guideLayer||this._createGuideLayer(),this.guideLayer.mask.getComponent(h).enabled=!0,this._CurrStage){case f.ARROW_TIP:this.blockButtons=!0,this.buttonWhitelist.length=0;break;case f.BATTLE_BUTTON:this.blockButtons=!0,this.buttonWhitelist.length=0,this.buttonWhitelist.push("FightButton");break;case f.FIRST_BATTLE:this.blockButtons=!0,this.buttonWhitelist.length=0;break;case f.SOLDIER_CARD:this.blockButtons=!0,this.buttonWhitelist.length=0,this.buttonWhitelist.push("btn_Draw"),b.ins.CurrGuideStage=this.CurrStage;break;case f.SOLDIER_UPGRADE:_.ins.EnableDrags(!0),this.blockButtons=!0,this.buttonWhitelist.length=0,b.ins.CurrGuideStage=this.CurrStage;break;default:this.buttonWhitelist.length=0}this.scheduleOnce((function(){s._refreshGuideUI(e,i,a)}),t)}},n.completeCurStageGuide=function(){this.blockButtons=!1,this.buttonWhitelist.length=0},n._refreshGuideUI=function(t,e,i){switch(this.guideLayer.mask.active=!0,this.guideLayer.node.active=!0,this.guideLayer.node.setSiblingIndex(9999999),this.guideLayer.reset(),this.guideLayer.setMaskTarget(t),this.CurrStage){case f.ARROW_TIP:this.CurrStage=f.BATTLE_BUTTON,this.guideLayer.showDialog(e,i);break;case f.BATTLE_BUTTON:this.guideLayer.playHandClickAni(),this.guideLayer.showDialog(e,i);break;case f.FIRST_BATTLE:this.guideLayer.mask.active=!1,E.ins.ShouldShowGameResult=!1,E.ins.EnemyDropCoins=!1,this.guideLayer.playStory();break;case f.SOLDIER_CARD:this.guideLayer.playHandClickAni(),this.guideLayer.showDialog(e,i);break;case f.SOLDIER_UPGRADE:this.guideLayer.showDialog(e,i)}},n.ButtonBlocked=function(t){return!(this.currGuideState===p.Completed||!this.blockButtons)&&-1===this.buttonWhitelist.indexOf(t.name)},n._createGuideLayer=function(){this.guideLayer=d(this.guidePrefab).getComponent(L),g.getScene().getChildByName("Canvas").addChild(this.guideLayer.node),this.guideLayer.node.active=!1},n.StartUpgradeFingers=function(t,e){this.guideLayer.StartUpgradeFingers(t,e)},n.StopUpgradeFingers=function(){},r(e,[{key:"CurrStage",get:function(){return this._CurrStage},set:function(t){switch(this._CurrStage=t,this.guideLayer||this._createGuideLayer(),this._CurrStage){case f.ARROW_TIP:this.blockButtons=!0,_.ins.EnableDrags(!1);break;case f.BATTLE_BUTTON:case f.FIRST_BATTLE:this.blockButtons=!0;break;case f.SOLDIER_CARD:this.blockButtons=!0,b.ins.CurrGuideStage=this.CurrStage;break;case f.SOLDIER_UPGRADE:_.ins.EnableDrags(!1),this.blockButtons=!0,b.ins.CurrGuideStage=this.CurrStage;break;case f.DOUBLE_MONEY_EARNINGS:this.blockButtons=!1,this.currGuideState=p.Completed,this.guideLayer.reset(),this.guideLayer.Hide(),b.ins.CurrGuideStage=this.CurrStage}this.currGuideState=p.Pending,l.ins.dispatchEvent(S.NEXT_GUIDE_STAGE)}}]),e}(c)).ins=null,R=e((D=B).prototype,"guidePrefab",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=D))||y));n._RF.pop()}}}));

System.register("chunks:///_virtual/HomeUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./EventDispatcher.ts","./EventType.ts","./UIManager.ts","./GameController.ts","./GameData.ts","./Utils.ts","./PlayerData.ts","./ReadTablesManager.ts","./SettingsUI.ts","./PlayerFormationMgr.ts","./UIGray.ts","./SelectSoldierCardUI.ts","./DoubleAttackSpeedUI.ts","./GuideManager.ts","./CameraCtrl.ts","./ShopMainUI.ts"],(function(t){"use strict";var e,n,i,o,a,r,s,l,c,u,h,d,C,b,p,_,g,f,y,v,L,m,B,E,G,S,T,D,H,A,N,w,I,x,O,U,k,F,P,z,M,R,V,K,X,Y,Z;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){s=t.cclegacy,l=t._decorator,c=t.v3,u=t.Node,h=t.Label,d=t.Prefab,C=t.NodePool,b=t.Sprite,p=t.find,_=t.Input,g=t.tween,f=t.Tween,y=t.Button,v=t.Layout,L=t.instantiate,m=t.UIOpacity,B=t.easing,E=t.ParticleSystem,G=t.log},function(t){S=t.LayerType,T=t.PopType,D=t.BaseUI},function(t){H=t.EventDispatcher},function(t){A=t.EventType},function(t){N=t.default},function(t){w=t.GameState,I=t.GameController},function(t){x=t.GameData},function(t){O=t.Utils,U=t.ScriptLocalization},function(t){k=t.PlayerData},function(t){F=t.ReadTablesManager},function(t){P=t.default},function(t){z=t.PlayerFormationMgr},function(t){M=t.UIGray},function(t){R=t.default},function(t){V=t.default},function(t){K=t.GuideManager,X=t.GuideStage},function(t){Y=t.CameraCtrl},function(t){Z=t.default}],execute:function(){var j,J,Q,W,q,$,tt,et,nt,it,ot,at,rt,st,lt,ct,ut,ht,dt,Ct,bt,pt,_t,gt,ft,yt,vt,Lt;s._RF.push({},"b63f2mzy4ZPH6xxOsQ5NbU9","HomeUI",void 0);var mt=l.ccclass,Bt=l.property,Et=c();t("default",(j=mt("HomeUI"),J=Bt(u),Q=Bt(u),W=Bt(h),q=Bt(h),$=Bt(u),tt=Bt(h),et=Bt(u),nt=Bt(u),it=Bt(u),ot=Bt(d),at=Bt(u),rt=Bt(u),j(((Lt=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))||this).m_layerType=S.normal,e.m_PopType=T.max,i(e,"fightBtn",ct,o(e)),i(e,"standByLayer",ut,o(e)),i(e,"levelLabel",ht,o(e)),i(e,"text_BattleCoin",dt,o(e)),i(e,"btn_Hero",Ct,o(e)),i(e,"text_Average",bt,o(e)),i(e,"btn_Options",pt,o(e)),i(e,"doubleSpeedBtn",_t,o(e)),i(e,"doubleCoinBtn",gt,o(e)),i(e,"addGoldPrefab",ft,o(e)),i(e,"btn_AddCoin",yt,o(e)),i(e,"CoinBurstEffect",vt,o(e)),e.mainCoin=null,e.img_HeroIcon=null,e.text_HeroLevel=null,e.text_HeroHp=null,e.text_HeroAttack=null,e.text_HeroCost=null,e.red_Hero=null,e.text_MainCoin=null,e.btn_Draw=null,e.text_Draw=null,e.coin_Draw=null,e.red_Draw=null,e.btn_BuyLattice=null,e.text_LatticeCost=null,e.coin_Lattice=null,e.text_LatticeMask=void 0,e.red_Lattice=void 0,e.btn_LatticeTV=void 0,e.btn_Shop=null,e.red_Shop=void 0,e.buySoldierFree=!1,e.coinCurrentNum=void 0,e.symblo="+",e.buyFieldFree=!1,e.addGoldNodePool=new C,e}n(e,t);var s=e.prototype;return s.onLoad=function(){this.mainCoin=this.node.getChildByName("mainCoin"),this.img_HeroIcon=this.btn_Hero.getChildByName("Hero_Icon").getComponent(b),this.text_HeroLevel=this.img_HeroIcon.node.getChildByName("LevelText").getComponent(h),this.text_HeroHp=p("Info/HeartIcon/hpText",this.btn_Hero).getComponent(h),this.text_HeroAttack=p("Info/AttackIcon/atkText",this.btn_Hero).getComponent(h),this.text_HeroCost=p("Image/HomeCoin/upLevelCost",this.btn_Hero).getComponent(h),this.text_MainCoin=p("standByLayer/HomeCoinContainer/HomeCoin/topcointext",this.node).getComponent(h),this.red_Hero=p("NewIcon",this.btn_Hero),this.btn_Draw=p("standByLayer/bottomBtns/btn_Draw",this.node),this.text_Draw=p("Image/HomeCoin/drawText",this.btn_Draw).getComponent(h),this.coin_Draw=p("Image/HomeCoin",this.btn_Draw),this.red_Draw=p("NewIcon",this.btn_Draw),this.btn_BuyLattice=p("standByLayer/bottomBtns/btn_BuyLattice",this.node),this.text_LatticeCost=p("Image/HomeCoin/Label",this.btn_BuyLattice).getComponent(h),this.coin_Lattice=p("Image/HomeCoin",this.btn_BuyLattice),this.red_Lattice=p("NewIcon",this.btn_BuyLattice),this.btn_Shop=p("standByLayer/bottomBtns/btn_Shop",this.node),H.ins.addEventListener(A.LEVEL_CHANGE,this.levelChange,this,!0),H.ins.addEventListener(A.COIN_CHANGE,this.OnCoinChange,this,!0),H.ins.addEventListener(A.BATTLE_COIN_CHANGE,this.battleCoinChange,this,!0),H.ins.addEventListener(A.LATTICE_CHANGE,this.onLatticeChange,this),H.ins.addEventListener(A.GENERALLEVEL_CHANGE,this.onGeneralLevelChange,this),H.ins.addEventListener(A.UPDATE_AVERAGECOIN,this.UpdateAverageCoinTxt,this,!0),H.ins.addEventListener(A.GOLD_DROP,this.onGoldDrop,this),H.ins.addEventListener(A.NEXT_GUIDE_STAGE,this.UpdateGuideStage,this,!0),H.ins.addEventListener(A.PLAY_COINBURST_EFFECT,this.playCoinBurstEffect,this),this.fightBtn.on(_.EventType.TOUCH_END,this.onBtnClick,this),this.btn_Options.on(_.EventType.TOUCH_END,this.onBtnClick,this),this.btn_Draw.on(_.EventType.TOUCH_END,this.onBtnClick,this),this.btn_BuyLattice.on(_.EventType.TOUCH_END,this.onBtnClick,this),this.btn_Hero.on(_.EventType.TOUCH_END,this.onBtnClick,this),this.doubleSpeedBtn.on(_.EventType.TOUCH_END,this.onBtnClick,this),this.doubleCoinBtn.on(_.EventType.TOUCH_END,this.onBtnClick,this),this.btn_Shop.on(_.EventType.TOUCH_END,this.onBtnClick,this),this.btn_AddCoin.on(_.EventType.TOUCH_END,this.onBtnClick,this)},s.onDestroy=function(){H.ins.removeEventListener(A.LEVEL_CHANGE,this.levelChange,this),H.ins.removeEventListener(A.COIN_CHANGE,this.OnCoinChange,this),H.ins.removeEventListener(A.BATTLE_COIN_CHANGE,this.battleCoinChange,this),H.ins.removeEventListener(A.LATTICE_CHANGE,this.onLatticeChange,this),H.ins.removeEventListener(A.GENERALLEVEL_CHANGE,this.onGeneralLevelChange,this),H.ins.removeEventListener(A.UPDATE_AVERAGECOIN,this.UpdateAverageCoinTxt,this),H.ins.removeEventListener(A.NEXT_GUIDE_STAGE,this.UpdateGuideStage,this),H.ins.removeEventListener(A.GOLD_DROP,this.onGoldDrop,this),H.ins.removeEventListener(A.PLAY_COINBURST_EFFECT,this.playCoinBurstEffect,this)},s.start=function(){},s.onEnable=function(){},s.OnMsg=function(t){switch(t){case w.StandBy:this.standByLayer.active=!0,this.levelLabel.node.active=!0,this.mainCoin.active=!1,this.doFightBtnAnimation();break;case w.Ing:this.standByLayer.active=!1,this.levelLabel.node.active=!0,this.mainCoin.active=!0,this.stopFightBtnAnimation();break;case w.Over:this.levelLabel.node.active=!1,this.standByLayer.active=!1,this.mainCoin.active=!0,this.stopFightBtnAnimation()}},s.onBtnClick=function(t){if(!K.ins.ButtonBlocked(t.target))switch(t.target){case this.fightBtn:this.startBattle();break;case this.btn_Options:this.onOpenSettingUI();break;case this.btn_Draw:this.onDrawClick();break;case this.btn_BuyLattice:this.onBuyLatticeClick();break;case this.btn_Hero:this.onHeroBtnClick();break;case this.doubleSpeedBtn:this.onDoubeSpedBtn();break;case this.doubleCoinBtn:this.onDoubeCoinBtn();break;case this.btn_Shop:case this.btn_AddCoin:this.onShopBtn()}},s.startBattle=function(){I.ins.curtState!==w.Ing&&(this.stopFightBtnAnimation(),H.ins.dispatchEvent(A.START_BATTLE),K.ins.CurrStage===X.BATTLE_BUTTON&&(K.ins.CurrStage=X.FIRST_BATTLE))},s.levelChange=function(t){t||(t=x.ins.curBattleLevel),this.levelLabel.string="关卡-"+t},s.OnCoinChange=function(){this.text_MainCoin.string=O.ConvertIntToString(k.ins.Coin),this.btn_GridState(),this.btn_GeneralBtnState(),this.btn_DrawState()},s.battleCoinChange=function(t){this.text_BattleCoin.node.parent.active=0!==x.ins.GetGoldNum(),this.text_BattleCoin.string=x.ins.GetGoldNum().toString()},s.doFightBtnAnimation=function(){this.fightBtn.active=!0,g(this.fightBtn).repeatForever(g().to(.7,{scale:c(.82,.82,.82)}).to(.7,{scale:c(.72,.72,.72)})).start()},s.stopFightBtnAnimation=function(){f.stopAllByTarget(this.fightBtn),this.fightBtn.active=!1},s.FlyCoin=function(t,e){k.ins.PayOrAddCoin(t,0)},s.btn_GeneralBtnState=function(){var t=F.ins.GeneralLevelMax(k.ins.CurrGeneralLevel),e=F.ins.GetNextGeneralData(k.ins.CurrGeneralLevel),n=F.ins.GetCurrGeneralData(k.ins.CurrGeneralLevel);if(t)this.btn_Hero.getComponent(y).interactable=!1,M.SetGray(this.btn_Hero,!1);else{if(null==e)return;e.coinNum<=k.ins.Coin?(this.btn_Hero.getComponent(y).interactable=!0,M.SetGray(this.btn_Hero,!1)):(this.btn_Hero.getComponent(y).interactable=!1,M.SetGray(this.btn_Hero))}this.text_HeroCost.string=e.coinNum.toString(),this.text_HeroHp.string=n.hp.toString(),this.text_HeroLevel.string="LV"+k.ins.CurrGeneralLevel.toString(),this.text_HeroAttack.string=n.attack.toString()},s.UpdateAverageCoinTxt=function(){var t=z.ins.averageC;this.coinCurrentNum=t;var e=F.ins.FightingSoldier_LocalizationJson.find((function(t){return t.Key===U.D_M}));this.text_Average.string=this.symblo+t.toString()+"/"+(null==e?void 0:e.Chinese)},s.onOpenSettingUI=function(){N.ins.showUI(P,!0)},s.onDrawClick=function(){var t=a(r().mark((function t(){var e;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1!=z.ins.GetSimpleLattice()){t.next=4;break}return G("没有多余的格子可供购买了"),t.abrupt("return");case 4:if(this.PayCard(),!((e=F.ins.GetAllUnlockByTheLevel(k.ins.CurrUnlockGK)).length>1)){t.next=12;break}return t.next=9,N.ins.showUI(R,!0);case 9:N.ins.OnMsg(R,""),t.next=13;break;case 12:1==e.length&&z.ins.BuySoldier(e[0].type,1);case 13:K.ins.CurrStage===X.SOLDIER_CARD&&K.ins.completeCurStageGuide();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.PayCard=function(){var t=F.ins.GetNextCardData(-1,k.ins.CardLevel);null!==t&&(k.ins.PayOrAddCoin(t.coinNum,1),k.ins.ChangeCardTimes(),this.btn_DrawState())},s.btn_DrawState=function(){var t=F.ins.GetNextCardData(-1,k.ins.CardLevel);if(null!=z.ins&&null!=t){var e=-1!==z.ins.GetSimpleLattice();this.text_Draw.string=t.coinNum.toString();var n=k.ins.Coin>=t.coinNum||this.buySoldierFree;this.btn_Draw.getComponent(y).interactable=n&&e,M.SetGray(this.btn_Draw,!n||!e),z.ins.GetSimpleLattice()}},s.onBuyLatticeClick=function(){if(this.buyFieldFree)return this.buyFieldFree=!1,z.ins.SetLatticeUnLock(),void k.ins.ChangeLattice();var t=F.ins.GetGridOpenDataByOrder(-1,k.ins.Lattice);null!==t&&(k.ins.Coin<t.cost||(k.ins.AddBuyFieldCount(1),k.ins.PayOrAddCoin(t.cost,1),z.ins.SetLatticeUnLock(),k.ins.ChangeLattice()))},s.btn_GridState=function(){var t=F.ins.GetGridOpenDataByOrder(-1,k.ins.Lattice);if(this.coin_Lattice.active=!0,null!=t)if(4==t.coinType);else{if(t.cost<=k.ins.Coin||this.buyFieldFree){this.btn_BuyLattice.getComponent(y).interactable=!0,M.SetGray(this.btn_BuyLattice,!1);var e=p("Icon",this.coin_Lattice);e&&(e.active=!this.buyFieldFree)}else M.SetGray(this.btn_BuyLattice),this.btn_BuyLattice.getComponent(y).interactable=!1;this.buyFieldFree||(this.text_LatticeCost.string=t.cost.toString())}},s.btn_ShopState=function(){},s.onLatticeChange=function(){this.btn_GridState(),this.btn_DrawState(),this.btn_ShopState()},s.onHeroBtnClick=function(){var t=F.ins.GetNextGeneralData(k.ins.CurrGeneralLevel);null!=t&&(k.ins.Coin<t.coinNum||(k.ins.ChangeGeneralLevel(),k.ins.PayOrAddCoin(t.coinNum,1)))},s.onGeneralLevelChange=function(){this.btn_GeneralBtnState()},s.onDoubeSpedBtn=function(){var t=a(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N.ins.showUI(V,!0);case 2:N.ins.OnMsg(V,!0);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),s.onDoubeCoinBtn=function(){var t=a(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N.ins.showUI(V,!0);case 2:N.ins.OnMsg(V,!1);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),s.UpdateGuideStage=function(){var t=this;if(K.ins.CurrStage===X.BATTLE_BUTTON){var e=F.ins.getLocalizationStr(U.D_Guide_Zero);K.ins.startCurStageGuide(1,this.fightBtn,e)}K.ins.CurrStage===X.SOLDIER_CARD&&(p("standByLayer/bottomBtns",this.node).getComponent(v).updateLayout(),this.scheduleOnce((function(){var e=F.ins.getLocalizationStr(U.D_Guide_Two);K.ins.startCurStageGuide(1,t.btn_Draw,e,t.btn_Draw.getWorldPosition().add(c(80,150)))})))},s.onGoldDrop=function(t,e){var n=this;Y.instance.camera.convertToUINode(t,this.node,Et);var i=this.addGoldNodePool.get();i||(i=L(this.addGoldPrefab)),this.node.addChild(i),i.setPosition(Et),i.getChildByName("Label").getComponent(h).string="+"+e,g(i.getComponent(m)).set({opacity:0}).to(.5,{opacity:255},{easing:B.backOut}).start(),g(i).set({scale:c(.6,.6,.6)}).to(.5,{position:c(Et.x,Et.y+100,Et.z)},{easing:B.backOut}).delay(.5).call((function(){g(i.getComponent(m)).to(.3,{opacity:0}).call((function(){i.getComponent(m).opacity=255,n.addGoldNodePool.put(i)})).start()})).start()},s.onShopBtn=function(){N.ins.showUI(Z,!0)},s.playCoinBurstEffect=function(t){this.CoinBurstEffect.walk((function(t){}),(function(t){t.getComponent(E).play()})),this.scheduleOnce((function(){k.ins.PayOrAddCoin(t,0)}),.8)},e}(D)).prefabUrl="HomeUI",ct=e((lt=Lt).prototype,"fightBtn",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=e(lt.prototype,"standByLayer",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ht=e(lt.prototype,"levelLabel",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=e(lt.prototype,"text_BattleCoin",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ct=e(lt.prototype,"btn_Hero",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bt=e(lt.prototype,"text_Average",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(lt.prototype,"btn_Options",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_t=e(lt.prototype,"doubleSpeedBtn",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gt=e(lt.prototype,"doubleCoinBtn",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=e(lt.prototype,"addGoldPrefab",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yt=e(lt.prototype,"btn_AddCoin",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vt=e(lt.prototype,"CoinBurstEffect",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=lt))||st));s._RF.pop()}}}));

System.register("chunks:///_virtual/Interface.ts",["cc"],(function(){"use strict";var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"7b301eFtvNIUbJ1cr7VOhj4","Interface",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/List.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env","./ListItem.ts"],(function(t){"use strict";var e,i,s,o,n,a,l,r,c,h,_,d,u,m,p,g,f,v,I,y,T,S,w,z,D,N,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,o=t.assertThisInitialized,n=t.createClass},function(t){a=t.cclegacy,l=t._decorator,r=t.ScrollView,c=t.Enum,h=t.Node,_=t.Prefab,d=t.CCFloat,u=t.EventHandler,m=t.CCBoolean,p=t.CCInteger,g=t.isValid,f=t.UITransform,v=t.Layout,I=t.instantiate,y=t.NodePool,T=t.Vec3,S=t.Size,w=t.Widget,z=t.tween,D=t.Component},function(t){N=t.DEV},function(t){b=t.default}],execute:function(){var E,P,L,G,C,O,R,A,U,B,k,M,x,V,F,H,X,Y,Z,W,j,q,J,K,Q,$,tt,et,it,st,ot,nt,at,lt,rt,ct,ht,_t,dt,ut,mt,pt,gt;a._RF.push({},"b57c3a+7odBI4F4rFlSBxFW","List",void 0);var ft,vt,It,yt=l.ccclass,Tt=l.property,St=l.disallowMultiple,wt=l.menu,zt=l.executionOrder,Dt=l.requireComponent;!function(t){t[t.NODE=1]="NODE",t[t.PREFAB=2]="PREFAB"}(ft||(ft={})),function(t){t[t.NORMAL=1]="NORMAL",t[t.ADHERING=2]="ADHERING",t[t.PAGE=3]="PAGE"}(vt||(vt={})),function(t){t[t.NONE=0]="NONE",t[t.SINGLE=1]="SINGLE",t[t.MULT=2]="MULT"}(It||(It={}));t("default",(E=St(),P=wt("List"),L=Dt(r),G=zt(-5e3),C=Tt({type:c(ft),tooltip:N}),O=Tt({type:h,tooltip:N,visible:function(){return this.templateType==ft.NODE}}),R=Tt({type:_,tooltip:N,visible:function(){return this.templateType==ft.PREFAB}}),A=Tt({}),U=Tt({type:c(vt),tooltip:N}),B=Tt({type:d,range:[0,1,.1],tooltip:N,slide:!0,visible:function(){return this._slideMode==vt.PAGE}}),k=Tt({type:u,tooltip:N,visible:function(){return this._slideMode==vt.PAGE}}),M=Tt({}),x=Tt({type:m,tooltip:N}),V=Tt({tooltip:N,visible:function(){var t=this.slideMode==vt.NORMAL;return t||(this.cyclic=!1),t}}),F=Tt({tooltip:N,visible:function(){return this.virtual}}),H=Tt({tooltip:N,visible:function(){var t=this.virtual&&!this.lackCenter;return t||(this.lackSlide=!1),t}}),X=Tt({type:p}),Y=Tt({type:p,range:[0,6,1],tooltip:N,slide:!0}),Z=Tt({type:p,range:[0,12,1],tooltip:N,slide:!0}),W=Tt({type:u,tooltip:N}),j=Tt({type:c(It),tooltip:N}),q=Tt({type:u,tooltip:N,visible:function(){return this.selectedMode>It.NONE}}),J=Tt({tooltip:N,visible:function(){return this.selectedMode==It.SINGLE}}),K=Tt({serializable:!1}),yt(Q=E(Q=P(Q=L(Q=G((tt=e(($=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return e=t.call.apply(t,[this].concat(n))||this,s(e,"templateType",tt,o(e)),s(e,"tmpNode",et,o(e)),s(e,"tmpPrefab",it,o(e)),s(e,"_slideMode",st,o(e)),s(e,"pageDistance",ot,o(e)),s(e,"pageChangeEvent",nt,o(e)),s(e,"_virtual",at,o(e)),s(e,"cyclic",lt,o(e)),s(e,"lackCenter",rt,o(e)),s(e,"lackSlide",ct,o(e)),s(e,"_updateRate",ht,o(e)),s(e,"frameByFrameRenderNum",_t,o(e)),s(e,"renderEvent",dt,o(e)),s(e,"selectedMode",ut,o(e)),s(e,"selectedEvent",mt,o(e)),s(e,"repeatEventSingle",pt,o(e)),e._selectedId=-1,e._lastSelectedId=void 0,e.multSelected=void 0,e._forceUpdate=!1,e._align=void 0,e._horizontalDir=void 0,e._verticalDir=void 0,e._startAxis=void 0,e._alignCalcType=void 0,e.content=void 0,e._contentUt=void 0,e.firstListId=void 0,e.displayItemNum=void 0,e._updateDone=!0,e._updateCounter=void 0,e._actualNumItems=void 0,e._cyclicNum=void 0,e._cyclicPos1=void 0,e._cyclicPos2=void 0,s(e,"_numItems",gt,o(e)),e._inited=!1,e._scrollView=void 0,e._layout=void 0,e._resizeMode=void 0,e._topGap=void 0,e._rightGap=void 0,e._bottomGap=void 0,e._leftGap=void 0,e._columnGap=void 0,e._lineGap=void 0,e._colLineNum=void 0,e._lastDisplayData=void 0,e.displayData=void 0,e._pool=void 0,e._itemTmp=void 0,e._itemTmpUt=void 0,e._needUpdateWidget=!1,e._itemSize=void 0,e._sizeType=void 0,e._customSize=void 0,e.frameCount=void 0,e._aniDelRuning=!1,e._aniDelCB=void 0,e._aniDelItem=void 0,e._aniDelBeforePos=void 0,e._aniDelBeforeScale=void 0,e.viewTop=void 0,e.viewRight=void 0,e.viewBottom=void 0,e.viewLeft=void 0,e._doneAfterUpdate=!1,e.elasticTop=void 0,e.elasticRight=void 0,e.elasticBottom=void 0,e.elasticLeft=void 0,e.scrollToListId=void 0,e.adhering=!1,e._adheringBarrier=!1,e.nearestListId=void 0,e.curPageNum=0,e._beganPos=void 0,e._scrollPos=void 0,e._curScrollIsTouch=void 0,e._scrollToListId=void 0,e._scrollToEndTime=void 0,e._scrollToSo=void 0,e._lack=void 0,e._allItemSize=void 0,e._allItemSizeNoEdge=void 0,e._scrollItem=void 0,e._thisNodeUt=void 0,e}i(e,t);var a=e.prototype;return a.onLoad=function(){this._init()},a.onDestroy=function(){var t=this;g(t._itemTmp)&&t._itemTmp.destroy(),g(t.tmpNode)&&t.tmpNode.destroy(),t._pool&&t._pool.clear()},a.onEnable=function(){this._registerEvent(),this._init(),this._aniDelRuning&&(this._aniDelRuning=!1,this._aniDelItem&&(this._aniDelBeforePos&&(this._aniDelItem.position=this._aniDelBeforePos,delete this._aniDelBeforePos),this._aniDelBeforeScale&&(this._aniDelItem.scale=this._aniDelBeforeScale,delete this._aniDelBeforeScale),delete this._aniDelItem),this._aniDelCB&&(this._aniDelCB(),delete this._aniDelCB))},a.onDisable=function(){this._unregisterEvent()},a._registerEvent=function(){var t=this;t.node.on(h.EventType.TOUCH_START,t._onTouchStart,t),t.node.on("touch-up",t._onTouchUp,t),t.node.on(h.EventType.TOUCH_CANCEL,t._onTouchCancelled,t),t.node.on("scroll-began",t._onScrollBegan,t),t.node.on("scroll-ended",t._onScrollEnded,t),t.node.on("scrolling",t._onScrolling,t),t.node.on(h.EventType.SIZE_CHANGED,t._onSizeChanged,t)},a._unregisterEvent=function(){var t=this;t.node.off(h.EventType.TOUCH_START,t._onTouchStart,t),t.node.off("touch-up",t._onTouchUp,t),t.node.off(h.EventType.TOUCH_CANCEL,t._onTouchCancelled,t),t.node.off("scroll-began",t._onScrollBegan,t),t.node.off("scroll-ended",t._onScrollEnded,t),t.node.off("scrolling",t._onScrolling,t),t.node.off(h.EventType.SIZE_CHANGED,t._onSizeChanged,t)},a._init=function(){var t=this;if(!t._inited)if(t._thisNodeUt=t.node.getComponent(f),t._scrollView=t.node.getComponent(r),t.content=t._scrollView.content,t._contentUt=t.content.getComponent(f),t.content){switch(t._layout=t.content.getComponent(v),t._align=t._layout.type,t._resizeMode=t._layout.resizeMode,t._startAxis=t._layout.startAxis,t._topGap=t._layout.paddingTop,t._rightGap=t._layout.paddingRight,t._bottomGap=t._layout.paddingBottom,t._leftGap=t._layout.paddingLeft,t._columnGap=t._layout.spacingX,t._lineGap=t._layout.spacingY,t._colLineNum,t._verticalDir=t._layout.verticalDirection,t._horizontalDir=t._layout.horizontalDirection,t.setTemplateItem(I(t.templateType==ft.PREFAB?t.tmpPrefab:t.tmpNode)),t._slideMode!=vt.ADHERING&&t._slideMode!=vt.PAGE||(t._scrollView.inertia=!1,t._scrollView._onMouseWheel=function(){}),t.virtual||(t.lackCenter=!1),t._lastDisplayData=[],t.displayData=[],t._pool=new y,t._forceUpdate=!1,t._updateCounter=0,t._updateDone=!0,t.curPageNum=0,t.cyclic&&(t._scrollView._processAutoScrolling=this._processAutoScrolling.bind(t),t._scrollView._startBounceBackIfNeeded=function(){return!1}),t._align){case v.Type.HORIZONTAL:switch(t._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:t._alignCalcType=1;break;case v.HorizontalDirection.RIGHT_TO_LEFT:t._alignCalcType=2}break;case v.Type.VERTICAL:switch(t._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:t._alignCalcType=3;break;case v.VerticalDirection.BOTTOM_TO_TOP:t._alignCalcType=4}break;case v.Type.GRID:switch(t._startAxis){case v.AxisDirection.HORIZONTAL:switch(t._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:t._alignCalcType=3;break;case v.VerticalDirection.BOTTOM_TO_TOP:t._alignCalcType=4}break;case v.AxisDirection.VERTICAL:switch(t._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:t._alignCalcType=1;break;case v.HorizontalDirection.RIGHT_TO_LEFT:t._alignCalcType=2}}}t.content.removeAllChildren(),t._inited=!0}else console.error(t.node.name+"'s ScrollView unset content!")},a._processAutoScrolling=function(t){var e=1e-4,i=new T,s=this._scrollView,o=s._isNecessaryAutoScrollBrake(),n=o?.05:1;s._autoScrollAccumulatedTime+=t*(1/n);var a,l=Math.min(1,s._autoScrollAccumulatedTime/s._autoScrollTotalTime);s._autoScrollAttenuate&&(a=l,l=(a-=1)*a*a*a*a+1);var c=s._autoScrollTargetDelta.clone();c.multiplyScalar(l);var h=s._autoScrollStartPosition.clone();h.add(c);var _=Math.abs(l-1)<=e;if(Math.abs(l-1)<=s.getScrollEndedEventTiming()&&!s._isScrollEndedWithThresholdEventFired&&(s._dispatchEvent(r.EventType.SCROLL_ENG_WITH_THRESHOLD),s._isScrollEndedWithThresholdEventFired=!0),s.elastic){var d=h.clone();d.subtract(s._autoScrollBrakingStartPosition),o&&d.multiplyScalar(n),h.set(s._autoScrollBrakingStartPosition),h.add(d)}else{var u=h.clone();u.subtract(s._getContentPosition());var m=s._getHowMuchOutOfBoundary(u);m.equals(i,e)||(h.add(m),_=!0)}_&&(s._autoScrolling=!1);var p=new T(h);p.subtract(s._getContentPosition()),s._clampDelta(p),s._moveContent(p,_),s._dispatchEvent(r.EventType.SCROLLING),s._autoScrolling||(s._isBouncing=!1,s._scrolling=!1,s._dispatchEvent(r.EventType.SCROLL_ENDED))},a.setTemplateItem=function(t){if(t){var e=this;if(e._itemTmp=t,e._itemTmpUt=t.getComponent(f),e._resizeMode==v.ResizeMode.CHILDREN)e._itemSize=e._layout.cellSize;else{var i=t.getComponent(f);e._itemSize=new S(i.width,i.height)}var s=t.getComponent(b),o=!1;switch(s||(o=!0),o&&(e.selectedMode=It.NONE),(s=t.getComponent(w))&&s.enabled&&(e._needUpdateWidget=!0),e.selectedMode==It.MULT&&(e.multSelected=[]),e._align){case v.Type.HORIZONTAL:e._colLineNum=1,e._sizeType=!1;break;case v.Type.VERTICAL:e._colLineNum=1,e._sizeType=!0;break;case v.Type.GRID:switch(e._startAxis){case v.AxisDirection.HORIZONTAL:var n=e._contentUt.width-e._leftGap-e._rightGap;e._colLineNum=Math.floor((n+e._columnGap)/(e._itemSize.width+e._columnGap)),e._sizeType=!0;break;case v.AxisDirection.VERTICAL:var a=e._contentUt.height-e._topGap-e._bottomGap;e._colLineNum=Math.floor((a+e._lineGap)/(e._itemSize.height+e._lineGap)),e._sizeType=!1}}}},a.checkInited=function(t){return void 0===t&&(t=!0),!!this._inited||(t&&console.error("List initialization not completed!"),!1)},a._resizeContent=function(){var t,e=this;switch(e._align){case v.Type.HORIZONTAL:if(e._customSize){var i=e._getFixedSize(null);t=e._leftGap+i.val+e._itemSize.width*(e._numItems-i.count)+e._columnGap*(e._numItems-1)+e._rightGap}else t=e._leftGap+e._itemSize.width*e._numItems+e._columnGap*(e._numItems-1)+e._rightGap;break;case v.Type.VERTICAL:if(e._customSize){var s=e._getFixedSize(null);t=e._topGap+s.val+e._itemSize.height*(e._numItems-s.count)+e._lineGap*(e._numItems-1)+e._bottomGap}else t=e._topGap+e._itemSize.height*e._numItems+e._lineGap*(e._numItems-1)+e._bottomGap;break;case v.Type.GRID:switch(e.lackCenter&&(e.lackCenter=!1),e._startAxis){case v.AxisDirection.HORIZONTAL:var o=Math.ceil(e._numItems/e._colLineNum);t=e._topGap+e._itemSize.height*o+e._lineGap*(o-1)+e._bottomGap;break;case v.AxisDirection.VERTICAL:var n=Math.ceil(e._numItems/e._colLineNum);t=e._leftGap+e._itemSize.width*n+e._columnGap*(n-1)+e._rightGap}}var a=e.content.getComponent(v);if(a&&(a.enabled=!1),e._allItemSize=t,e._allItemSizeNoEdge=e._allItemSize-(e._sizeType?e._topGap+e._bottomGap:e._leftGap+e._rightGap),e.cyclic){var l=e._sizeType?e._thisNodeUt.height:e._thisNodeUt.width;e._cyclicPos1=0,l-=e._cyclicPos1,e._cyclicNum=Math.ceil(l/e._allItemSizeNoEdge)+1;var r=e._sizeType?e._lineGap:e._columnGap;e._cyclicPos2=e._cyclicPos1+e._allItemSizeNoEdge+r,e._cyclicAllItemSize=e._allItemSize+e._allItemSizeNoEdge*(e._cyclicNum-1)+r*(e._cyclicNum-1),e._cycilcAllItemSizeNoEdge=e._allItemSizeNoEdge*e._cyclicNum,e._cycilcAllItemSizeNoEdge+=r*(e._cyclicNum-1)}e._lack=!e.cyclic&&e._allItemSize<(e._sizeType?e._thisNodeUt.height:e._thisNodeUt.width);var c=e._lack&&e.lackCenter||!e.lackSlide?.1:0,h=e._lack?(e._sizeType?e._thisNodeUt.height:e._thisNodeUt.width)-c:e.cyclic?e._cyclicAllItemSize:e._allItemSize;h<0&&(h=0),e._sizeType?e._contentUt.height=h:e._contentUt.width=h},a._onScrolling=function(t){if(void 0===t&&(t=null),null==this.frameCount&&(this.frameCount=this._updateRate),!this._forceUpdate&&t&&"scroll-ended"!=t.type&&this.frameCount>0)this.frameCount--;else if(this.frameCount=this._updateRate,!this._aniDelRuning){if(this.cyclic){var e=this.content.getPosition();e=this._sizeType?e.y:e.x;var i=this._allItemSizeNoEdge+(this._sizeType?this._lineGap:this._columnGap),s=this._sizeType?new T(0,i,0):new T(i,0,0),o=this.content.getPosition();switch(this._alignCalcType){case 1:e>-this._cyclicPos1?(o.set(-this._cyclicPos2,o.y,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.subtract(s))):e<-this._cyclicPos2&&(o.set(-this._cyclicPos1,o.y,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.add(s)));break;case 2:e<this._cyclicPos1?(o.set(this._cyclicPos2,o.y,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.add(s))):e>this._cyclicPos2&&(o.set(this._cyclicPos1,o.y,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.subtract(s)));break;case 3:e<this._cyclicPos1?(o.set(o.x,this._cyclicPos2,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.add(s))):e>this._cyclicPos2&&(o.set(o.x,this._cyclicPos1,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.subtract(s)));break;case 4:e>-this._cyclicPos1?(o.set(o.x,-this._cyclicPos2,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.subtract(s))):e<-this._cyclicPos2&&(o.set(o.x,-this._cyclicPos1,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.add(s)))}}var n,a,l,r;if(this._calcViewPos(),this._sizeType?(n=this.viewTop,l=this.viewBottom):(a=this.viewRight,r=this.viewLeft),this._virtual){var c;this.displayData=[];var h=0,_=this._numItems-1;if(this._customSize)for(var d=!1;h<=_&&!d;h++)switch(c=this._calcItemPos(h),this._align){case v.Type.HORIZONTAL:c.right>=r&&c.left<=a?this.displayData.push(c):0!=h&&this.displayData.length>0&&(d=!0);break;case v.Type.VERTICAL:c.bottom<=n&&c.top>=l?this.displayData.push(c):0!=h&&this.displayData.length>0&&(d=!0);break;case v.Type.GRID:switch(this._startAxis){case v.AxisDirection.HORIZONTAL:c.bottom<=n&&c.top>=l?this.displayData.push(c):0!=h&&this.displayData.length>0&&(d=!0);break;case v.AxisDirection.VERTICAL:c.right>=r&&c.left<=a?this.displayData.push(c):0!=h&&this.displayData.length>0&&(d=!0)}}else{var u=this._itemSize.width+this._columnGap,m=this._itemSize.height+this._lineGap;switch(this._alignCalcType){case 1:h=(r-this._leftGap)/u,_=(a-this._leftGap)/u;break;case 2:h=(-a-this._rightGap)/u,_=(-r-this._rightGap)/u;break;case 3:h=(-n-this._topGap)/m,_=(-l-this._topGap)/m;break;case 4:h=(l-this._bottomGap)/m,_=(n-this._bottomGap)/m}for(h=Math.floor(h)*this._colLineNum,_=Math.ceil(_)*this._colLineNum,h<0&&(h=0),--_>=this._numItems&&(_=this._numItems-1);h<=_;h++)this.displayData.push(this._calcItemPos(h))}if(this._delRedundantItem(),this.displayData.length<=0||!this._numItems)return void(this._lastDisplayData=[]);this.firstListId=this.displayData[0].id,this.displayItemNum=this.displayData.length;var p=this._lastDisplayData.length,g=this.displayItemNum!=p;if(g&&(this.frameByFrameRenderNum>0&&this._lastDisplayData.sort((function(t,e){return t-e})),g=this.firstListId!=this._lastDisplayData[0]||this.displayData[this.displayItemNum-1].id!=this._lastDisplayData[p-1]),this._forceUpdate||g)if(this.frameByFrameRenderNum>0)this._numItems>0?(this._updateDone?this._updateCounter=0:this._doneAfterUpdate=!0,this._updateDone=!1):(this._updateCounter=0,this._updateDone=!0);else{this._lastDisplayData=[];for(var f=0;f<this.displayItemNum;f++)this._createOrUpdateItem(this.displayData[f]);this._forceUpdate=!1}this._calcNearestItem()}}},a._calcViewPos=function(){var t=this.content.getPosition();switch(this._alignCalcType){case 1:this.elasticLeft=t.x>0?t.x:0,this.viewLeft=(t.x<0?-t.x:0)-this.elasticLeft,this.viewRight=this.viewLeft+this._thisNodeUt.width,this.elasticRight=this.viewRight>this._contentUt.width?Math.abs(this.viewRight-this._contentUt.width):0,this.viewRight+=this.elasticRight;break;case 2:this.elasticRight=t.x<0?-t.x:0,this.viewRight=(t.x>0?-t.x:0)+this.elasticRight,this.viewLeft=this.viewRight-this._thisNodeUt.width,this.elasticLeft=this.viewLeft<-this._contentUt.width?Math.abs(this.viewLeft+this._contentUt.width):0,this.viewLeft-=this.elasticLeft;break;case 3:this.elasticTop=t.y<0?Math.abs(t.y):0,this.viewTop=(t.y>0?-t.y:0)+this.elasticTop,this.viewBottom=this.viewTop-this._thisNodeUt.height,this.elasticBottom=this.viewBottom<-this._contentUt.height?Math.abs(this.viewBottom+this._contentUt.height):0,this.viewBottom+=this.elasticBottom;break;case 4:this.elasticBottom=t.y>0?Math.abs(t.y):0,this.viewBottom=(t.y<0?-t.y:0)-this.elasticBottom,this.viewTop=this.viewBottom+this._thisNodeUt.height,this.elasticTop=this.viewTop>this._contentUt.height?Math.abs(this.viewTop-this._contentUt.height):0,this.viewTop-=this.elasticTop}},a._calcItemPos=function(t){var e,i,s,o,n,a,l,r;switch(this._align){case v.Type.HORIZONTAL:switch(this._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:if(this._customSize){var c=this._getFixedSize(t);n=this._leftGap+(this._itemSize.width+this._columnGap)*(t-c.count)+(c.val+this._columnGap*c.count);var h=this._customSize[t];e=h>0?h:this._itemSize.width}else n=this._leftGap+(this._itemSize.width+this._columnGap)*t,e=this._itemSize.width;if(this.lackCenter)n-=this._leftGap,n+=this._contentUt.width/2-this._allItemSizeNoEdge/2;return{id:t,left:n,right:a=n+e,x:n+this._itemTmpUt.anchorX*e,y:this._itemTmp.y};case v.HorizontalDirection.RIGHT_TO_LEFT:if(this._customSize){var _=this._getFixedSize(t);a=-this._rightGap-(this._itemSize.width+this._columnGap)*(t-_.count)-(_.val+this._columnGap*_.count);var d=this._customSize[t];e=d>0?d:this._itemSize.width}else a=-this._rightGap-(this._itemSize.width+this._columnGap)*t,e=this._itemSize.width;if(this.lackCenter)a+=this._rightGap,a-=this._contentUt.width/2-this._allItemSizeNoEdge/2;return{id:t,right:a,left:n=a-e,x:n+this._itemTmpUt.anchorX*e,y:this._itemTmp.y}}break;case v.Type.VERTICAL:switch(this._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:if(this._customSize){var u=this._getFixedSize(t);s=-this._topGap-(this._itemSize.height+this._lineGap)*(t-u.count)-(u.val+this._lineGap*u.count);var m=this._customSize[t];i=m>0?m:this._itemSize.height}else s=-this._topGap-(this._itemSize.height+this._lineGap)*t,i=this._itemSize.height;if(this.lackCenter)s+=this._topGap,s-=this._contentUt.height/2-this._allItemSizeNoEdge/2;return{id:t,top:s,bottom:o=s-i,x:this._itemTmp.x,y:o+this._itemTmpUt.anchorY*i};case v.VerticalDirection.BOTTOM_TO_TOP:if(this._customSize){var p=this._getFixedSize(t);o=this._bottomGap+(this._itemSize.height+this._lineGap)*(t-p.count)+(p.val+this._lineGap*p.count);var g=this._customSize[t];i=g>0?g:this._itemSize.height}else o=this._bottomGap+(this._itemSize.height+this._lineGap)*t,i=this._itemSize.height;if(this.lackCenter)o-=this._bottomGap,o+=this._contentUt.height/2-this._allItemSizeNoEdge/2;return{id:t,top:s=o+i,bottom:o,x:this._itemTmp.x,y:o+this._itemTmpUt.anchorY*i}}case v.Type.GRID:var f=Math.floor(t/this._colLineNum);switch(this._startAxis){case v.AxisDirection.HORIZONTAL:switch(this._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:r=(o=(s=-this._topGap-(this._itemSize.height+this._lineGap)*f)-this._itemSize.height)+this._itemTmpUt.anchorY*this._itemSize.height;break;case v.VerticalDirection.BOTTOM_TO_TOP:s=(o=this._bottomGap+(this._itemSize.height+this._lineGap)*f)+this._itemSize.height,r=o+this._itemTmpUt.anchorY*this._itemSize.height}switch(l=this._leftGap+t%this._colLineNum*(this._itemSize.width+this._columnGap),this._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:l+=this._itemTmpUt.anchorX*this._itemSize.width,l-=this._contentUt.anchorX*this._contentUt.width;break;case v.HorizontalDirection.RIGHT_TO_LEFT:l+=(1-this._itemTmpUt.anchorX)*this._itemSize.width,l-=(1-this._contentUt.anchorX)*this._contentUt.width,l*=-1}return{id:t,top:s,bottom:o,x:l,y:r};case v.AxisDirection.VERTICAL:switch(this._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:a=(n=this._leftGap+(this._itemSize.width+this._columnGap)*f)+this._itemSize.width,l=n+this._itemTmpUt.anchorX*this._itemSize.width,l-=this._contentUt.anchorX*this._contentUt.width;break;case v.HorizontalDirection.RIGHT_TO_LEFT:l=(n=(a=-this._rightGap-(this._itemSize.width+this._columnGap)*f)-this._itemSize.width)+this._itemTmpUt.anchorX*this._itemSize.width,l+=(1-this._contentUt.anchorX)*this._contentUt.width}switch(r=-this._topGap-t%this._colLineNum*(this._itemSize.height+this._lineGap),this._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:r-=(1-this._itemTmpUt.anchorY)*this._itemSize.height,r+=(1-this._contentUt.anchorY)*this._contentUt.height;break;case v.VerticalDirection.BOTTOM_TO_TOP:r-=this._itemTmpUt.anchorY*this._itemSize.height,r+=this._contentUt.anchorY*this._contentUt.height,r*=-1}return{id:t,left:n,right:a,x:l,y:r}}}},a._calcExistItemPos=function(t){var e=this.getItemByListId(t);if(!e)return null;var i=e.getComponent(f),s=e.getPosition(),o={id:t,x:s.x,y:s.y};return this._sizeType?(o.top=s.y+i.height*(1-i.anchorY),o.bottom=s.y-i.height*i.anchorY):(o.left=s.x-i.width*i.anchorX,o.right=s.x+i.width*(1-i.anchorX)),o},a.getItemPos=function(t){return this._virtual||this.frameByFrameRenderNum?this._calcItemPos(t):this._calcExistItemPos(t)},a._getFixedSize=function(t){if(!this._customSize)return null;null==t&&(t=this._numItems);var e=0,i=0;for(var s in this._customSize)parseInt(s)<t&&(e+=this._customSize[s],i++);return{val:e,count:i}},a._onScrollBegan=function(){this._beganPos=this._sizeType?this.viewTop:this.viewLeft},a._onScrollEnded=function(){var t=this;if(t._curScrollIsTouch=!1,null!=t.scrollToListId){var e=t.getItemByListId(t.scrollToListId);t.scrollToListId=null,e&&z(e).to(.1,{scale:1.06}).to(.1,{scale:1}).start()}t._onScrolling(),t._slideMode!=vt.ADHERING||t.adhering?t._slideMode==vt.PAGE&&(null!=t._beganPos&&t._curScrollIsTouch?this._pageAdhere():t.adhere()):t.adhere()},a._onTouchStart=function(t,e){if(!this._scrollView._hasNestedViewGroup(t,e)&&(this._curScrollIsTouch=!0,!(t.eventPhase===Event.AT_TARGET&&t.target===this.node))){for(var i=t.target;null==i._listId&&i.parent;)i=i.parent;this._scrollItem=null!=i._listId?i:t.target}},a._onTouchUp=function(){var t=this;t._scrollPos=null,t._slideMode==vt.ADHERING?(this.adhering&&(this._adheringBarrier=!0),t.adhere()):t._slideMode==vt.PAGE&&(null!=t._beganPos?this._pageAdhere():t.adhere()),this._scrollItem=null},a._onTouchCancelled=function(t,e){var i=this;i._scrollView._hasNestedViewGroup(t,e)||t.simulate||(i._scrollPos=null,i._slideMode==vt.ADHERING?(i.adhering&&(i._adheringBarrier=!0),i.adhere()):i._slideMode==vt.PAGE&&(null!=i._beganPos?i._pageAdhere():i.adhere()),this._scrollItem=null)},a._onSizeChanged=function(){this.checkInited(!1)&&this._onScrolling()},a._onItemAdaptive=function(t){var e=t.getComponent(f);if(!this._sizeType&&e.width!=this._itemSize.width||this._sizeType&&e.height!=this._itemSize.height){this._customSize||(this._customSize={});var i=this._sizeType?e.height:e.width;this._customSize[t._listId]!=i&&(this._customSize[t._listId]=i,this._resizeContent(),this.updateAll(),null!=this._scrollToListId&&(this._scrollPos=null,this.unschedule(this._scrollToSo),this.scrollTo(this._scrollToListId,Math.max(0,this._scrollToEndTime-(new Date).getTime()/1e3))))}},a._pageAdhere=function(){var t=this;if(t.cyclic||!(t.elasticTop>0||t.elasticRight>0||t.elasticBottom>0||t.elasticLeft>0)){var e=t._sizeType?t.viewTop:t.viewLeft,i=(t._sizeType?t._thisNodeUt.height:t._thisNodeUt.width)*t.pageDistance;if(Math.abs(t._beganPos-e)>i){var s=.5;switch(t._alignCalcType){case 1:case 4:t._beganPos>e?t.prePage(s):t.nextPage(s);break;case 2:case 3:t._beganPos<e?t.prePage(s):t.nextPage(s)}}else t.elasticTop<=0&&t.elasticRight<=0&&t.elasticBottom<=0&&t.elasticLeft<=0&&t.adhere();t._beganPos=null}},a.adhere=function(){var t=this;if(t.checkInited()&&!(t.elasticTop>0||t.elasticRight>0||t.elasticBottom>0||t.elasticLeft>0)){t.adhering=!0,t._calcNearestItem();var e=(t._sizeType?t._topGap:t._leftGap)/(t._sizeType?t._thisNodeUt.height:t._thisNodeUt.width);t.scrollTo(t.nearestListId,.7,e)}},a.update=function(){if(!(this.frameByFrameRenderNum<=0||this._updateDone))if(this._virtual){for(var t=this._updateCounter+this.frameByFrameRenderNum>this.displayItemNum?this.displayItemNum:this._updateCounter+this.frameByFrameRenderNum,e=this._updateCounter;e<t;e++){var i=this.displayData[e];i&&this._createOrUpdateItem(i)}this._updateCounter>=this.displayItemNum-1?this._doneAfterUpdate?(this._updateCounter=0,this._updateDone=!1,this._doneAfterUpdate=!1):(this._updateDone=!0,this._delRedundantItem(),this._forceUpdate=!1,this._calcNearestItem(),this.slideMode==vt.PAGE&&(this.curPageNum=this.nearestListId)):this._updateCounter+=this.frameByFrameRenderNum}else if(this._updateCounter<this._numItems){for(var s=this._updateCounter+this.frameByFrameRenderNum>this._numItems?this._numItems:this._updateCounter+this.frameByFrameRenderNum,o=this._updateCounter;o<s;o++)this._createOrUpdateItem2(o);this._updateCounter+=this.frameByFrameRenderNum}else this._updateDone=!0,this._calcNearestItem(),this.slideMode==vt.PAGE&&(this.curPageNum=this.nearestListId)},a._createOrUpdateItem=function(t){var e=this.getItemByListId(t.id);if(e)this._forceUpdate&&this.renderEvent&&(e.setPosition(new T(t.x,t.y,0)),this._resetItemSize(e),this.renderEvent&&u.emitEvents([this.renderEvent],e,t.id%this._actualNumItems));else{var i=this._pool.size()>0;if(e=i?this._pool.get():I(this._itemTmp),i&&g(e)||(e=I(this._itemTmp),i=!1),e._listId!=t.id)e._listId=t.id,e.getComponent(f).setContentSize(this._itemSize);if(e.setPosition(new T(t.x,t.y,0)),this._resetItemSize(e),this.content.addChild(e),i&&this._needUpdateWidget){var s=e.getComponent(w);s&&s.updateAlignment()}e.setSiblingIndex(this.content.children.length-1);var o=e.getComponent(b);e.listItem=o,o&&(o.listId=t.id,o.list=this,o._registerEvent()),this.renderEvent&&u.emitEvents([this.renderEvent],e,t.id%this._actualNumItems)}this._resetItemSize(e),this._updateListItem(e.listItem),this._lastDisplayData.indexOf(t.id)<0&&this._lastDisplayData.push(t.id)},a._createOrUpdateItem2=function(t){var e,i=this.content.children[t];i?this._forceUpdate&&this.renderEvent&&(i._listId=t,e&&(e.listId=t),this.renderEvent&&u.emitEvents([this.renderEvent],i,t%this._actualNumItems)):((i=I(this._itemTmp))._listId=t,this.content.addChild(i),e=i.getComponent(b),i.listItem=e,e&&(e.listId=t,e.list=this,e._registerEvent()),this.renderEvent&&u.emitEvents([this.renderEvent],i,t%this._actualNumItems)),this._updateListItem(e),this._lastDisplayData.indexOf(t)<0&&this._lastDisplayData.push(t)},a._updateListItem=function(t){if(t&&this.selectedMode>It.NONE){var e=t.node;switch(this.selectedMode){case It.SINGLE:t.selected=this.selectedId==e._listId;break;case It.MULT:t.selected=this.multSelected.indexOf(e._listId)>=0}}},a._resetItemSize=function(t){},a._updateItemPos=function(t){var e=isNaN(t)?t:this.getItemByListId(t),i=this.getItemPos(e._listId);e.setPosition(i.x,i.y)},a.setMultSelected=function(t,e){var i=this;if(i.checkInited()){var s,o;if(Array.isArray(t)||(t=[t]),null==e)i.multSelected=t;else if(e)for(var n=t.length-1;n>=0;n--)s=t[n],(o=i.multSelected.indexOf(s))<0&&i.multSelected.push(s);else for(var a=t.length-1;a>=0;a--)s=t[a],(o=i.multSelected.indexOf(s))>=0&&i.multSelected.splice(o,1);i._forceUpdate=!0,i._onScrolling()}},a.getMultSelected=function(){return this.multSelected},a.hasMultSelected=function(t){return this.multSelected&&this.multSelected.indexOf(t)>=0},a.updateItem=function(t){if(this.checkInited()){Array.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++){var s=t[e],o=this.getItemByListId(s);o&&u.emitEvents([this.renderEvent],o,s%this._actualNumItems)}}},a.updateAll=function(){this.checkInited()&&(this.numItems=this.numItems)},a.getItemByListId=function(t){if(this.content)for(var e=this.content.children.length-1;e>=0;e--){var i=this.content.children[e];if(i._listId==t)return i}},a._getOutsideItem=function(){for(var t,e=[],i=this.content.children.length-1;i>=0;i--)t=this.content.children[i],this.displayData.find((function(e){return e.id==t._listId}))||e.push(t);return e},a._delRedundantItem=function(){if(this._virtual)for(var t=this._getOutsideItem(),e=t.length-1;e>=0;e--){var i=t[e];if(!this._scrollItem||i._listId!=this._scrollItem._listId){i.isCached=!0,this._pool.put(i);for(var s=this._lastDisplayData.length-1;s>=0;s--)if(this._lastDisplayData[s]==i._listId){this._lastDisplayData.splice(s,1);break}}}else for(;this.content.children.length>this._numItems;)this._delSingleItem(this.content.children[this.content.children.length-1])},a._delSingleItem=function(t){t.removeFromParent(),t.destroy&&t.destroy(),t=null},a.aniDelItem=function(t,e,i){var s=this;if(!s.checkInited()||s.cyclic||!s._virtual)return console.error("This function is not allowed to be called!");if(!e)return console.error("CallFunc are not allowed to be NULL, You need to delete the corresponding index in the data array in the CallFunc!");if(s._aniDelRuning)return console.warn("Please wait for the current deletion to finish!");var o,n=s.getItemByListId(t);if(n){o=n.getComponent(b),s._aniDelRuning=!0,s._aniDelCB=e,s._aniDelItem=n,s._aniDelBeforePos=n.position,s._aniDelBeforeScale=n.scale;var a=s.displayData[s.displayData.length-1].id,l=o.selected;o.showAni(i,(function(){var i;if(a<s._numItems-2&&(i=a+1),null!=i){var o=s._calcItemPos(i);s.displayData.push(o),s._virtual?s._createOrUpdateItem(o):s._createOrUpdateItem2(i)}else s._numItems--;if(s.selectedMode==It.SINGLE)l?s._selectedId=-1:s._selectedId-1>=0&&s._selectedId--;else if(s.selectedMode==It.MULT&&s.multSelected.length){var r=s.multSelected.indexOf(t);r>=0&&s.multSelected.splice(r,1);for(var c=s.multSelected.length-1;c>=0;c--){s.multSelected[c]>=t&&s.multSelected[c]--}}if(s._customSize){s._customSize[t]&&delete s._customSize[t];var h,_={};for(var d in s._customSize){h=s._customSize[d];var u=parseInt(d);_[u-(u>=t?1:0)]=h}s._customSize=_}for(var m,p,g=null!=i?i:a;g>=t+1;g--)if(n=s.getItemByListId(g)){var f=s._calcItemPos(g-1);m=z(n).to(.2333,{position:new T(f.x,f.y,0)}),g<=t+1&&(p=!0,m.call((function(){s._aniDelRuning=!1,e(t),delete s._aniDelCB}))),m.start()}p||(s._aniDelRuning=!1,e(t),s._aniDelCB=null)}),!0)}else e(t)},a.scrollTo=function(t,e,i,s){void 0===e&&(e=.5),void 0===i&&(i=null),void 0===s&&(s=!1);var o=this;if(o.checkInited(!1)){null==e?e=.5:e<0&&(e=0),t<0?t=0:t>=o._numItems&&(t=o._numItems-1),!o._virtual&&o._layout&&o._layout.enabled&&o._layout.updateLayout();var n,a,l=o.getItemPos(t);if(!l)return N;switch(o._alignCalcType){case 1:n=l.left,n-=null!=i?o._thisNodeUt.width*i:o._leftGap,l=new T(n,0,0);break;case 2:n=l.right-o._thisNodeUt.width,n+=null!=i?o._thisNodeUt.width*i:o._rightGap,l=new T(n+o._contentUt.width,0,0);break;case 3:a=l.top,a+=null!=i?o._thisNodeUt.height*i:o._topGap,l=new T(0,-a,0);break;case 4:a=l.bottom+o._thisNodeUt.height,a-=null!=i?o._thisNodeUt.height*i:o._bottomGap,l=new T(0,-a+o._contentUt.height,0)}var r=o.content.getPosition();r=Math.abs(o._sizeType?r.y:r.x);var c=o._sizeType?l.y:l.x;Math.abs((null!=o._scrollPos?o._scrollPos:r)-c)>.5&&(o._scrollView.scrollToOffset(l,e),o._scrollToListId=t,o._scrollToEndTime=(new Date).getTime()/1e3+e,o._scrollToSo=o.scheduleOnce((function(){if(o._adheringBarrier||(o.adhering=o._adheringBarrier=!1),o._scrollPos=o._scrollToListId=o._scrollToEndTime=o._scrollToSo=null,s){var e=o.getItemByListId(t);e&&z(e).to(.1,{scale:1.05}).to(.1,{scale:1}).start()}}),e+.1),e<=0&&o._onScrolling())}},a._calcNearestItem=function(){var t,e,i,s,o,n,a=this;a.nearestListId=null,a._virtual&&a._calcViewPos(),i=a.viewTop,s=a.viewRight,o=a.viewBottom,n=a.viewLeft;for(var l=!1,r=0;r<a.content.children.length&&!l;r+=a._colLineNum)if(t=a._virtual?a.displayData[r]:a._calcExistItemPos(r))switch(e=a._sizeType?(t.top+t.bottom)/2:e=(t.left+t.right)/2,a._alignCalcType){case 1:t.right>=n&&(a.nearestListId=t.id,n>e&&(a.nearestListId+=a._colLineNum),l=!0);break;case 2:t.left<=s&&(a.nearestListId=t.id,s<e&&(a.nearestListId+=a._colLineNum),l=!0);break;case 3:t.bottom<=i&&(a.nearestListId=t.id,i<e&&(a.nearestListId+=a._colLineNum),l=!0);break;case 4:t.top>=o&&(a.nearestListId=t.id,o>e&&(a.nearestListId+=a._colLineNum),l=!0)}if((t=a._virtual?a.displayData[a.displayItemNum-1]:a._calcExistItemPos(a._numItems-1))&&t.id==a._numItems-1)switch(e=a._sizeType?(t.top+t.bottom)/2:e=(t.left+t.right)/2,a._alignCalcType){case 1:s>e&&(a.nearestListId=t.id);break;case 2:n<e&&(a.nearestListId=t.id);break;case 3:o<e&&(a.nearestListId=t.id);break;case 4:i>e&&(a.nearestListId=t.id)}},a.prePage=function(t){void 0===t&&(t=.5),this.checkInited()&&this.skipPage(this.curPageNum-1,t)},a.nextPage=function(t){void 0===t&&(t=.5),this.checkInited()&&this.skipPage(this.curPageNum+1,t)},a.skipPage=function(t,e){var i=this;if(i.checkInited())return i._slideMode!=vt.PAGE?console.error("This function is not allowed to be called, Must SlideMode = PAGE!"):void(t<0||t>=i._numItems||i.curPageNum!=t&&(i.curPageNum=t,i.pageChangeEvent&&u.emitEvents([i.pageChangeEvent],t),i.scrollTo(t,e)))},a.calcCustomSize=function(t){var e=this;if(e.checkInited()){if(!e._itemTmp)return console.error("Unset template item!");if(!e.renderEvent)return console.error("Unset Render-Event!");e._customSize={};var i=I(e._itemTmp),s=i.getComponent(f);e.content.addChild(i);for(var o=0;o<t;o++)u.emitEvents([e.renderEvent],i,o),s.height==e._itemSize.height&&s.width==e._itemSize.width||(e._customSize[o]=e._sizeType?s.height:s.width);return Object.keys(e._customSize).length||(e._customSize=null),i.removeFromParent(),i.destroy&&i.destroy(),e._customSize}},n(e,[{key:"slideMode",get:function(){return this._slideMode},set:function(t){this._slideMode=t}},{key:"virtual",get:function(){return this._virtual},set:function(t){null!=t&&(this._virtual=t),0!=this._numItems&&this._onScrolling()}},{key:"updateRate",get:function(){return this._updateRate},set:function(t){t>=0&&t<=6&&(this._updateRate=t)}},{key:"selectedId",get:function(){return this._selectedId},set:function(t){var e,i=this;switch(i.selectedMode){case It.SINGLE:if(!i.repeatEventSingle&&t==i._selectedId)return;if(e=i.getItemByListId(t),i._selectedId>=0?i._lastSelectedId=i._selectedId:i._lastSelectedId=null,i._selectedId=t,e&&(e.getComponent(b).selected=!0),i._lastSelectedId>=0&&i._lastSelectedId!=i._selectedId){var s=i.getItemByListId(i._lastSelectedId);s&&(s.getComponent(b).selected=!1)}i.selectedEvent&&u.emitEvents([i.selectedEvent],e,t%this._actualNumItems,null==i._lastSelectedId?null:i._lastSelectedId%this._actualNumItems);break;case It.MULT:if(!(e=i.getItemByListId(t)))return;var o=e.getComponent(b);i._selectedId>=0&&(i._lastSelectedId=i._selectedId),i._selectedId=t;var n=!o.selected;o.selected=n;var a=i.multSelected.indexOf(t);n&&a<0?i.multSelected.push(t):!n&&a>=0&&i.multSelected.splice(a,1),i.selectedEvent&&u.emitEvents([i.selectedEvent],e,t%this._actualNumItems,null==i._lastSelectedId?null:i._lastSelectedId%this._actualNumItems,n)}}},{key:"numItems",get:function(){return this._actualNumItems},set:function(t){var e=this;if(e.checkInited(!1))if(null==t||t<0)console.error("numItems set the wrong::",t);else if(e._actualNumItems=e._numItems=t,e._forceUpdate=!0,e._virtual)e._resizeContent(),e.cyclic&&(e._numItems=e._cyclicNum*e._numItems),e._onScrolling(),e.frameByFrameRenderNum||e.slideMode!=vt.PAGE||(e.curPageNum=e.nearestListId);else{e.cyclic&&(e._resizeContent(),e._numItems=e._cyclicNum*e._numItems);var i=e.content.getComponent(v);if(i&&(i.enabled=!0),e._delRedundantItem(),e.firstListId=0,e.frameByFrameRenderNum>0){for(var s=e.frameByFrameRenderNum>e._numItems?e._numItems:e.frameByFrameRenderNum,o=0;o<s;o++)e._createOrUpdateItem2(o);e.frameByFrameRenderNum<e._numItems&&(e._updateCounter=e.frameByFrameRenderNum,e._updateDone=!1)}else{for(var n=0;n<e._numItems;n++)e._createOrUpdateItem2(n);e.displayItemNum=e._numItems}}}},{key:"scrollView",get:function(){return this._scrollView}}]),e}(D)).prototype,"templateType",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ft.NODE}}),et=e($.prototype,"tmpNode",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e($.prototype,"tmpPrefab",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e($.prototype,"_slideMode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vt.NORMAL}}),e($.prototype,"slideMode",[U],Object.getOwnPropertyDescriptor($.prototype,"slideMode"),$.prototype),ot=e($.prototype,"pageDistance",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),nt=e($.prototype,"pageChangeEvent",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u}}),at=e($.prototype,"_virtual",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),e($.prototype,"virtual",[x],Object.getOwnPropertyDescriptor($.prototype,"virtual"),$.prototype),lt=e($.prototype,"cyclic",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rt=e($.prototype,"lackCenter",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ct=e($.prototype,"lackSlide",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ht=e($.prototype,"_updateRate",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),e($.prototype,"updateRate",[Y],Object.getOwnPropertyDescriptor($.prototype,"updateRate"),$.prototype),_t=e($.prototype,"frameByFrameRenderNum",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dt=e($.prototype,"renderEvent",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u}}),ut=e($.prototype,"selectedMode",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return It.NONE}}),mt=e($.prototype,"selectedEvent",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u}}),pt=e($.prototype,"repeatEventSingle",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gt=e($.prototype,"_numItems",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Q=$))||Q)||Q)||Q)||Q)||Q));a._RF.pop()}}}));

System.register("chunks:///_virtual/ListItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env"],(function(e){"use strict";var t,i,n,o,s,r,l,a,c,u,d,p,h,f,m,b,g,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,s=e.createClass},function(e){r=e.cclegacy,l=e._decorator,a=e.Sprite,c=e.Node,u=e.Enum,d=e.SpriteFrame,p=e.EventHandler,h=e.UITransform,f=e.tween,m=e.Vec3,b=e.Button,g=e.Component},function(e){v=e.DEV}],execute:function(){var y,C,_,w,S,E,F,I,z,N,T,k,D,H,L,M,G;r._RF.push({},"2ab145PCVtBFaFPxi638Uom","ListItem",void 0);var O,A=l.ccclass,R=l.property,W=l.disallowMultiple,P=l.menu,V=l.executionOrder;!function(e){e[e.NONE=0]="NONE",e[e.TOGGLE=1]="TOGGLE",e[e.SWITCH=2]="SWITCH"}(O||(O={}));e("default",(y=W(),C=P("List Item"),_=V(-5001),w=R({type:a,tooltip:v}),S=R({type:c,tooltip:v}),E=R({type:u(O),tooltip:v}),F=R({type:c,tooltip:v,visible:function(){return this.selectedMode>O.NONE}}),I=R({type:d,tooltip:v,visible:function(){return this.selectedMode==O.SWITCH}}),z=R({tooltip:v}),A(N=y(N=C(N=_((k=t((T=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return t=e.call.apply(e,[this].concat(s))||this,n(t,"icon",k,o(t)),n(t,"title",D,o(t)),n(t,"selectedMode",H,o(t)),n(t,"selectedFlag",L,o(t)),n(t,"selectedSpriteFrame",M,o(t)),t._unselectedSpriteFrame=null,n(t,"adaptiveSize",G,o(t)),t._selected=!1,t._btnCom=void 0,t.list=void 0,t._eventReg=!1,t.listId=void 0,t}i(t,e);var r=t.prototype;return r.onLoad=function(){if(this.selectedMode==O.SWITCH){var e=this.selectedFlag.getComponent(a);this._unselectedSpriteFrame=e.spriteFrame}},r.onDestroy=function(){this.node.off(c.EventType.SIZE_CHANGED,this._onSizeChange,this)},r._registerEvent=function(){this._eventReg||(this.btnCom&&this.list.selectedMode>0&&this.btnCom.clickEvents.unshift(this.createEvt(this,"onClickThis")),this.adaptiveSize&&this.node.on(c.EventType.SIZE_CHANGED,this._onSizeChange,this),this._eventReg=!0)},r._onSizeChange=function(){this.list._onItemAdaptive(this.node)},r.createEvt=function(e,t,i){if(void 0===i&&(i=null),e.isValid){e.comName=e.comName||e.name.match(/\<(.*?)\>/g).pop().replace(/\<|>/g,"");var n=new p;return n.target=i||e.node,n.component=e.comName,n.handler=t,n}},r.showAni=function(e,t,i){var n,o=this,s=o.node.getComponent(h);switch(e){case 0:n=f(o.node).to(.2,{scale:new m(.7,.7)}).by(.3,{position:new m(0,2*s.height)});break;case 1:n=f(o.node).to(.2,{scale:new m(.7,.7)}).by(.3,{position:new m(2*s.width,0)});break;case 2:n=f(o.node).to(.2,{scale:new m(.7,.7)}).by(.3,{position:new m(0,-2*s.height)});break;case 3:n=f(o.node).to(.2,{scale:new m(.7,.7)}).by(.3,{position:new m(-2*s.width,0)});break;default:n=f(o.node).to(.3,{scale:new m(.1,.1)})}(t||i)&&n.call((function(){if(i){o.list._delSingleItem(o.node);for(var e=o.list.displayData.length-1;e>=0;e--)if(o.list.displayData[e].id==o.listId){o.list.displayData.splice(e,1);break}}t()})),n.start()},r.onClickThis=function(){this.list.selectedId=this.listId},s(t,[{key:"selected",get:function(){return this._selected},set:function(e){if(this._selected=e,this.selectedFlag)switch(this.selectedMode){case O.TOGGLE:this.selectedFlag.active=e;break;case O.SWITCH:var t=this.selectedFlag.getComponent(a);t&&(t.spriteFrame=e?this.selectedSpriteFrame:this._unselectedSpriteFrame)}}},{key:"btnCom",get:function(){return this._btnCom||(this._btnCom=this.node.getComponent(b)),this._btnCom}}]),t}(g)).prototype,"icon",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(T.prototype,"title",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(T.prototype,"selectedMode",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return O.NONE}}),L=t(T.prototype,"selectedFlag",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(T.prototype,"selectedSpriteFrame",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(T.prototype,"adaptiveSize",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),N=T))||N)||N)||N)||N));r._RF.pop()}}}));

System.register("chunks:///_virtual/loading.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UIManager.ts"],(function(e){"use strict";var n,t,i,o,a,r,l,c,u,s,p;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,l=e.Node},function(e){c=e.LayerType,u=e.PopType,s=e.BaseUI},function(e){p=e.default}],execute:function(){var d,f,h,g,y,b;a._RF.push({},"c596fvM6OdI3rMwIjwM67mp","loading",void 0);var v=r.ccclass,m=r.property;e("default",(d=v("loading"),f=m(l),d(((b=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(n=e.call.apply(e,[this].concat(a))||this).m_layerType=c.topMost,n.m_PopType=u.No,i(n,"loadingNode",y,o(n)),n}t(n,e);var a=n.prototype;return a.onEnable=function(){this.unscheduleAllCallbacks(),this.scheduleOnce(this.timeOutFunc,15)},a.onDisable=function(){this.unscheduleAllCallbacks()},a.timeOutFunc=function(){p.ins.hideLoading(!0)},a.update=function(e){this.loadingNode.angle-=400*e},n}(s)).prefabUrl="loading",y=n((g=b).prototype,"loadingNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=g))||h));a._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var n,r,o,i,t,a,l,c,s,u;return{setters:[function(e){n=e.applyDecoratedDescriptor,r=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){t=e.cclegacy,a=e._decorator,l=e.Node,c=e.Label,s=e.director,u=e.Component}],execute:function(){var d,g,p,f,h,y,b;t._RF.push({},"0bf341YLepMqpeXlBD9hrlQ","LoadingUI",void 0);var v=a.ccclass,L=a.property;e("LoadingUI",(d=v("LoadingUI"),g=L(l),p=L(c),d((y=n((h=function(e){function n(){for(var n,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return n=e.call.apply(e,[this].concat(t))||this,o(n,"loadingNode",y,i(n)),o(n,"loadingProgress",b,i(n)),n}r(n,e);var t=n.prototype;return t.start=function(){var e=this;s.preloadScene("game",(function(n,r,o){e.loadingProgress.string="loading "+Math.floor(n/r*100)+"%"}),(function(e,n){s.loadScene("game")}))},t.update=function(e){this.loadingNode.angle-=400*e},n}(u)).prototype,"loadingNode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=n(h.prototype,"loadingProgress",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=h))||f));t._RF.pop()}}}));

System.register("chunks:///_virtual/LocalStorageMgr.ts",["cc"],(function(e){"use strict";var t,E;return{setters:[function(e){t=e.cclegacy,E=e.sys}],execute:function(){var r,i,A;e("LocalStorageMgr",void 0),t._RF.push({},"e5dd5hYpVFMoK79G5KjQMsM","LocalStorageMgr",void 0),i=r||(r=e("LocalStorageMgr",{})),function(e){e.COIN="COIN",e.GK="GK",e.LATTICE="LATTICE",e.GENERAL_LEVEL="GENERAL_LEVEL",e.SOLDIERS="SOLDIERS",e.CARD="CARD",e.SOUND="SOUND",e.SHAKE="SHAKE",e.LANGUAGE="LANGUAGE",e.Unlock_Soldiers="CurrUnlockSoldiers",e.Soldier_Cache="Soldier_Cache",e.CurrAtrributeTask="CurrAtrributeTask",e.DailySelectionList="DailySelectionList",e.DailyRefreshTime="DailyRefreshTime",e.Version="Version",e.DoubleCoinTime="DoubleCoinTime",e.AchievementList="AchievementList",e.GUIDESTAGE="gust",e.GUIDE_SHOPPING="g-s",e.GUIDE_SPECIALMAP="specialmap",e.GUIDE_OPEN_FIELD="g-o-f",e.LAST_DEFEAT="last-defeat",e.COUNT_SOLDIER_UPGRADE="c_s_u",e.COUNT_BUY_FIELD="c-b-fi",e.IS_DOUBLE_AT_SPEED="IS_DOUBLE_AT_SPEED",e.SPECIALMAP_LEVEL="SPACIALMAP_LEVEL",e.SPECIALCHECKED="SPECIALCHECKED",e.Is_FirstGetBoxAward="Is_FirstGetBoxAward",e.FirstBoxAwardShowTime="FirstBoxAwardShowTime",e.JADE="JADE",e.JADEProduceState_Soldier="JADE_PRODUCE_STATE_SOLDIER",e.JADEProduceState_Property="JADEPRODUCESTATE_PROPERTY",e.JADE_REFRESH_TIME="JADE_REFRESH_TIME",e.AltarAttributeList="AltarAttributeList",e.TeachAltarTime="TeachAltarTime",e.LevelUpCard="LevelUpCard",e.Guide_Temple="Guide_Temple"}(A||(A={})),i.SaveDataEnum=A,i.setItem=function(e,t){E.localStorage.setItem(e,t)},i.getItem=function(e){return E.localStorage.getItem(e)},i.clear=function(){E.localStorage.clear()},t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./U3dParticle2Cocos.ts","./AdEvent.ts","./CameraCtrl.ts","./LocalStorageMgr.ts","./Main.ts","./NodeLayers.ts","./QuadTree.ts","./TimeUtil.ts","./Utils.ts","./AItemRenerer.ts","./AVirtualScrollView.ts","./List.ts","./ListItem.ts","./NestableScrollView_Inner.ts","./NestableScrollView_Outer.ts","./EventDispatcher.ts","./EventType.ts","./BattleArrow.ts","./BuffUtil.ts","./EnemyMapController.ts","./EnmyMapClass.ts","./Entity.ts","./EntityAnim.ts","./EntityProperty.ts","./FormationGrid.ts","./PlayerFormationMgr.ts","./SoldierDrag.ts","./SoldierLatticeModel.ts","./GameController.ts","./GameData.ts","./GameEnum.ts","./GameMapList.ts","./GameSettings.ts","./GuideManager.ts","./Interface.ts","./MapTypeModel.ts","./PlayerData.ts","./Projectile.ts","./ProjectileEmitter.ts","./ReadTablesManager.ts","./ResManager.ts","./ShopBuff.ts","./ShopBuffData.ts","./SmallestEnclosingCircle.ts","./SoldierSkillData.ts","./Squad.ts","./SquadController.ts","./StateDefine.ts","./SteerEntity.ts","./UnitConfig.ts","./WindowDataController.ts","./BaseUI.ts","./CheaterUI.ts","./DoubleAttackSpeedUI.ts","./DropEffectUI.ts","./GameOverUI.ts","./Turntable.ts","./GuideLayer.ts","./HomeUI.ts","./LoadingUI.ts","./OfflineTipUI.ts","./SettingsUI.ts","./AdditionItem.ts","./ShopDaliyElectionItem.ts","./ShopFreeZoneItem.ts","./ShopMainUI.ts","./SelectSoldierCardUI.ts","./SoldierCard.ts","./UIGray.ts","./UIManager.ts","./loading.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Main.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts","./CheaterUI.ts"],(function(t){"use strict";var n,e,o,i,r,s,a;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy,o=t._decorator,i=t.game,r=t.Component},function(t){s=t.default},function(t){a=t.default}],execute:function(){var c;e._RF.push({},"26bc05K+ltI5oxBDdOpjIie","Main",void 0);var u=o.ccclass;o.property,t("Main",u("Main")(c=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var o=e.prototype;return o.onLoad=function(){s.ins.init(),window.tt?window.tt.setPreferredFramesPerSecond(59):i.frameRate=61},o.openCheaterUI=function(){s.ins.isShow(a)?s.ins.closeUI(a):s.ins.showUI(a)},e}(r))||c);e._RF.pop()}}}));

System.register("chunks:///_virtual/MapTypeModel.ts",["cc"],(function(i){"use strict";var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"9c0d1WkuShLo4kX5LNKyuHA","MapTypeModel",void 0);i("GridOpenData",(function(){this.id=void 0,this.defaultopen=void 0,this.order=void 0,this.index=void 0,this.coinType=void 0,this.cost=void 0})),i("SoldierUnlockData",(function(){this.id=void 0,this.type=void 0,this.level=void 0,this.name=void 0,this.des=void 0})),i("CardCostModel",(function(){this.time=void 0,this.coinType=void 0,this.coinNum=void 0,this.cardLevel=void 0}));t._RF.pop()}}}));

System.register("chunks:///_virtual/NestableScrollView_Inner.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,n,o,r,i,c;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t._decorator,r=t.EventTouch,i=t.Input,c=t.ScrollView}],execute:function(){var s;n._RF.push({},"4b1daD7SadEK49qbtUSxyml","NestableScrollView_Inner",void 0);var l=o.ccclass;o.property,t("default",l(s=function(t){function n(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))||this).m_OuterScrollView=null,e}e(n,t);var o=n.prototype;return o.setOuterScrollView=function(t){this.m_OuterScrollView=t},o._onTouchMoved=function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var n=t.touch,o=n.getLocation().subtract(n.getStartLocation());if(this.content&&(this.m_OuterScrollView.isDifferentBetweenSettingAndPlan(this)||this._handleMoveLogic(n)),this.cancelInnerEvents){if(o.length()>7&&!this._touchMoved&&t.target!==this.node){var c=new r(t.getTouches(),t.bubbles,t.type);c.type=i.EventType.TOUCH_CANCEL,c.touch=t.touch,c.simulate=!0,t.target.dispatchEvent(c),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},n}(c))||s);n._RF.pop()}}}));

System.register("chunks:///_virtual/NestableScrollView_Outer.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var n,e,i,r,l,o,s;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy,i=t._decorator,r=t.UITransform,l=t.EventTouch,o=t.Input,s=t.ScrollView}],execute:function(){var h;e._RF.push({},"94b62vXUwBGIbs0KNasXJgp","NestableScrollView_Outer",void 0);var c=i.ccclass;i.property,t("default",c(h=function(t){function e(){for(var n,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return(n=t.call.apply(t,[this].concat(i))||this).m_InnerScrollViews=[],n.m_PlanDir=null,n.m_ScrollingInnerSv=null,n}n(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.m_PlanDir=null,this.m_InnerScrollViews.forEach((function(n){n.setOuterScrollView(t)}))},i._isHisChild=function(t,n){return t==n||null!=t.parent&&(t.parent==n||this._isHisChild(t.parent,n))},i._findScrollingInnerSv=function(t){for(var n=0;n<this.m_InnerScrollViews.length;n++){if(this._isHisChild(t,this.m_InnerScrollViews[n].node))return this.m_InnerScrollViews[n]}return null},i.isDifferentBetweenSettingAndPlan=function(t){return 0!=this.m_PlanDir&&((1!=this.m_PlanDir||!t.horizontal)&&(-1!=this.m_PlanDir||!t.vertical))},i._hasNestedViewGroup=function(t,n){if(t.eventPhase===Event.CAPTURING_PHASE)return!1},i._onTouchBegan=function(t,n){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,n)){this.m_PlanDir=null,this.m_ScrollingInnerSv=null;var e=t.touch;this.content&&this._handlePressLogic(e),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)}},i._onTouchMoved=function(t,n){if(console.log("_onTouchMoved  NestableScrollView_Outer"),this.enabledInHierarchy&&!this._hasNestedViewGroup(t,n)){var e=t.touch,i=e.getLocation().subtract(e.getStartLocation());if(null==this.m_PlanDir&&i.length()>7)if(this.m_ScrollingInnerSv=this._findScrollingInnerSv(t.target),null!=this.m_ScrollingInnerSv){var s=this.m_ScrollingInnerSv.content.getComponent(r).contentSize,h=this.m_ScrollingInnerSv.node.getComponent(r).contentSize;this.m_ScrollingInnerSv.vertical&&s.height>h.height||this.m_ScrollingInnerSv.horizontal&&s.width>h.width?this.m_PlanDir=Math.abs(i.x)>Math.abs(i.y)?1:-1:this.m_PlanDir=0}else this.m_PlanDir=0;if(this.content&&(this.isDifferentBetweenSettingAndPlan(this)||this._handleMoveLogic(e)),this.cancelInnerEvents&&null==this.m_ScrollingInnerSv){if(i.length()>7&&!this._touchMoved&&t.target!==this.node){var c=new l(t.getTouches(),t.bubbles,t.type);c.type=o.EventType.TOUCH_CANCEL,c.touch=t.touch,c.simulate=!0,t.target.dispatchEvent(c),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},e}(s))||h);e._RF.pop()}}}));

System.register("chunks:///_virtual/NodeLayers.ts",["cc"],(function(e){"use strict";var r;return{setters:[function(e){r=e.cclegacy}],execute:function(){var t;e("NodeLayers",void 0),r._RF.push({},"a53569eQdlHyqZ+gEMdYbr3","NodeLayers",void 0),function(e){e[e.Guide_Game=524288]="Guide_Game",e[e.DEFAULT=1073741824]="DEFAULT"}(t||(t=e("NodeLayers",{}))),r._RF.pop()}}}));

System.register("chunks:///_virtual/OfflineTipUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UIManager.ts"],(function(n){"use strict";var e,t,o,r,i,c,s;return{setters:[function(n){e=n.inheritsLoose},function(n){t=n.cclegacy,o=n._decorator},function(n){r=n.LayerType,i=n.PopType,c=n.BaseUI},function(n){s=n.default}],execute:function(){var a,f;t._RF.push({},"39fd4McebRMhqVut0BIyUsZ","OfflineTipUI",void 0);var u=o.ccclass;o.property,n("default",u("OfflineTipUI")(((f=function(n){function t(){for(var e,t=arguments.length,o=new Array(t),c=0;c<t;c++)o[c]=arguments[c];return(e=n.call.apply(n,[this].concat(o))||this).m_layerType=r.normal,e.m_PopType=i.PopUp,e}e(t,n);var o=t.prototype;return o.onLoad=function(){},o.onDestroy=function(){},o.OnMsg=function(){},o.onClose=function(){s.ins.closeUI(t)},t}(c)).prefabUrl="OfflineTipUI",a=f))||a);t._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerData.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LocalStorageMgr.ts","./ReadTablesManager.ts","./EventDispatcher.ts","./EventType.ts"],(function(e){"use strict";var t,n,a,i,r,u;return{setters:[function(e){t=e.createClass},function(e){n=e.cclegacy},function(e){a=e.LocalStorageMgr},function(e){i=e.ReadTablesManager},function(e){r=e.EventDispatcher},function(e){u=e.EventType}],execute:function(){n._RF.push({},"d5505hME1JD+Inzu2dz0Za3","PlayerData",void 0),e("PlayerData",function(){function e(){this.soldierModels=null,this.CurrAttributeTask=null,this.dailySelectionDatas=null,this.dailyRefreshTimes={},this.IsDoubleAtSpeed=!1}var n=e.prototype;return n.GetUnitShopBuff=function(e,t){return null},n.ChangeSpacialMapLevel=function(){this.SpecialMapLevel++},n.GetDoubleCoinRunning=function(){return this.DoubleCoinTimeCold>0},n.PayOrAddCoin=function(e,t){var n=-1;return 1==t?e<=this.Coin&&(this.Coin-=e,n=1):(this.Coin+=e,n=1),n},n.ChangeGK=function(){this.CurrUnlockGK++},n.ChangeLattice=function(){i.ins.GridOpenDataDic.length>this.Lattice&&this.Lattice++},n.ChangeGeneralLevel=function(){i.ins.GeneralLevelModelList.length>this.CurrGeneralLevel&&this.CurrGeneralLevel++},n.ChangeCardTimes=function(){i.ins.CardCostModelList.length>this.CardLevel&&this.CardLevel++},n.ChangeAttributeTask=function(e){this.CurrAttributeTask=e},n.SaveSoldierModels=function(){this.soldierModels&&a.setItem(a.SaveDataEnum.SOLDIERS,JSON.stringify(this.soldierModels))},n.ReadSaveData=function(){var e=a.getItem(a.SaveDataEnum.LATTICE);if(!e||""===e){var t=i.ins.GetGridOpenDataByOrder(-1,1);null!==t&&(this.Lattice=t.order-1)}var n=a.getItem(a.SaveDataEnum.SOLDIERS);this.soldierModels=n&&""!==n?JSON.parse(n):[];var r=a.getItem(a.SaveDataEnum.DailySelectionList);this.dailySelectionDatas=r&&""!==r?JSON.parse(r):[];var u=a.getItem(a.SaveDataEnum.DailyRefreshTime);this.dailyRefreshTimes=u&&""!==u?JSON.parse(u):{}},n.OnAdTimesChange=function(){},n.AddBuyFieldCount=function(e){var t=a.getItem(a.SaveDataEnum.COUNT_BUY_FIELD),n=t&&""!==t?Number(t):0;a.setItem(a.SaveDataEnum.COUNT_BUY_FIELD,(n+e).toString())},n.AddSoldierUpgradeCount=function(e){var t=this.SoldierUpgradeCount;a.setItem(a.SaveDataEnum.COUNT_SOLDIER_UPGRADE,(t+e).toString())},t(e,[{key:"Coin",get:function(){var e=a.getItem(a.SaveDataEnum.COIN);return e&&""!==e?Number(e):9999},set:function(e){a.setItem(a.SaveDataEnum.COIN,e.toString()),r.ins.dispatchEvent(u.COIN_CHANGE)}},{key:"CurrUnlockGK",get:function(){var e=a.getItem(a.SaveDataEnum.GK);return e&&""!==e?Number(e):1},set:function(e){a.setItem(a.SaveDataEnum.GK,e.toString())}},{key:"Lattice",get:function(){var e=a.getItem(a.SaveDataEnum.LATTICE);return Number(e)},set:function(e){a.setItem(a.SaveDataEnum.LATTICE,e.toString()),r.ins.dispatchEvent(u.LATTICE_CHANGE)}},{key:"CurrGeneralLevel",get:function(){var e=a.getItem(a.SaveDataEnum.GENERAL_LEVEL);return e&&""!==e?Number(e):1},set:function(e){a.setItem(a.SaveDataEnum.GENERAL_LEVEL,e.toString()),r.ins.dispatchEvent(u.GENERALLEVEL_CHANGE),setTimeout((function(){r.ins.dispatchEvent(u.POWER_CHANGE)}),0)}},{key:"CardLevel",get:function(){var e=a.getItem(a.SaveDataEnum.CARD);return e&&""!==e?Number(e):1},set:function(e){a.setItem(a.SaveDataEnum.CARD,e.toString()),r.ins.dispatchEvent(u.CARDLEVEL_CHANGE)}},{key:"DailySelectionDatas",get:function(){return this.dailySelectionDatas},set:function(e){this.dailySelectionDatas=e,a.setItem(a.SaveDataEnum.DailySelectionList,JSON.stringify(e))}},{key:"DailyRefreshTime",get:function(){return this.dailyRefreshTimes},set:function(e){this.dailyRefreshTimes=e,a.setItem(a.SaveDataEnum.DailyRefreshTime,JSON.stringify(e))}},{key:"DoubleCoinTimeCold",get:function(){var e=a.getItem(a.SaveDataEnum.DoubleCoinTime);return e&&""!==e?Number(e):0},set:function(e){a.setItem(a.SaveDataEnum.DoubleCoinTime,e.toString())}},{key:"SpecialMapLevel",get:function(){var e=a.getItem(a.SaveDataEnum.SPECIALMAP_LEVEL);return e&&""!==e?Number(e):1},set:function(e){this.DoubleCoinTimeCold=e,a.setItem(a.SaveDataEnum.SPECIALMAP_LEVEL,e.toString())}},{key:"CurrGuideStage",get:function(){var e=a.getItem(a.SaveDataEnum.GUIDESTAGE);return e&&""!==e?Number(e):-1},set:function(e){a.setItem(a.SaveDataEnum.GUIDESTAGE,e.toString())}},{key:"SoldierUpgradeCount",get:function(){var e=a.getItem(a.SaveDataEnum.COUNT_SOLDIER_UPGRADE);return e&&""!==e?Number(e):0}}],[{key:"ins",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}())._instance=null,n._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerFormationMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FormationGrid.ts","./GameController.ts","./Entity.ts","./SoldierDrag.ts","./PlayerData.ts","./SoldierLatticeModel.ts","./EnemyMapController.ts","./ReadTablesManager.ts","./EventDispatcher.ts","./EventType.ts","./CameraCtrl.ts","./DropEffectUI.ts","./Utils.ts","./NodeLayers.ts","./GuideManager.ts","./EntityAnim.ts"],(function(t){"use strict";var e,i,n,r,a,s,o,l,d,u,c,h,f,g,p,v,m,y,E,D,G,S,_,C,T,L,M,w,x,P,U,b,A,O,V,R,W,H;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized,a=t.asyncToGenerator,s=t.regeneratorRuntime},function(t){o=t.cclegacy,l=t._decorator,d=t.v3,u=t.Prefab,c=t.Camera,h=t.Node,f=t.geometry,g=t.find,p=t.instantiate,v=t.Input,m=t.PhysicsSystem,y=t.Vec3,E=t.log,D=t.Component},function(t){G=t.FormationGrid},function(t){S=t.GameController,_=t.GameState},function(t){C=t.Entity},function(t){T=t.SoldierDrag},function(t){L=t.PlayerData},function(t){M=t.SoldierLatticeModel},function(t){w=t.EnemyMapController},function(t){x=t.ReadTablesManager},function(t){P=t.EventDispatcher},function(t){U=t.EventType},function(t){b=t.CameraCtrl},function(t){A=t.DropEffectUI},function(t){O=t.UIUtils},function(t){V=t.NodeLayers},function(t){R=t.GuideManager,W=t.GuideStage},function(t){H=t.EntityAnim}],execute:function(){var I,k,N,z,F,B,Y,j,X,q,J,K;o._RF.push({},"ff56eHxjSRFA59evq/7EIm0","PlayerFormationMgr",void 0);var Q=l.ccclass,Z=l.property,$=d();t("PlayerFormationMgr",(I=Q("PlayerFormationMgr"),k=Z(u),N=Z(u),z=Z(c),F=Z(h),I(((K=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a))||this,n(e,"gridPrefab",j,r(e)),n(e,"soldierPrefab",X,r(e)),n(e,"mainCamera",q,r(e)),n(e,"formationContainer",J,r(e)),e.gridArr=[],e._ray=new f.Ray,e.curDragGrid=null,e.soldierTypes=["sword","hammer","gun","bow","mage","knight"],e.soldierMaxLevel=5,e.lattice=[0,1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],e.latticeWidth=2.48,e.isCanUp=!1,e.canvas=null,e.dropEffectUIOffest=d(0,300,0),e.averageC=0,e.tempV3=d(),e.moveTouch=null,e.targetOffest=d(0,0,-3),e.curOffest=d(0,0,0),e._tempV3_1=d(),e._tempV3_2=d(),e.dragEnabled=!0,e.UpgradeGuideStarted=!1,e.guideHandDelayTimer=null,e.UpgradeHandShow=!1,e.guideSoldiers=[],e}i(e,t);var o=e.prototype;return o.onLoad=function(){e.ins=this,this.canvas=g("Canvas");for(var t=-3;t<3;t++)for(var i=-3;i<3;i++){var n=p(this.gridPrefab);this.formationContainer.addChild(n),n.setPosition(i*this.latticeWidth+this.latticeWidth/2,0,t*this.latticeWidth+this.latticeWidth/2),this.gridArr.push(n.getComponent(G)),n.getComponent(G).InitState(0)}this.canvas.on(v.EventType.TOUCH_START,this.onTouchStart,this),this.canvas.on(v.EventType.TOUCH_MOVE,this.onTouchMove,this),this.canvas.on(v.EventType.TOUCH_END,this.onTouchEnd,this),this.canvas.on(v.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},o.init=function(){var t=a(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initSoldiers();case 2:this.formationContainer.active=!0;case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),o.clear=function(){this.gridArr.forEach((function(t){t.reset()})),this.formationContainer.active=!1},o.initSoldiers=function(){var t=a(s().mark((function t(){var e,i,n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.initLatticeDefault(),0===(e=L.ins.soldierModels).length&&(this.MakeRadomData(),L.ins.SaveSoldierModels()),this.InitLatticeList(),i=e.length,n=0;case 6:if(!(n<i)){t.next=14;break}return(r=e[n]).showEffect=!1,t.next=11,this.CreateModel(r);case 11:n++,t.next=6;break;case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),o.InitLatticeList=function(){for(var t=0;t<this.gridArr.length;t++)this.gridArr[t].index=t,this.gridArr[t].InitState(this.lattice[t])},o.CreateModel=function(){var t=a(s().mark((function t(e,i){var n,r,a,o,l,d,u,c,h;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===i&&(i=!1),n=this.gridArr[e.index],t.next=4,w.ins.GetModelObjectBySoldierType(e.type,e.level>5?6:e.level);case 4:for(r=t.sent,a=e.level<=5?e.level:e.level-5,o=[],l=0;l<a;l++)(d=p(r)).addComponent(H),d.eulerAngles=this.tempV3.set(0,180,0),S.ins.mySoldierContainer.addChild(d),this.celPos(d,n.node.position,a,l),(u=d.getComponent(C))&&(u.SetLevel(e.level),u.isEnemy=!1,u.setMaterial(S.ins.playerMaterial),w.ins.createShadow(u)),d.addComponent(T).init(n.node.position),o.push(d);c={m:e,soldiers:o},n.getComponent(G).data=c,i&&n.playMergeEffect(),n.SetData(),this.averageC+=n.AverageCoinNum,P.ins.dispatchEvent(U.UPDATE_AVERAGECOIN),-1===(h=L.ins.soldierModels).indexOf(e)&&h.push(e),P.ins.dispatchEvent(U.LATTICE_CHANGE),i&&P.ins.dispatchEvent(U.POWER_CHANGE),L.ins.SaveSoldierModels();case 19:case"end":return t.stop()}}),t,this)})));return function(e,i){return t.apply(this,arguments)}}(),o.initLatticeDefault=function(){for(var t=L.ins.Lattice,e=[],i=0;i<x.ins.GridOpenDataDic.length;i++){var n=x.ins.GridOpenDataDic[i];if(t>0){if(!(n.order<=t))break;e.push(n.index-1)}}for(var r=0;r<this.lattice.length;r++)this.lattice[r]=-1!==e.indexOf(r)?1:0},o.onTouchStart=function(t){if(this.dragEnabled){this.curOffest.set(0,0,0);var e=t.touch;if(this.moveTouch=e,this.mainCamera.screenPointToRay(e.getLocationX(),e.getLocationY(),this._ray),m.instance.raycast(this._ray)){var i,n,r,a=m.instance.raycastResults[0].hitPoint.add(this.curOffest);if(this.curDragGrid=this.celGrid(a),null==this||null==(i=this.curDragGrid)||!i.data)return void(this.curDragGrid=null);S.ins.curtState=_.DragSoldier,A.ins.ShowStarsEffect(!0,null==(n=this.curDragGrid)||null==(r=n.data)?void 0:r.m.level),A.ins.setActive(!0);for(var s=0;s<this.gridArr.length;s++){var o,l,d,u=this.gridArr[s];u!=this.curDragGrid&&((null==u||null==(o=u.data)?void 0:o.m.level)==this.curDragGrid.data.m.level&&(null==u||null==(l=u.data)?void 0:l.m.level)<this.soldierMaxLevel&&(null==u||null==(d=u.data)?void 0:d.m.type)==this.curDragGrid.data.m.type&&u.playLevelUpEffect())}}}},o.onTouchMove=function(t){this.curDragGrid&&this.dragEnabled&&(this.moveTouch=t.touch)},o.update=function(t){if(this.curDragGrid&&this.dragEnabled){y.lerp(this.curOffest,this.curOffest,this.targetOffest,2.5*t);var e=this.moveTouch;if(this.mainCamera.screenPointToRay(e.getLocationX(),e.getLocationY(),this._ray),m.instance.raycast(this._ray)){var i=m.instance.raycastResults[0].hitPoint.add(this.curOffest);this.dragMove(i);var n=this.celGrid(i);if(n&&!n.isLock||(n=null),this.gridArr.forEach((function(t){n===t?t.playDropPointEffect():t.stopDropPointEffect()})),b.instance.setTargetPos(i),b.instance.camera.convertToUINode(i,this.canvas,$),$.add(this.dropEffectUIOffest),A.ins.setPosition($),n){var r,a,s,o,l,d,u,c;if(null==(r=n)||null==(a=r.data)||!a.m||n===this.curDragGrid)return A.ins.ShowTurnEffect(!1),void A.ins.ShowUpEffect(!1);this.curDragGrid.data.m.level==(null==(s=n)||null==(o=s.data)?void 0:o.m.level)&&(null==(l=n)||null==(d=l.data)?void 0:d.m.level)<this.soldierMaxLevel&&this.curDragGrid.data.m.type==(null==(u=n)||null==(c=u.data)?void 0:c.m.type)?(A.ins.ShowTurnEffect(!1),this.isCanUp=!0,A.ins.ShowUpEffect(!0)):(this.isCanUp=!1,A.ins.ShowTurnEffect(!0),A.ins.ShowUpEffect(!1))}else A.ins.ShowTurnEffect(!1),A.ins.ShowUpEffect(!1)}}},o.onTouchEnd=function(t){if(this.gridArr.forEach((function(t){t.stopDropPointEffect(),t.stopLevelUpEffect()})),this.dragEnabled&&this.curDragGrid){var e=t.touch;if(this.mainCamera.screenPointToRay(e.getLocationX(),e.getLocationY(),this._ray),m.instance.raycast(this._ray)){var i=m.instance.raycastResults[0].hitPoint.add(this.curOffest);this.dragMoveBoundLimit(i);var n,r,a,s,o,l,d,u,c,h,f,g,p,v,y,E=this.celGrid(i);if(E&&!E.isLock){if(E!==this.curDragGrid&&(null==(n=this.curDragGrid)||null==(r=n.data)||null==(a=r.m)?void 0:a.level)===(null==(s=E)||null==(o=s.data)||null==(l=o.m)?void 0:l.level)&&(null==(d=E)||null==(u=d.data)||null==(c=u.m)?void 0:c.level)<this.soldierMaxLevel&&(null==(h=this.curDragGrid)||null==(f=h.data)||null==(g=f.m)?void 0:g.type)==(null==(p=E)||null==(v=p.data)||null==(y=v.m)?void 0:y.type))return this.UPLevel(E),S.ins.curtState=_.StandBy,void A.ins.setActive(!1)}else E=this.curDragGrid;this.moveToLattice(E)}this.curDragGrid=null,S.ins.curtState=_.StandBy,A.ins.setActive(!1)}},o.moveToLattice=function(t){var e,i,n,r=this,a=this.curDragGrid.data;this.curDragGrid.data=t.data,t.data=a,t.data&&(t.data.m.index=t.index),this.curDragGrid.data&&(this.curDragGrid.data.m.index=this.curDragGrid.index),null==t||null==(e=t.data)||e.soldiers.forEach((function(e){e.getComponent(T).setTargetWorldPos(t.node.worldPosition)})),null==(i=this.curDragGrid)||null==(n=i.data)||n.soldiers.forEach((function(t){t.getComponent(T).setTargetWorldPos(r.curDragGrid.node.worldPosition)}))},o.celGrid=function(t){for(var e=0;e<this.formationContainer.children.length;e++){var i=this.formationContainer.children[e].worldPosition;if(t.x<=i.x+this.latticeWidth/2&&t.x>=i.x-this.latticeWidth/2&&t.z<=i.z+this.latticeWidth/2&&t.z>=i.z-this.latticeWidth/2)return this.formationContainer.children[e].getComponent(G)}return null},o.dragMove=function(t){this.curDragGrid&&(this.dragMoveBoundLimit(t),this.curDragGrid.data.soldiers.forEach((function(e){e.getComponent(T).setTargetWorldPos(t)})))},o.dragMoveBoundLimit=function(t){t.x>3*this.latticeWidth&&(t.x=3*this.latticeWidth),t.x<3*-this.latticeWidth&&(t.x=3*-this.latticeWidth),t.z>3*this.latticeWidth+13&&(t.z=3*this.latticeWidth+13),t.z<3*-this.latticeWidth+13&&(t.z=3*-this.latticeWidth+13)},o.MakeRadomData=function(){for(var t=L.ins.soldierModels,e=0;e<this.lattice.length;e++)if(0!=this.lattice[e]){var i=new M;i.index=e,i.level=1,i.type=this.soldierTypes[0],t.push(i);break}},o.UPLevel=function(t){for(var e=L.ins.soldierModels,i=e.length-1;i>=0;i--)e[i].index===t.data.m.index&&e[i].level++,e[i].index==this.curDragGrid.data.m.index&&e.splice(i,1);this.curDragGrid.data.soldiers.forEach((function(t){t.getComponent(C).shadow.destroy(),t.getComponent(C).shadow=null,t.destroy()})),this.curDragGrid.data.soldiers=[],this.curDragGrid.data.m=null,this.curDragGrid.data=null,this.curDragGrid=null,this.refreshGridVeiw(t),t.playMergeEffect(),this.EndUpgradeGuide(),L.ins.SaveSoldierModels(),this.scheduleOnce((function(){P.ins.dispatchEvent(U.POWER_CHANGE),P.ins.dispatchEvent(U.TEMPLE_BTN)}),.1)},o.refreshGridVeiw=function(t){t.data.soldiers.forEach((function(t){t.getComponent(C).shadow.destroy(),t.getComponent(C).shadow=null,t.destroy()})),t.data.soldiers.length=0,this.CreateModel(t.data.m)},o.celPos=function(t,e,i,n){switch(this._tempV3_1.set(e),i){case 1:this._tempV3_2.set(0,0,0);break;case 2:0===n?this._tempV3_2.set(.55,0,0):1===n&&this._tempV3_2.set(-.55,0,0);break;case 3:0===n?this._tempV3_2.set(-.65,0,-.469):1===n?this._tempV3_2.set(0,0,.418):2===n&&this._tempV3_2.set(.65,0,-.469);break;case 4:0===n?this._tempV3_2.set(-.65,0,.65):1===n?this._tempV3_2.set(.65,0,.65):2===n?this._tempV3_2.set(.65,0,-.65):3===n&&this._tempV3_2.set(-.65,0,-.65);break;case 5:0===n?this._tempV3_2.set(-.65,0,.65):1===n?this._tempV3_2.set(.65,0,.65):2===n?this._tempV3_2.set(.65,0,-.65):3===n?this._tempV3_2.set(-.65,0,-.65):4===n&&this._tempV3_2.set(0,0,0)}this._tempV3_1.add(this._tempV3_2),t.setPosition(this._tempV3_1)},o.GetSimpleLattice=function(){var t=-1,e=this.gridArr.find((function(t){return!t.data&&!t.isLock}));return null!=e&&(t=e.index),t},o.BuySoldier=function(t,e){var i=this.GetSimpleLattice();if(-1!=i){var n=new M;n.index=i,n.type=t,n.level=e,this.CreateModel(n,!0)}else E("没有多余的格子可供购买了")},o.cardBuySoldier=function(t,e){var i=L.ins.soldierModels,n=this.GetSimpleLattice();if(-1!=n){var r=new M;r.index=n,r.type=t,r.level=1,e?i[i.length-1]=r:i.push(r),L.ins.SaveSoldierModels()}},o.SetLatticeUnLock=function(t){var e;if(t)return this.lattice[t.index]=1,void t.InitState(1,!0);var i=x.ins.GetGridOpenDataByOrder(-1,L.ins.Lattice);i&&(this.lattice[i.index-1]=1,null==(e=this.gridArr[i.index-1])||e.InitState(1,!0))},o.InitLastModel=function(){var t=L.ins.soldierModels;this.CreateModel(t[t.length-1],!0)},o.GetUpgradableTargets=function(t){var e=[];e.push(t);for(var i=0;i<this.gridArr.length;i++){var n,r,a,s,o,l=this.gridArr[i];l!=t&&((null==l||null==(n=l.data)?void 0:n.m.level)==(null==t||null==(r=t.data)?void 0:r.m.level)&&(null==l||null==(a=l.data)?void 0:a.m.level)<this.soldierMaxLevel&&(null==l||null==(s=l.data)?void 0:s.m.type)==(null==t||null==(o=t.data)?void 0:o.m.type)&&e.push(l))}return e},o.EnableDrags=function(t){this.dragEnabled=!!t},o.InitUpgradeGuide=function(){var t=this;if(!this.UpgradeGuideStarted){null!=this.guideHandDelayTimer&&(clearTimeout(this.guideHandDelayTimer),this.guideHandDelayTimer=null);for(var e=[],i=0;i<this.gridArr.length;i++){var n=this.gridArr[i],r=this.GetUpgradableTargets(n);if(r.length>=2){r.push(n),e=r;break}}if(null!=e&&e.length>=2){this.guideSoldiers.length=0;for(var a=0;a<2;a++)this.guideSoldiers.push(e[a]);this.guideSoldiers.forEach((function(t){var e,i,n;(null==t||null==(e=t.data)||null==(i=e.soldiers)?void 0:i.length)>0&&(null==t||null==(n=t.data)||n.soldiers.forEach((function(t){O.changeNodeLayer(t,V.Guide_Game)})))})),this.guideHandDelayTimer=setTimeout((function(){R.ins.StartUpgradeFingers(t.guideSoldiers[0].node,t.guideSoldiers[1].node),t.UpgradeHandShow=!0,t.guideHandDelayTimer=null,b.instance.isFollow=!1}),1e3),this.UpgradeGuideStarted=!0}}},o.EndUpgradeGuide=function(){R.ins.CurrStage===W.SOLDIER_UPGRADE&&(this.guideSoldiers.forEach((function(t){var e,i,n;(null==t||null==(e=t.data)||null==(i=e.soldiers)?void 0:i.length)>0&&(null==t||null==(n=t.data)||n.soldiers.forEach((function(t){O.changeNodeLayer(t,V.DEFAULT)})))})),null!=this.guideHandDelayTimer&&(clearTimeout(this.guideHandDelayTimer),this.guideHandDelayTimer=null),this.UpgradeHandShow=!1,R.ins.StopUpgradeFingers(),this.guideSoldiers=null,this.UpgradeGuideStarted=!1,R.ins.CurrStage=W.DOUBLE_MONEY_EARNINGS,b.instance.isFollow=!0)},e}(D)).ins=null,j=e((Y=K).prototype,"gridPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(Y.prototype,"soldierPrefab",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(Y.prototype,"mainCamera",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(Y.prototype,"formationContainer",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=Y))||B));o._RF.pop()}}}));

System.register("chunks:///_virtual/Projectile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameController.ts","./Entity.ts"],(function(t){"use strict";var e,i,n,o,s,r,a,c,h,d,l,u,p,f,m,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,r=t._decorator,a=t.v2,c=t.CCFloat,h=t.Node,d=t.Vec3,l=t.ParticleSystem,u=t.v3,p=t.Component},function(t){f=t.GameController,m=t.GameState},function(t){g=t.State}],execute:function(){var v,P,y,_,T,C,w;s._RF.push({},"c9c22o8nMZPS551t7atV1o2","Projectile",void 0);var E=r.ccclass,H=r.property,R=a();t("Projectile",(v=E("Projectile"),P=H({type:c,displayName:"速度"}),y=H(h),v((C=e((T=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this)._startPos=new d,e._endPos=new d,e._endTime=0,n(e,"speed",C,o(e)),n(e,"head",w,o(e)),e.arrowTop=2,e.isEnemy=!1,e.currTime=0,e.damage=0,e.damageRange=0,e.curveHeightRate=.4,e.projectileType=null,e.type=0,e.buffAllAddOdds=0,e.attackAddOdds=0,e.flyDegree=0,e.repelDegree=0,e.hitEffPrefab=null,e.hitEffectType=null,e._isRemoved=!1,e}i(e,t);var s=e.prototype;return s.init=function(t){this.node.getComponentsInChildren(l).forEach((function(t){t.clear(),t.play()})),this._startPos.set(this.node.worldPosition),this._endPos.set(t),this._endTime=d.distance(this._endPos,this._startPos)/this.speed,this._updatePosAndForward(0),this._isRemoved=!1,this.currTime=0,this.arrowTop=d.distance(this._endPos,this._startPos)*this.curveHeightRate},s.update=function(t){if(!this._isRemoved){this.currTime+=t;var e=this.limit(this.currTime/this._endTime,0,1);this._updatePosAndForward(e),f.ins.curtState!==m.Over&&this.HitTargets(),e>=1&&(f.ins.curtState!==m.Over&&this.damageRange>0&&this.HurtMany(this.damageRange),this.remove())}},s.remove=function(){var t,e=this;if(!this._isRemoved){this._isRemoved=!0,this.head.active=!1,this.scheduleOnce((function(){e.node.emit("onProjectileDead",e),e.head.active=!0}),.2);var i=f.ins.createHitParticle(this.hitEffectType);i.HitEffectType=this.hitEffectType,i.setWorldPosition(u(this.node.worldPosition.x,1,this.node.worldPosition.z)),null==(t=i.getComponent(l))||t.play(),i.getComponentsInChildren(l).forEach((function(t){t.play()})),i.getComponent(l).scheduleOnce((function(){var t,e;null==(t=i.getComponent(l))||t.stop(),null==(e=i.getComponent(l))||e.clear(),i.getComponentsInChildren(l).forEach((function(t){t.stop(),t.clear()})),f.ins.freeHitParticle(i)}),1)}},s.HurtMany=function(t){var e=this;f.ins.TraverseEnemyInCircle(R.set(this.node.position.x,this.node.position.z),t,this.isEnemy,(function(t){e.HurtTarget(t)}),this)},s.HitTargets=function(){var t=this,e=!1;f.ins.TraverseEnemyInCircle(R.set(this.node.position.x,this.node.position.z),.1,this.isEnemy,(function(i){e=!0,t.damageRange>0?t.HurtMany(t.damageRange):t.HurtTarget(i)}),this),e&&this.remove()},s.HurtTarget=function(t){if(t.currState!=g.KnockOut){var e=this.damage;switch(this.type){case 0:case 1:break;case 2:case 4:e*=this.attackAddOdds}t.TakeDamage(e)}},s._updatePosAndForward=function(t){var e=this._getPos(t);this.node.setPosition(e);var i=this._getPos(t-.01);this.node.forward=e.clone().subtract(i).normalize().negative()},s._getPos=function(t){var e=this._startPos.clone().lerp(this._endPos,t);return e.y=this.arrowTop*Math.cos(t*Math.PI-Math.PI/2),e},s.limit=function(t,e,i){return Math.min(i,Math.max(e,t))},e}(p)).prototype,"speed",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),w=e(T.prototype,"head",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=T))||_));s._RF.pop()}}}));

System.register("chunks:///_virtual/ProjectileEmitter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Projectile.ts"],(function(e){"use strict";var r,t,o,i,n,l,a,c,u,s,p,f;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,a=e.Prefab,c=e.Node,u=e.Pool,s=e.instantiate,p=e.Component},function(e){f=e.Projectile}],execute:function(){var P,h,b,j,y,d,g,v,m;e("ProjectileType",void 0),n._RF.push({},"a8772E3HVNBgL1hs+IbjLvp","ProjectileEmitter",void 0);var w,B=l.ccclass,A=l.property;!function(e){e.Arrow="Arrow",e.MagicBall="MagicBall"}(w||(w=e("ProjectileType",{})));e("ProjectileEmitter",(P=B("ProjectileEmitter"),h=A(a),b=A(a),j=A(c),P((g=r((d=function(e){function r(){for(var r,t=arguments.length,n=new Array(t),l=0;l<t;l++)n[l]=arguments[l];return r=e.call.apply(e,[this].concat(n))||this,o(r,"ArrowPrefab",g,i(r)),o(r,"MagicBallPrefab",v,i(r)),o(r,"projectileContainer",m,i(r)),r.ArrowPool=null,r.MagicBallPool=null,r}t(r,e);var n=r.prototype;return n.start=function(){var e=this;this.ArrowPool=new u((function(){return s(e.ArrowPrefab)}),5,(function(e){e.removeFromParent()})),this.MagicBallPool=new u((function(){return s(e.MagicBallPrefab)}),5,(function(e){e.removeFromParent()}))},n.onDestroy=function(){this.ArrowPool.destroy(),this.MagicBallPool.destroy()},n.create=function(e){var r=this[e+"Pool"].alloc();null==r.parent&&this.projectileContainer.addChild(r),r.active=!0,r.once("onProjectileDead",this.onProjectileDead,this);var t=r.getComponent(f);return t.projectileType=e,t},n.onProjectileDead=function(e){e.node.active=!1,this[e.projectileType+"Pool"].free(e.node)},r}(p)).prototype,"ArrowPrefab",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=r(d.prototype,"MagicBallPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=r(d.prototype,"projectileContainer",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=d))||y));n._RF.pop()}}}));

System.register("chunks:///_virtual/QuadTree.ts",["cc"],(function(t){"use strict";var s;return{setters:[function(t){s=t.cclegacy}],execute:function(){s._RF.push({},"a2bd751Z3BC7Yl9tQLZ7MCv","QuadTree",void 0);t("Quadtree",function(){function t(t,s,e,i){this.max_objects=void 0,this.max_levels=void 0,this.level=void 0,this.bounds=void 0,this.objects=[],this.nodes=[],this.max_objects=s||10,this.max_levels=e||4,this.level=i||0,this.bounds=t,this.objects=[],this.nodes=[]}var s=t.prototype;return s.split=function(){var s=this.level+1,e=this.bounds.width/2,i=this.bounds.height/2,h=this.bounds.x,n=this.bounds.y;this.nodes[0]=new t({x:h+e,y:n,width:e,height:i},this.max_objects,this.max_levels,s),this.nodes[1]=new t({x:h,y:n,width:e,height:i},this.max_objects,this.max_levels,s),this.nodes[2]=new t({x:h,y:n+i,width:e,height:i},this.max_objects,this.max_levels,s),this.nodes[3]=new t({x:h+e,y:n+i,width:e,height:i},this.max_objects,this.max_levels,s)},s.getIndex=function(t){var s=[],e=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,h=t.y<i,n=t.x<e,o=t.x+t.width>e,d=t.y+t.height>i;return h&&o&&s.push(0),n&&h&&s.push(1),n&&d&&s.push(2),o&&d&&s.push(3),s},s.insert=function(t){var s,e=0;if(this.nodes.length)for(s=this.getIndex(t),e=0;e<s.length;e++)this.nodes[s[e]].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),e=0;e<this.objects.length;e++){s=this.getIndex(this.objects[e]);for(var i=0;i<s.length;i++)this.nodes[s[i]].insert(this.objects[e])}this.objects=[]}},s.retrieve=function(t){var s=this.getIndex(t),e=this.objects;if(this.nodes.length)for(var i=0;i<s.length;i++)e=e.concat(this.nodes[s[i]].retrieve(t));return e=e.filter((function(t,s){return e.indexOf(t)>=s}))},s.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]},t}());s._RF.pop()}}}));

System.register("chunks:///_virtual/ReadTablesManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnmyMapClass.ts","./GameEnum.ts","./ResManager.ts","./MapTypeModel.ts","./GameData.ts","./SoldierSkillData.ts","./ShopBuffData.ts"],(function(e){"use strict";var t,n,r,a,s,i,o,l,u,c,d,p,h,f,v,m,b,g,D;return{setters:[function(e){t=e.createClass,n=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){a=e.cclegacy,s=e.log},function(e){i=e.Tileset,o=e.MapTypeModel,l=e.MapLevelModel,u=e.EnemyTypeModel,c=e.EnemyLevelModel,d=e.GeneralLevelModel},function(e){p=e.GameMode},function(e){h=e.ResManager},function(e){f=e.GridOpenData,v=e.CardCostModel,m=e.SoldierUnlockData},function(e){b=e.GameData},function(e){g=e.SoldierSkillsData},function(e){D=e.ShopData}],execute:function(){a._RF.push({},"7551denPr1NZJdf11IXtIlK","ReadTablesManager",void 0),e("ReadTablesManager",function(){function e(){this.GeneralLevelModelList=[],this.GridOpenDataDic=[],this.CardCostModelList=[],this.SoldierUnlockDataDic=[],this.soldierSkillsDatas=[],this.ShopDataList=[],this.FightingSoldier_LocalizationJson=null,this.LatticeWidth=void 0,this.latticeHeight=void 0}var a=e.prototype;return a.init=function(){var e=n(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.LatticeWidth=b.ins.SoldierLatticeWidth,e.next=3,this.readTypeJson();case 3:return e.next=5,this.readLevelJson();case 5:return e.next=7,this.ReadGeneralTable();case 7:return e.next=9,this.ReadGridOpenCSV();case 9:return e.next=11,this.ReadCardModel();case 11:return e.next=13,this.ReadUnlockSoldier();case 13:return e.next=15,this.ReadSoldierSkillsData();case 15:return e.next=17,this.ReadShopData();case 17:return e.next=19,h.instance.loadJsonAsset("b_tables_json/FightingSoldier_Localization");case 19:this.FightingSoldier_LocalizationJson=e.sent;case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.ReadGridOpenCSV=function(){var e=n(r().mark((function e(){var t,n,a,s,i,o,l,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.instance.loadJsonAsset("b_tables_json/gridopen");case 2:for(t=e.sent,n=0;n<t.length;n++)a=t[n],(s=new f).id=a.id,s.defaultopen=a["默认开启"],s.order=a["顺序"],i=(i=a["行列"]).replace("[","").replace("]",""),o=i.split(","),l=Number(o[0]),u=Number(o[1]),s.index=(l-1)*this.LatticeWidth+u,s.coinType=a["货币类型"],s.cost=a["价格"],this.GridOpenDataDic.push(s);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.readTypeJson=function(){var e=n(r().mark((function e(){var t,n,a,s,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.instance.loadJsonAsset("b_maps/type");case 2:for(t=e.sent,n=new o(t),a=0;a<t.tiles.length;a++)s=new u,i=t.tiles[a],s.id=i.id,s.gold=Number(i.properties[0].value),s.type=i.properties[1].value,n.addList(s);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.readLevelJson=function(){var e=n(r().mark((function e(){var t,n,a,s,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.instance.loadJsonAsset("b_maps/level");case 2:for(t=e.sent,n=new l(t),a=0;a<t.tiles.length;a++)s=new c,i=t.tiles[a],s.id=Number(i.id),s.level=Number(i.properties[0].value),n.addList(s);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.ReadGeneralTable=function(){var e=n(r().mark((function e(){var t,n,a,i,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.instance.loadTextAsset("b_tables/commander");case 2:if(t=e.sent,0!=(n=this.GetCSVArray2(t.text)).length){e.next=7;break}return s("读取数据commander表错误"),e.abrupt("return");case 7:for(a=0;a<n.length;a++)i=new d,o=n[a],i.level=Number(o[0]),i.hp=Number(o[1]),i.attack=Number(o[2]),i.speed=Number(o[3]),i.attackSpeed=Number(o[4]),i.attackRange=Number(o[5]),i.coinType=Number(o[6]),i.coinNum=Number(o[7]),this.GeneralLevelModelList.push(i);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.GetCSVArray2=function(e){for(var t=[],n=e.split(/\r|\n/gi).filter((function(e){return""!==e})),r=0;r<n.length;r++)r<3||""==n[r]||t.push(n[r].split(","));return t},a.GetMapAssetPath=function(e,t){return void 0===t&&(t=p.GM_NORMAL),"b_maps/map"+e},a.readMapsDataByContent=function(e){var t,n,r=JSON.parse(JSON.stringify(e));t=e.layers[0],n=e.layers[1],null!==t&&(r.typeData=t),null!==n&&(r.levelData=n),r.tilesets=[new i,new i];var a=e.tilesets;return s("Tilesets num:",a.Count),r.tilesets[0].firstgid=a[0].firstgid,r.tilesets[0].source=a[0].source,r.tilesets[1].firstgid=a[1].firstgid,r.tilesets[1].source=a[1].source,r},a.GetGeneralData=function(e){if(e<=this.GeneralLevelModelList.length)for(var t=0;t<this.GeneralLevelModelList.length;t++){var n=this.GeneralLevelModelList[t];if(n.level==e)return n}return null},a.GeneralLevelMax=function(e){return e==this.GeneralLevelModelList.length},a.GetNextGeneralData=function(e){return e<this.GeneralLevelModelList.length?this.GeneralLevelModelList[e]:this.GeneralLevelModelList[e-1]},a.GetCurrGeneralData=function(e){var t=e;return t<=0&&(t=1),t>=this.GeneralLevelModelList.length||t<1?(s("已达到最大值MAX"),null):this.GeneralLevelModelList[t-1]},a.ReadCardModel=function(){var e=n(r().mark((function e(){var t,n,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.instance.loadJsonAsset("b_tables_json/cardvalue");case 2:for(t=e.sent,n=0;n<t.length;n++)(a=new v).time=Number(t[n].购买次数),a.coinType=Number(t[n].货币类型),a.coinNum=Number(t[n].购买价格),a.cardLevel=Number(t[n].卡片等级),this.CardCostModelList.push(a);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.GetNextCardData=function(e,t){var n=t;return n<=0&&(n=1),n>=this.CardCostModelList.length?(s("已达到最大值MAX"),this.CardCostModelList[this.CardCostModelList.length-1]):this.CardCostModelList[n-1]},a.ReadUnlockSoldier=function(){var e=n(r().mark((function e(){var t,n,a,s,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.instance.loadTextAsset("b_tables/soldiersopen");case 2:if(t=e.sent,0!=(n=this.GetCSVArray2(t.text)).length){e.next=6;break}return e.abrupt("return");case 6:for(a=0;a<n.length;a++)s=new m,i=n[a],s.id=Number(i[0]),s.type=i[1],s.level=Number(i[2]),this.SoldierUnlockDataDic.push(s);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.GetAllUnlockByTheLevel=function(e){for(var t=[],n=0;n<this.SoldierUnlockDataDic.length;n++){var r=this.SoldierUnlockDataDic[n];if(e>=r.level){if("commander"==r.type)continue;-1===t.indexOf(r)&&t.push(r)}}return t},a.GetGridOpenDataByOrder=function(e,t){var n=t;if(n>=this.GridOpenDataDic.length)return s("GetGridOpenDataByOrder 已达到最大值MAX"+n),this.GridOpenDataDic[n-1];for(var r=null,a=0;a<this.GridOpenDataDic.length;a++){var i=this.GridOpenDataDic[a];if(i.order>n&&0!=i.defaultopen){r=i;break}}return null==r&&s("格子开启规则表gridopen 查询数据id值为"+n+"不存在"),r},a.ReadSoldierSkillsData=function(){var e=n(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.instance.loadJsonAsset("b_tables_json/soldierSkills");case 2:e.sent.forEach((function(e){var n=new g;n.id=Number(e.ID),n.skillName=e.技能名,n.skillInfo=e.技能描述,n.skillType=Number(e.技能类型),n.targetDistance=Number(e.目标范围),n.SkillRange=Number(e.技能范围),n.continueTime=Number(e["技能持续时间（秒）"]),n.damageOdds=Number(e.伤害倍率),n.repeatTimes=Number(e.重复次数),n.awakeCD=Number(e["初始cd(秒）"]),n.averageCD=Number(e["技能cd（秒）"]),n.special_0=Number(e.特殊参数1),n.special_1=Number(e.特殊参数2),n.special_2=Number(e.特殊参数3),t.soldierSkillsDatas.push(n)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.GetCurrentSoldierSkillsData=function(e){for(var t=0;t<this.soldierSkillsDatas.length;t++){var n=this.soldierSkillsDatas[t];if(n.skillType==e)return n}return null},a.ReadShopData=function(){var e=n(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.instance.loadJsonAsset("b_tables_json/shop");case 2:e.sent.forEach((function(e){var n=new D;n.id=Number(e.id),n.name=e.名称,n.goodsType=Number(e.商品类型),n.goodsInfo=Number(e.购买内容1),n.value1=Number(e.值1),n.value2=Number(e.值2),n.value3=e.值3.split(","),n.value4=e.值4.replace("]","").replace("[","").split(",").map(Number),n.value5=Number(e.值5),n.coinType=Number(e.售价类型),n.price=Number(e.价格),t.ShopDataList.push(n)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.GetShopDataListByShopType=function(e){for(var t=[],n=0;n<this.ShopDataList.length;n++)this.ShopDataList[n].goodsType==e&&t.push(this.ShopDataList[n]);return t},a.GetShopDataById=function(e){return this.ShopDataList.find((function(t){return t.id==e}))},a.LoadGuideMap=function(){var e=n(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,!t){e.next=7;break}return e.next=4,h.instance.loadJsonAsset("b_maps/map001");case 4:n=e.sent,e.next=10;break;case 7:return e.next=9,h.instance.loadJsonAsset("b_maps/map000");case 9:n=e.sent;case 10:return e.abrupt("return",this.readMapsDataByContent(n));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getLocalizationStr=function(e){var t=this.FightingSoldier_LocalizationJson.find((function(t){return t.Key===e}));return null==t?void 0:t.Chinese},t(e,null,[{key:"ins",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}())._instance=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/ResManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){"use strict";var e,t,s,o,c,r;return{setters:[function(n){e=n.createClass},function(n){t=n.cclegacy,s=n.resources,o=n.JsonAsset,c=n.Prefab,r=n.TextAsset}],execute:function(){t._RF.push({},"d5fa4cFNsVGL57oyE6xImzp","ResManager",void 0),n("ResManager",function(){function n(){}var t=n.prototype;return t.loadJsonAsset=function(n){return new Promise((function(e){s.load(n,o,(function(n,t){e(t.json)}))}))},t.loadUnit=function(n){return new Promise((function(e){s.load(n,c,(function(n,t){e(t)}))}))},t.loadTextAsset=function(n){return new Promise((function(e){s.load(n,r,(function(n,t){e(t)}))}))},e(n,null,[{key:"instance",get:function(){return n._instance||(n._instance=new n),n._instance}}]),n}())._instance=null,t._RF.pop()}}}));

System.register("chunks:///_virtual/SelectSoldierCardUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./SoldierCard.ts","./ReadTablesManager.ts","./PlayerData.ts","./PlayerFormationMgr.ts","./UIManager.ts"],(function(t){"use strict";var e,n,i,r,a,o,s,l,c,d,u,h,p,f,C,g,b,v,y,m,S,k,_,L,I,w;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized,a=t.createForOfIteratorHelperLoose,o=t.asyncToGenerator,s=t.regeneratorRuntime},function(t){l=t.cclegacy,c=t._decorator,d=t.Prefab,u=t.Node,h=t.EventHandler,p=t.Input,f=t.Layout,C=t.UITransform,g=t.instantiate,b=t.Button,v=t.math},function(t){y=t.LayerType,m=t.PopType,S=t.BaseUI},function(t){k=t.SoldierCard},function(t){_=t.ReadTablesManager},function(t){L=t.PlayerData},function(t){I=t.PlayerFormationMgr},function(t){w=t.default}],execute:function(){var R,T,O,U,D,E,M,B,P,H,z,A;l._RF.push({},"176220I0tRN6YqWqG1T2cUo","SelectSoldierCardUI",void 0);var G=c.ccclass,N=c.property;t("default",(R=G("SelectSoldierCardUI"),T=N(d),O=N(u),U=N(u),D=N(u),R(((A=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).m_layerType=y.normal,e.m_PopType=m.max,i(e,"soldierCardPrefab",B,r(e)),i(e,"cardContainer",P,r(e)),i(e,"btn_look",H,r(e)),i(e,"btn_get",z,r(e)),e.unlockedSoldierList=[],e.soldierCardList=[],e.selectedSoldierCard=void 0,e.weights=new Map,e._mainData=void 0,e.isTwice=!1,e.eventHandler=new h,e}n(e,t);var l=e.prototype;return l.onLoad=function(){this.eventHandler.target=this.node,this.eventHandler.component="SelectSoldierCardUI",this.eventHandler.handler="OnClickCard",this.btn_get.on(p.EventType.TOUCH_END,this.OnBtnGetClick,this),this.btn_look.on(p.EventType.TOUCH_END,this.OnBtnLookClick,this)},l.onDestroy=function(){},l.onEnable=function(){this.isTwice=!1,this.soldierCardList.length=0},l.OnMsg=function(){var t=this;this.cardContainer.destroyAllChildren(),this.btn_look.active=!1,this.btn_get.active=!1,this.unlockedSoldierList=_.ins.GetAllUnlockByTheLevel(L.ins.CurrUnlockGK),this.soldierCardList.length=0;var e=this.cardContainer.getComponent(f);this.unlockedSoldierList.length>3?(e.resizeMode=f.ResizeMode.NONE,this.cardContainer.getComponent(C).width=1020,this.cardContainer.getComponent(C).height=863,e.type=f.Type.GRID,e.startAxis=f.AxisDirection.HORIZONTAL,e.spacingX=9,e.spacingY=0,e.constraint=f.Constraint.FIXED_COL,e.constraintNum=3):(e.resizeMode=f.ResizeMode.CONTAINER,e.spacingX=9),e.updateLayout(),this.unlockedSoldierList.forEach((function(e){var n=g(t.soldierCardPrefab);t.cardContainer.addChild(n),n.getComponent(b).clickEvents.push(t.eventHandler),t.soldierCardList.push(n.getComponent(k))})),this.ResetWeight(),this.RandomOnece(),I.ins.cardBuySoldier(this._mainData.type,!1)},l.ResetWeight=function(){var t=this;this.unlockedSoldierList.forEach((function(e){var n=0;n="mage"==e.type||"knight"==e.type?6:22,t.weights.set(e,n)}))},l.RandomOnece=function(){this._mainData=this.GetRandomSoldier()},l.GetRandomSoldier=function(){for(var t,e=0,n=a(this.weights);!(t=n()).done;){e+=t.value[1]}for(var i,r=v.randomRangeInt(0,e),o=null,s=a(this.weights);!(i=s()).done;){var l=i.value;if(r<=l[1]){o=l[0];break}r-=l[1]}return o},l.OnClickCard=function(){var t=o(s().mark((function t(e){var n,i,r,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null==(n=e.target)?void 0:n.getComponent(k)){t.next=3;break}return t.abrupt("return");case 3:return this.SwitchAllCardInteractable(!1),r=this._mainData,-1!==(a=this.unlockedSoldierList.findIndex((function(t){return t===r})))&&this.unlockedSoldierList.splice(a,1),t.next=9,i.ShowCardFront(r,!0);case 9:this.selectedSoldierCard=i,this.SelectCardCallback(r.type);case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),l.SwitchAllCardInteractable=function(t){this.soldierCardList.forEach((function(e){e.SwitchCardButton(t)}))},l.SelectCardCallback=function(t){this.btn_get.active=!0,0==this.isTwice?(this.btn_look.active=!0,this.isTwice=!0):(this.btn_look.active=!1,this.btn_get.active=!0,I.ins.cardBuySoldier(t,!0))},l.OnBtnLookClick=function(){this.ReFlipCards()},l.ReFlipCards=function(){this.ResetWeight(),this.SwitchAllCardInteractable(!0),this.selectedSoldierCard.GrayCard(),this.btn_look.active=!1,this.btn_get.active=!1,this.RandomOnece()},l.OnBtnGetClick=function(){this.Close()},l.Close=function(){I.ins.InitLastModel(),w.ins.closeUI(e)},e}(S)).prefabUrl="SelectSoldierCardUI",B=e((M=A).prototype,"soldierCardPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(M.prototype,"cardContainer",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(M.prototype,"btn_look",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(M.prototype,"btn_get",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=M))||E));l._RF.pop()}}}));

System.register("chunks:///_virtual/SettingsUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UIManager.ts","./LocalStorageMgr.ts"],(function(t){"use strict";var e,i,n,o,a,s,r,l,c,u,h,d,p,g,R,f,S;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,r=t.CCFloat,l=t.Graphics,c=t.Toggle,u=t.Component,h=t.UITransform,d=t.math},function(t){p=t.LayerType,g=t.PopType,R=t.BaseUI},function(t){f=t.default},function(t){S=t.LocalStorageMgr}],execute:function(){var m,y,T,G,b,v,k,I,U,C,D,E;a._RF.push({},"7eecbXo8tFO17YVJ8ygXhYt","SettingsUI",void 0);var w=s.ccclass,z=s.property;t("default",(m=w("SettingsUI"),y=z({type:r,displayName:"圆角矩形半径"}),T=z(l),G=z(c),b=z(c),m(((E=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))||this).m_layerType=p.normal,e.m_PopType=g.PopUp,n(e,"roundRectRadius",I,o(e)),n(e,"titleGraphics",U,o(e)),n(e,"toggleSound",C,o(e)),n(e,"toggleShake",D,o(e)),e}i(e,t);var a=e.prototype;return a.onLoad=function(){this.graphicsTitleBg();var t=new u.EventHandler;t.target=this.node,t.component="SettingsUI",t.handler="onToggleClick",this.toggleSound.checkEvents.push(t),this.toggleShake.checkEvents.push(t)},a.onDestroy=function(){},a.onEnable=function(){this.toggleSound.isChecked="false"!==S.getItem(S.SaveDataEnum.SOUND),this.toggleShake.isChecked="false"!==S.getItem(S.SaveDataEnum.SHAKE)},a.OnMsg=function(){},a.onClose=function(){f.ins.closeUI(e)},a.graphicsTitleBg=function(){this.titleGraphics.clear();var t=this.titleGraphics.node.getComponent(h).width,e=this.titleGraphics.node.getComponent(h).height;this.titleGraphics.arc(t/2-this.roundRectRadius,-e/2+2*this.roundRectRadius,this.roundRectRadius,d.toRadian(0),d.toRadian(90),!0),this.titleGraphics.lineTo(t/2-this.roundRectRadius,-e/2+2*this.roundRectRadius),this.titleGraphics.lineTo(t/2-this.roundRectRadius,e/2),this.titleGraphics.lineTo(-t/2+this.roundRectRadius,e/2),this.titleGraphics.lineTo(-t/2+this.roundRectRadius,e/2-this.roundRectRadius),this.titleGraphics.arc(-t/2+this.roundRectRadius,-e/2+2*this.roundRectRadius,this.roundRectRadius,d.toRadian(90),d.toRadian(180),!0),this.titleGraphics.lineTo(-t/2+this.roundRectRadius,-e/2+2*this.roundRectRadius),this.titleGraphics.lineTo(-t/2,-e/2+2*this.roundRectRadius),this.titleGraphics.lineTo(-t/2,-e/2),this.titleGraphics.lineTo(t/2,-e/2),this.titleGraphics.lineTo(t/2,-e/2+2*this.roundRectRadius),this.titleGraphics.fill(),this.titleGraphics.stroke()},a.onToggleClick=function(t){t===this.toggleSound?S.setItem(S.SaveDataEnum.SOUND,t.isChecked.toString()):t===this.toggleShake&&S.setItem(S.SaveDataEnum.SHAKE,t.isChecked.toString())},e}(R)).prefabUrl="SettingsUI",I=e((k=E).prototype,"roundRectRadius",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),U=e(k.prototype,"titleGraphics",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(k.prototype,"toggleSound",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(k.prototype,"toggleShake",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=k))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/ShopBuff.ts",["cc"],(function(t){"use strict";var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"016e7vuIn9Ek7XJvidgGpg4","ShopBuff",void 0);t("AttributeItem",(function(){this.type=void 0,this.num=void 0})),t("ShopItemData",(function(){this.id=void 0,this.order=0,this.type="",this.level=0,this.state=0,this.startTime=0,this.CdTime=0,this.gooodsType=void 0,this.goodsInfo=void 0,this.shopData=null}));i._RF.pop()}}}));

System.register("chunks:///_virtual/ShopBuffData.ts",["cc"],(function(i){"use strict";var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"716f1vY2mNHfbyY00yrRzC1","ShopBuffData",void 0);i("ShopBuffData",(function(){this.id=void 0,this.order=void 0,this.num=void 0,this.type=void 0,this.attributetype=void 0,this.reduce=void 0,this.percentage=void 0})),i("ShopData",(function(){this.id=void 0,this.name=void 0,this.goodsType=void 0,this.goodsInfo=void 0,this.value1=void 0,this.value2=void 0,this.value3=void 0,this.value4=void 0,this.value5=void 0,this.coinType=void 0,this.price=void 0}));t._RF.pop()}}}));

System.register("chunks:///_virtual/ShopDaliyElectionItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Utils.ts","./ReadTablesManager.ts","./UIManager.ts","./ShopMainUI.ts","./AdEvent.ts","./EventDispatcher.ts","./EventType.ts","./UIGray.ts","./PlayerFormationMgr.ts"],(function(t){"use strict";var e,i,n,r,a,o,l,c,u,s,p,S,d,h,f,y,v,b,m,B,g,F,G,D;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized,a=t.asyncToGenerator,o=t.regeneratorRuntime},function(t){l=t.cclegacy,c=t._decorator,u=t.Label,s=t.Sprite,p=t.Node,S=t.Component,d=t.Button,h=t.find},function(t){f=t.UIUtils},function(t){y=t.ReadTablesManager},function(t){v=t.default},function(t){b=t.default},function(t){m=t.AdEvent,B=t.AdEventType},function(t){g=t.EventDispatcher},function(t){F=t.EventType},function(t){G=t.UIGray},function(t){D=t.PlayerFormationMgr}],execute:function(){var T,I,N,w,E,x,z,C,U,L,O,A,M,R,_,P,V,j,k;l._RF.push({},"210bfpOjUNNsbjNyNO+UmbA","ShopDaliyElectionItem",void 0);var H=c.ccclass,J=c.property;t("ShopDaliyElectionItem",(T=H("ShopDaliyElectionItem"),I=J(u),N=J(s),w=J(u),E=J(p),x=J(p),z=J(p),C=J(p),U=J(p),T((A=e((O=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a))||this,n(e,"SoldierNameText",A,r(e)),n(e,"SoldierIcon",M,r(e)),n(e,"SoldierLevelText",R,r(e)),n(e,"GetSoldierBtn",_,r(e)),n(e,"BtnFreeState",P,r(e)),n(e,"BtnSoldOutState",V,r(e)),n(e,"BtnNoGridState",j,r(e)),n(e,"CoinText",k,r(e)),e.currData=null,e.ForceFree=!1,e}i(e,t);var l=e.prototype;return l.SetState=function(t){this.currData.state=t},l.SetData=function(t){this.currData=t},l.RefreshView=function(){var t=a(o().mark((function t(){var e,i,n=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=y.ins.FightingSoldier_LocalizationJson.find((function(t){return t.Key===f.getSoldierNameByType(n.currData.type)})),this.SoldierNameText.string=null==e?void 0:e.Chinese,t.next=4,f.GetSoldierSprite(this.currData.type);case 4:this.SoldierIcon.spriteFrame=t.sent,this.SoldierLevelText.string="LV."+this.currData.level,0!=this.currData.state||this.ForceFree?D.ins.GetSimpleLattice()<0?(this.BtnSoldOutState.active=!1,G.SetGray(this.GetSoldierBtn),this.BtnFreeState.active=!1,this.BtnNoGridState.active=!0,this.GetSoldierBtn.getComponent(d).interactable=!1):(this.BtnSoldOutState.active=!1,G.SetGray(this.GetSoldierBtn,!1),this.BtnFreeState.active=!0,this.BtnNoGridState.active=!1,this.GetSoldierBtn.getComponent(d).interactable=!0,i=h("Icon",this.BtnFreeState),this.ForceFree?i&&(i.active=!1):i&&(i.active=!0)):(this.BtnSoldOutState.active=!0,G.SetGray(this.GetSoldierBtn),this.BtnFreeState.active=!1,this.BtnNoGridState.active=!1,this.GetSoldierBtn.getComponent(d).interactable=!1);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),l.OnBtnClick=function(){if(this.ForceFree)this.ForceFree=!1,this.RefreshView(),v.ins.closeUI(b);else{var t=new m;t.tag="daily"+this.currData.order,t.eventType=B.CompleteAndClosed,g.ins.dispatchEvent(F.AD_EVENT,t)}},l.start=function(){},l.update=function(t){},e}(S)).prototype,"SoldierNameText",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(O.prototype,"SoldierIcon",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(O.prototype,"SoldierLevelText",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(O.prototype,"GetSoldierBtn",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(O.prototype,"BtnFreeState",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(O.prototype,"BtnSoldOutState",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(O.prototype,"BtnNoGridState",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(O.prototype,"CoinText",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=O))||L));l._RF.pop()}}}));

System.register("chunks:///_virtual/ShopFreeZoneItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Utils.ts","./ReadTablesManager.ts","./WindowDataController.ts","./UIGray.ts","./PlayerFormationMgr.ts","./EventDispatcher.ts","./EventType.ts"],(function(e){"use strict";var t,i,n,r,o,a,s,l,c,u,h,p,d,T,f,v,S,m,g,y,b,x;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,c=e.Label,u=e.Sprite,h=e.Node,p=e.Component,d=e.Button},function(e){T=e.ScriptLocalization,f=e.UIUtils,v=e.Utils},function(e){S=e.ReadTablesManager},function(e){m=e.WindowDataController},function(e){g=e.UIGray},function(e){y=e.PlayerFormationMgr},function(e){b=e.EventDispatcher},function(e){x=e.EventType}],execute:function(){var G,F,B,C,D,N,w,I,L,z,_,R,k,E,M,U,V,Z,P;e("FreeGoodsType",void 0),s._RF.push({},"a5b66itqG5BGbXtGAQ75U4C","ShopFreeZoneItem",void 0);var A,J=l.ccclass,K=l.property;!function(e){e[e.Coin=0]="Coin",e[e.Soldier=1]="Soldier"}(A||(A=e("FreeGoodsType",{})));e("ShopFreeZoneItem",(G=J("ShopFreeZoneItem"),F=K(c),B=K(u),C=K(c),D=K(c),N=K(h),w=K(h),I=K(h),L=K(c),G((R=t((_=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,n(t,"SoldierNameText",R,r(t)),n(t,"SoldierIcon",k,r(t)),n(t,"SoldierLevelText",E,r(t)),n(t,"CoinValueText",M,r(t)),n(t,"GetBtn",U,r(t)),n(t,"BtnFreeState",V,r(t)),n(t,"BtnNoGridState",Z,r(t)),n(t,"NextFreeTimeText",P,r(t)),t.goodsType=A.Coin,t.currData=void 0,t}i(t,e);var s=t.prototype;return s.start=function(){},s.onEnable=function(){b.ins.addEventListener(x.Main_Time,this.TimeRunning,this)},s.onDisable=function(){b.ins.removeEventListener(x.Main_Time,this.TimeRunning,this)},s.SetData=function(e,t){this.currData=e,this.goodsType=t},s.Init=function(){var e=o(a().mark((function e(){var t,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.NextFreeTimeText.node.active=!1,this.goodsType!=A.Coin){e.next=17;break}return t=S.ins.FightingSoldier_LocalizationJson.find((function(e){return e.Key===T.D_Coin})),this.SoldierNameText.string=null==t?void 0:t.Chinese.replace("{0}",""),this.SoldierLevelText.node.active=!1,this.BtnNoGridState.active=!1,this.BtnFreeState.active=!0,this.CoinValueText.node.active=!0,this.CoinValueText.string=v.ConvertIntToString(m.ins.GetNowFreeCoinNum()),e.next=11,f.GetSoldierSprite("coin");case 11:this.SoldierIcon.spriteFrame=e.sent,1==this.currData.state?(this.GetBtn.active=!0,this.NextFreeTimeText.node.active=!1):(this.GetBtn.active=!1,this.NextFreeTimeText.node.active=!0),this.GetBtn.getComponent(d).interactable=!0,g.SetGray(this.GetBtn,!1),e.next=26;break;case 17:if(this.goodsType!=A.Soldier){e.next=26;break}return i=S.ins.FightingSoldier_LocalizationJson.find((function(e){return e.Key===T.D_FreeZoneInfo})),this.SoldierNameText.string=null==i?void 0:i.Chinese.replace("{0}",this.currData.level.toString()),e.next=22,f.GetSoldierSprite("card");case 22:this.SoldierIcon.spriteFrame=e.sent,this.SoldierLevelText.string="LV."+this.currData.level,this.CoinValueText.node.active=!1,0==this.currData.state?(this.GetBtn.active=!1,this.NextFreeTimeText.node.active=!0):(this.GetBtn.active=!0,y.ins.GetSimpleLattice()<0?(this.GetBtn.getComponent(d).interactable=!1,g.SetGray(this.GetBtn),this.BtnFreeState.active=!1,this.BtnNoGridState.active=!0):(this.GetBtn.getComponent(d).interactable=!0,g.SetGray(this.GetBtn,!1),this.BtnFreeState.active=!0,this.BtnNoGridState.active=!1));case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.OnBtnGetClick=function(){null!=this.currData&&0!=this.currData.state&&(this.goodsType,A.Soldier,m.ins.FreeViewBtnClick(this.currData))},s.TimeRunning=function(){null!=this.currData&&1!=this.currData.state&&(this.goodsType,A.Coin,this.NextFreeTimeText.string="下次刷新时间\n"+m.ins.GetTimeStrByType(this.currData.id),!1===this.NextFreeTimeText.node.active&&(this.NextFreeTimeText.node.active=!0),!1===this.GetBtn.active&&(this.GetBtn.active=!1))},s.update=function(e){},t}(p)).prototype,"SoldierNameText",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(_.prototype,"SoldierIcon",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(_.prototype,"SoldierLevelText",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(_.prototype,"CoinValueText",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(_.prototype,"GetBtn",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(_.prototype,"BtnFreeState",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(_.prototype,"BtnNoGridState",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(_.prototype,"NextFreeTimeText",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=_))||z));s._RF.pop()}}}));

System.register("chunks:///_virtual/ShopMainUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./UIManager.ts","./AVirtualScrollView.ts","./WindowDataController.ts","./ShopDaliyElectionItem.ts","./ShopFreeZoneItem.ts","./ReadTablesManager.ts","./Utils.ts","./EventDispatcher.ts","./EventType.ts"],(function(e){"use strict";var t,n,i,o,a,l,r,c,s,u,p,f,h,y,m,d,g,b,I,D,T,v,S,w,C,F,E,Z,z,L;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){a=e.cclegacy,l=e._decorator,r=e.Node,c=e.Prefab,s=e.Label,u=e.tween,p=e.Widget,f=e.UITransform,h=e.UIOpacity,y=e.easing,m=e.instantiate,d=e.log},function(e){g=e.LayerType,b=e.PopType,I=e.BaseUI},function(e){D=e.default},function(e){T=e.default},function(e){v=e.WindowDataController,S=e.ShopIdEnum},function(e){w=e.ShopDaliyElectionItem},function(e){C=e.ShopFreeZoneItem,F=e.FreeGoodsType},function(e){E=e.ReadTablesManager},function(e){Z=e.ScriptLocalization},function(e){z=e.EventDispatcher},function(e){L=e.EventType}],execute:function(){var U,M,V,B,_,R,k,O,P,x,A,W,G,N,j,q,H,J,K,Q,X,Y,$,ee;a._RF.push({},"2d000gP4/NO0qWWGB9ast2P","ShopMainUI",void 0);var te=l.ccclass,ne=l.property;e("default",(U=te("ShopMainUI"),M=ne(r),V=ne(r),B=ne(T),_=ne(c),R=ne(r),k=ne(c),O=ne(r),P=ne(r),x=ne(r),A=ne(s),U(((ee=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return(t=e.call.apply(e,[this].concat(a))||this).m_layerType=g.normal,t.m_PopType=b.max,i(t,"Title",N,o(t)),i(t,"blackBg",j,o(t)),i(t,"additionList",q,o(t)),i(t,"DailyElectionItem",H,o(t)),i(t,"DailyElectionContent",J,o(t)),i(t,"FreeZoneItem",K,o(t)),i(t,"FreeZoneItemContent",Q,o(t)),i(t,"FreeZone",X,o(t)),i(t,"DailyElection",Y,o(t)),t.listData=[1,2,3,4,5,6,7,8],i(t,"TimeText",$,o(t)),t}n(t,e);var a=t.prototype;return a.onLoad=function(){},a.onDestroy=function(){},a.onShow=function(){this.playTitleAnim(),e.prototype.onShow.call(this)},a.start=function(){},a.onEnable=function(){this.additionList.refreshData(this.listData),this.InitDailySelectionView(),this.IniFreeItemView(),z.ins.addEventListener(L.Main_Time,this.TimeRunning,this)},a.onDisable=function(){z.ins.removeEventListener(L.Main_Time,this.TimeRunning,this)},a.OnMsg=function(e){"InitDailySelectionView"===e&&this.InitDailySelectionView(),"IniFreeItemView"===e&&this.IniFreeItemView()},a.playTitleAnim=function(){var e=this;u(this.Title.getComponent(p)).set({top:-this.Title.getComponent(f).height}).call((function(){e.blackBg.active=!0,u(e.blackBg.getComponent(h)).set({opacity:0}).to(.2,{opacity:200},{easing:y.sineOut}).delay(.1).to(.15,{opacity:0},{easing:y.sineOut}).call((function(){e.blackBg.active=!1})).start()})).delay(.1).to(.3,{top:0},{easing:y.sineOut}).start()},a.InitDailySelectionView=function(){var e=v.ins.DailySelectionDatas;if(0!==e.length)for(var t=0;t<e.length;t++){var n=null;this.DailyElectionContent.children.length>t?n=this.DailyElectionContent.children[t]:(n=m(this.DailyElectionItem),this.DailyElectionContent.addChild(n));var i=n.getComponent(w);i||(i=n.addComponent(w)),null!=i&&(i.SetData(e[t]),i.RefreshView())}else this.DailyElection.active=!1},a.IniFreeItemView=function(){if(this.FreeZoneItemContent.children.length<2){var e=m(this.FreeZoneItem);this.FreeZoneItemContent.addChild(e)}var t=v.ins.GetSelectionDataList();if(0!=Object.keys(t).length)try{var n=0;for(var i in t)if(2==t[i].gooodsType){if(this.FreeZoneItemContent.children.length<=n){var o=m(this.FreeZoneItem);this.FreeZoneItemContent.addChild(o)}var a=this.FreeZoneItemContent.children[n].getComponent(C);null!=a&&(2==t[i].goodsInfo?a.SetData(t[i],F.Coin):a.SetData(t[i],F.Soldier),a.Init()),n++}}catch(e){d(e.Message)}else this.FreeZone.active=!1},a.UpdateAttributeTask=function(){},a.TimeRunning=function(){var e=E.ins.FightingSoldier_LocalizationJson.find((function(e){return e.Key===Z.D_NextRefreshTime}));this.TimeText.string=(null==e?void 0:e.Chinese)+": "+v.ins.GetTimeStrByType(S.DailySelect)},a.onClose=function(){D.ins.closeUI(t)},t}(I)).prefabUrl="Shop/ShopMainUI",N=t((G=ee).prototype,"Title",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(G.prototype,"blackBg",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(G.prototype,"additionList",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(G.prototype,"DailyElectionItem",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(G.prototype,"DailyElectionContent",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(G.prototype,"FreeZoneItem",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(G.prototype,"FreeZoneItemContent",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(G.prototype,"FreeZone",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(G.prototype,"DailyElection",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(G.prototype,"TimeText",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=G))||W));a._RF.pop()}}}));

System.register("chunks:///_virtual/SmallestEnclosingCircle.ts",["cc"],(function(t){"use strict";var n,r;return{setters:[function(t){n=t.cclegacy,r=t.math}],execute:function(){n._RF.push({},"6a3ed3vAk1PRqi+QcYv3e7w","SmallestEnclosingCircle",void 0);t("SmallestEnclosingCircle",function(){function t(){}return t.MakeCircle=function(t){for(var n=[].concat(t),i=n.length-1;i>0;i--){var a=r.randomRangeInt(0,i+1),c=n[i];n[i]=n[a],n[a]=c}for(var s=e.INVALID,o=0;o<n.length;o++){var u=n[o];(s.r<0||!s.Contains(u))&&(s=this.MakeCircleOnePoint(n.slice(0,o+1),u))}return s},t.MakeCircleOnePoint=function(t,n){for(var r=new e(n,0),i=0;i<t.length;i++){var a=t[i];r.Contains(a)||(r=0==r.r?this.MakeDiameter(n,a):this.MakeCircleTwoPoints(t.slice(0,i+1),n,a))}return r},t.MakeDiameter=function(t,n){var r=new i((t.x+n.x)/2,(t.y+n.y)/2);return new e(r,Math.max(r.Distance(t),r.Distance(n)))},t.MakeCircleTwoPoints=function(t,n,r){for(var i=this.MakeDiameter(n,r),a=e.INVALID,c=e.INVALID,s=r.Subtract(n),o=0;o<t.length;o++){var u=t[o];if(!i.Contains(u)){var h=s.Cross(u.Subtract(n)),l=this.MakeCircumcircle(n,r,u);l.r<0||(h>0&&(a.r<0||s.Cross(l.c.Subtract(n))>s.Cross(a.c.Subtract(n)))?a=l:h<0&&(c.r<0||s.Cross(l.c.Subtract(n))<s.Cross(c.c.Subtract(n)))&&(c=l))}}return a.r<0&&c.r<0?i:a.r<0?c:c.r<0||a.r<=c.r?a:c},t.MakeCircumcircle=function(t,n,r){var a=(Math.min(Math.min(t.x,n.x),r.x)+Math.max(Math.min(t.x,n.x),r.x))/2,c=(Math.min(Math.min(t.y,n.y),r.y)+Math.max(Math.min(t.y,n.y),r.y))/2,s=t.x-a,o=t.y-c,u=n.x-a,h=n.y-c,l=r.x-a,x=r.y-c,f=2*(s*(h-x)+u*(x-o)+l*(o-h));if(0==f)return e.INVALID;var v=new i(a+((s*s+o*o)*(h-x)+(u*u+h*h)*(x-o)+(l*l+x*x)*(o-h))/f,c+((s*s+o*o)*(l-u)+(u*u+h*h)*(s-l)+(l*l+x*x)*(u-s))/f),M=Math.max(Math.max(v.Distance(t),v.Distance(n)),v.Distance(r));return new e(v,M)},t}());var i=t("Point",function(){function t(t,n){this.x=void 0,this.y=void 0,this.x=t,this.y=n}var n=t.prototype;return n.Subtract=function(n){return new t(this.x-n.x,this.y-n.y)},n.Distance=function(t){var n=this.x-t.x,r=this.y-t.y;return Math.sqrt(n*n+r*r)},n.Cross=function(t){return this.x*t.y-this.y*t.x},t}()),e=t("Circle",function(){function t(t,n){this.MULTIPLICATIVE_EPSILON=1+1e-14,this.c=void 0,this.r=void 0,this.c=t,this.r=n}return t.prototype.Contains=function(t){return this.c.Distance(t)<=this.r*this.MULTIPLICATIVE_EPSILON},t}());e.INVALID=new e(new i(0,0),-1),n._RF.pop()}}}));

System.register("chunks:///_virtual/SoldierCard.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Utils.ts","./UIGray.ts","./ReadTablesManager.ts"],(function(e){"use strict";var n,t,i,r,a,o,l,c,u,s,p,f,d,b,g,h,y,v,S,w;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.createClass,o=e.asyncToGenerator,l=e.regeneratorRuntime},function(e){c=e.cclegacy,u=e._decorator,s=e.Node,p=e.Sprite,f=e.Label,d=e.Button,b=e.Component,g=e.tween,h=e.v3,y=e.easing},function(e){v=e.UIUtils},function(e){S=e.UIGray},function(e){w=e.ReadTablesManager}],execute:function(){var m,C,L,I,z,U,F,k,G,O,B,_,R,T,A;c._RF.push({},"bf5d2HmcFNFq4/O516pwBIa","SoldierCard",void 0);var D=u.ccclass,M=u.property;e("SoldierCard",(m=D("SoldierCard"),C=M(s),L=M(s),I=M(p),z=M(f),U=M(f),F=M(f),m((O=n((G=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return n=e.call.apply(e,[this].concat(a))||this,i(n,"back",O,r(n)),i(n,"front",B,r(n)),i(n,"icon",_,r(n)),i(n,"nameLabel",R,r(n)),i(n,"levelLabel",T,r(n)),i(n,"descriptionLabel",A,r(n)),n.isOpened=!1,n}t(n,e);var c=n.prototype;return c.onEnable=function(){this.SwitchCardUI(!1)},c.ShowCardFront=function(){var e=o(l().mark((function e(n,t){var i=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=!1),e.abrupt("return",new Promise((function(e){i.isOpened=!0,i.SwitchCardButton(!1);var r=w.ins.FightingSoldier_LocalizationJson.find((function(e){return e.Key===v.getSoldierNameByType(n.type)}));i.nameLabel.string=null==r?void 0:r.Chinese,v.GetSoldierSprite(n.type).then((function(e){i.icon.spriteFrame=e}));var a=w.ins.FightingSoldier_LocalizationJson.find((function(e){return e.Key===v.GetSoldierDes(n.type)}));i.descriptionLabel.string=null==a?void 0:a.Chinese,i.levelLabel.string="LV.1",i.front.active=!1,t?g(i.back).to(.2,{eulerAngles:h(30,90,0)},{easing:y.sineIn}).call((function(){i.front.active=!0,g(i.front).set({eulerAngles:h(30,90,0)}).to(.2,{eulerAngles:h(0,0,0)},{easing:y.sineOut}).call((function(){i.SwitchCardUI(!0),e()})).start()})).start():(i.SwitchCardUI(!0),e())})));case 2:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),c.SwitchCardButton=function(e){if(!this.isOpened||!e){var n=this.node.getComponent(d);null!=n&&(n.interactable=e)}},c.SwitchCardUI=function(e){this.back.active=!e,this.front.active=e},c.GrayCard=function(){S.SetGray(this.node)},a(n,[{key:"IsOpened",get:function(){return this.isOpened}}]),n}(b)).prototype,"back",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(G.prototype,"front",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=n(G.prototype,"icon",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=n(G.prototype,"nameLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(G.prototype,"levelLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(G.prototype,"descriptionLabel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=G))||k));c._RF.pop()}}}));

System.register("chunks:///_virtual/SoldierDrag.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Entity.ts"],(function(t){"use strict";var o,e,s,i,r,n,d;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy,s=t._decorator,i=t.Vec3,r=t.v3,n=t.Component},function(t){d=t.Entity}],execute:function(){var l;e._RF.push({},"6878cSc3A5D+YrRT3rhlbcK","SoldierDrag",void 0);var a=s.ccclass;s.property,t("SoldierDrag",a("SoldierDrag")(l=function(t){function e(){for(var o,e=arguments.length,s=new Array(e),i=0;i<e;i++)s[i]=arguments[i];return(o=t.call.apply(t,[this].concat(s))||this).tempV3=r(),o.offset=r(),o.targetWorldPos=r(),o}o(e,t);var s=e.prototype;return s.init=function(t){this.offset.set(i.subtract(this.tempV3,this.node.position,t)),this.targetWorldPos.set(this.node.worldPosition)},s.setTargetWorldPos=function(t){this.targetWorldPos.set(t).add(this.offset)},s.update=function(t){this.node.worldPosition.equals(this.targetWorldPos,.005)?this.node.worldPosition.strictEquals(this.targetWorldPos)||(this.node.setWorldPosition(this.targetWorldPos),this.node.getComponent(d).updateShadowWorldPosition()):(i.lerp(this.tempV3,this.node.worldPosition,this.targetWorldPos,20*t),this.node.setWorldPosition(this.tempV3),this.node.getComponent(d).updateShadowWorldPosition())},e}(n))||l);e._RF.pop()}}}));

System.register("chunks:///_virtual/SoldierLatticeModel.ts",["cc","./GameData.ts"],(function(t){"use strict";var e,i;return{setters:[function(t){e=t.cclegacy},function(t){i=t.UnitCategory}],execute:function(){e._RF.push({},"454d2Rsm8dDnJ2ifElnMKMJ","SoldierLatticeModel",void 0);t("PlayerLatticeModel",(function(){this.id=void 0,this.index=void 0,this.isSimple=0,this.isOpen=0})),t("SoldierLatticeModel",function(){function t(t){this.index=0,this.category=i.SwordMan,this.type=void 0,this.showEffect=!1,this.formation=void 0,this.level=void 0,t&&(this.index=t.index,this.category=t.category,this.type=t.type,this.showEffect=t.showEffect,this.formation=t.formation,this.level=t.level)}return t.prototype.order=function(){var t=1;switch(this.type){case"sword":t=1;break;case"hammer":t=2;break;case"gun":t=3;break;case"bow":t=4;break;case"mage":t=5;break;case"knight":t=6;break;default:t=1}return t},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/SoldierSkillData.ts",["cc"],(function(i){"use strict";var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"fac12V6vDlPF6WrSiO8MVT1","SoldierSkillData",void 0);i("SoldierSkillsData",(function(){this.id=void 0,this.skillName=void 0,this.skillInfo=void 0,this.skillType=void 0,this.targetDistance=void 0,this.SkillRange=void 0,this.continueTime=void 0,this.damageOdds=void 0,this.repeatTimes=void 0,this.awakeCD=void 0,this.averageCD=void 0,this.special_0=void 0,this.special_1=void 0,this.special_2=void 0})),i("SoldierUpgrade",(function(){this.OriginalSoldier=void 0,this.OriginalLevel=void 0,this.needNum=void 0,this.cardNum=void 0,this.targetSoldier=void 0,this.targetLevel=void 0,this.targetNum=void 0}));t._RF.pop()}}}));

System.register("chunks:///_virtual/Squad.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Utils.ts","./GameSettings.ts","./GameController.ts"],(function(t){"use strict";var i,s,e,n,o,a,h,r,l;return{setters:[function(t){i=t.inheritsLoose},function(t){s=t.cclegacy,e=t._decorator,n=t.Vec2,o=t.v2,a=t.Component},function(t){h=t.Utils},function(t){r=t.GameSettings},function(t){l=t.GameController}],execute:function(){var c;s._RF.push({},"1fca8n90iNDdYw2sEtGpR7v","Squad",void 0);var u=e.ccclass;e.property,t("Squad",u("Squad")(c=function(t){function s(){for(var i,s=arguments.length,e=new Array(s),n=0;n<s;n++)e[n]=arguments[n];return(i=t.call.apply(t,[this].concat(e))||this).sid=0,i.members=[],i.alive=!1,i.isRushing=!1,i.isEnemy=!1,i.position=o(),i.maxSpeed=0,i.velocity=o(),i.acceleration=o(),i.rushQuat=void 0,i.rushDuration=0,i.rushDirection=o(),i.target=null,i.hasTarget=!1,i.destination=o(),i.hasDestination=!1,i.maxAcceleration=0,i}i(s,t);var e=s.prototype;return e.onLoad=function(){this.members=[]},e.Reset=function(){this.velocity=n.ZERO,this.isRushing=!1,this.hasTarget=!1,this.target=null,this.hasDestination=!1},e.AddMember=function(t){this.members.push(t);var i=h.GetCenterPoint(this.members),s=new n(i.x,i.y);this.node.setPosition(s.x,0,s.y),this.position.set(s);for(var e=0,o=this.members.length;e<o;e++)n.subtract(this.members[e].squadPosOffset,this.members[e].position,s);this.alive=!0},e.RemoveMember=function(t){var i=this.members.findIndex((function(i){return i===t}));-1!==i&&this.members.splice(i,1);var s=h.GetCenterPoint(this.members),e=new n(s.x,s.y);this.position.set(e),this.node.setPosition(this.position.x,0,this.position.y);for(var o=0,a=this.members.length;o<a;o++)n.subtract(this.members[o].squadPosOffset,this.members[o].position,e);this.alive=this.members.length>0},e.HasMember=function(t){return-1!==this.members.indexOf(t)},e.StartRush=function(t,i){if(!this.isRushing){this.isRushing=!0,this.rushDirection=t;var s=r.ins,e=3-i;this.isEnemy&&(e=0),n.multiplyScalar(this.acceleration,t,s.rushAcceleration[e]),this.maxSpeed=s.rushMaxSpeed[e],this.rushDuration=s.assaultDuration[e]}},e.OnEntityKilled=function(t){this.hasTarget&&t==this.target&&(this.hasTarget=!1,t=null)},e.Tick=function(){this.isRushing?this.ExeRush():this.ExeNormal()},e.ExeNormal=function(){if(this.hasTarget||(this.target=this.SelectMemberTarget(),this.hasTarget=null!=this.target),this.hasTarget)this.destination.set(this.target.position),this.hasDestination=!0;else if(!this.hasDestination){var t=this.SelectOneEnemy();t&&(this.destination.set(t.position),this.hasDestination=!0)}var i=l.ins.dt;if(this.hasDestination){var s,e=new n(this.destination.x-this.position.x,this.destination.y-this.position.y);if(e.normalize(),n.multiplyScalar(this.acceleration,e,this.maxAcceleration),this.velocity.x+=this.acceleration.x*i,this.velocity.y+=this.acceleration.y*i,(s=this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y)>this.maxSpeed*this.maxSpeed){s=Math.sqrt(s);var o=this.maxSpeed/s;this.velocity.x*=o,this.velocity.y*=o}this.position.x+=this.velocity.x*i,this.position.y+=this.velocity.y*i,this.node.setPosition(this.position.x,0,this.position.y)}},e.ExeRush=function(){var t=l.ins.dt;this.velocity.add(this.acceleration.clone().multiplyScalar(t));var i=this.velocity.lengthSqr();i>this.maxSpeed*this.maxSpeed&&(i=Math.sqrt(i),this.velocity.multiplyScalar(1/i),this.velocity.multiplyScalar(this.maxSpeed)),this.position.add(this.velocity.clone().multiplyScalar(t)),this.node.setPosition(this.position.x,0,this.position.y),this.rushDuration-=t,this.rushDuration<=0&&this.StopRush()},e.StopRush=function(){this.isRushing=!1;var t=r.ins;this.maxAcceleration=t.rushAcceleration[0],this.maxSpeed=t.rushMaxSpeed[0]},e.SelectMemberTarget=function(){for(var t=this.members.length,i=0;i<t;i++){var s=this.members[i];if(s.alive&&s.hasTarget)return s.attackTarget}return null},e.SelectOneEnemy=function(){for(var t=l.ins.enemySoldiers,i=t.length,s=0;s<i;s++){var e=t[s];if(e.isEnemy!=this.isEnemy&&e.alive)return e}return null},s}(a))||c);s._RF.pop()}}}));

System.register("chunks:///_virtual/SquadController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Squad.ts","./GameController.ts","./Utils.ts"],(function(t){"use strict";var n,e,i,s,o,a,u,r,l;return{setters:[function(t){n=t.createClass},function(t){e=t.cclegacy,i=t.Vec2,s=t.v2,o=t.Node,a=t.NodePool},function(t){u=t.Squad},function(t){r=t.GameController},function(t){l=t.Utils}],execute:function(){e._RF.push({},"9774fceTdtLyJUfv3fv49dw","SquadController",void 0),t("SquadController",function(){function t(){this.squads=[],this.squadPool=new a,this.currSid=1}var e=t.prototype;return e.InitRushSquads=function(t,n){var e=l.GetCenterPoint(r.ins.mySoldiers),o=this.CreateSquad();o.position=new i(e.x,e.y),o.isEnemy=!1,r.ins.mySoldiers.forEach((function(t){t.JoinSquad(o),t.rotateWithSquad=!0}));var a=l.GetCenterPoint(r.ins.enemySoldiers),u=this.CreateSquad();u.isEnemy=!0,u.position=new i(a.x,a.y),r.ins.enemySoldiers.forEach((function(t){t.JoinSquad(u),t.rotateWithSquad=!0}));var d=s();i.subtract(d,u.position,o.position),d.normalize(),u.StartRush(d.negative(),n),o.StartRush(t,n)},e.CreateSquad=function(){var t=null;if(this.squadPool.size()>0)(t=this.squadPool.get().getComponent(u)).Reset();else{var n=new o;t=n.addComponent(u),r.ins.GameWorld.addChild(n)}return t.sid=this.currSid++,this.squads.push(t),t},e.RemoveAll=function(){this.squads.length=0},e.OnEntityKilled=function(t){for(var n,e=this.squads.length,i=0;i<e;i++)(n=this.squads[i]).alive&&n.OnEntityKilled(t)},e.Tick=function(){for(var t=this.squads.length,n=0;n<t;){var e=this.squads[n];e.alive?(e.Tick(),n++):(this.squads.splice(n,1),t--)}},n(t,null,[{key:"ins",get:function(){return t._instance||(t._instance=new t),t._instance}}]),t}())._instance=null,e._RF.pop()}}}));

System.register("chunks:///_virtual/StateDefine.ts",["cc"],(function(){"use strict";var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"0b1baV+mYFFJJvVL6RaKH0G","StateDefine",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/SteerEntity.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameController.ts","./Entity.ts","./EntityProperty.ts","./GameData.ts"],(function(t){"use strict";var e,i,r,a,n,s,o,l,c,u,h,d,p,y,m,f,g,v,b,x,S;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,a=t.assertThisInitialized,n=t.createClass},function(t){s=t.cclegacy,o=t._decorator,l=t.v2,c=t.v3,u=t.quat,h=t.Enum,d=t.CCFloat,p=t.math,y=t.Vec2,m=t.Quat,f=t.misc,g=t.Component},function(t){v=t.GameController},function(t){b=t.AssaultProperty},function(t){x=t.EntityProperty},function(t){S=t.UnitCategory}],execute:function(){var _,w,F,z,C,A,P,E,D,T,M,R,G;s._RF.push({},"a6ff18hEmlLRJd/KA7JuFD/","SteerEntity",void 0);var k=o.ccclass,L=o.property,q=(l(0,1),l(),l()),B=(l(),l()),I=l(),Q=l(),U=(c(),u()),J=u();t("SteerEntity",(_=k("SteerEntity"),w=L({type:h(S),displayName:"UnitCat Type",tooltip:"士兵类型",visible:function(){return!this.isGeneral}}),F=L({type:d,visible:function(){return this.isGeneral||this.unitCat===S.Paladin}}),_((A=e((C=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,r(e,"unitCat",A,a(e)),r(e,"radius",P,a(e)),r(e,"arrivalThreshold",E,a(e)),r(e,"wanderAngle",D,a(e)),r(e,"avoidDistance",T,a(e)),r(e,"avoidBuffer",M,a(e)),r(e,"max_seeAhead",R,a(e)),r(e,"isGeneral",G,a(e)),e.isEnemy=!1,e.mass=50,e.maxForce=20,e._steeredForce=l(),e.circleDistance=1,e.circleRadius=.5,e.angleChange=.3,e.separationRadius=.5,e.maxSeparation=15,e.velocity=l(),e.forward=l(),e.id=0,e.angularSpeed=480,e.lastAngle=0,e.Scale=1,e.entityProperty=new x,e.assaultProperty=new b,e.isAssaultIng=!1,e._position=l(),e.attackTarget=null,e.neighborCount=0,e}i(e,t);var s=e.prototype;return s.fixedUpdate=function(t){var e=Math.max(this.entityProperty.maxSpeed,this.assaultProperty.maxSpeed);if(this._steeredForce.lengthSqr()>this.maxForce*this.maxForce&&this._steeredForce.multiplyScalar(this.maxForce/this._steeredForce.length()),this._steeredForce.multiplyScalar(1/this.mass),this.velocity.add(this._steeredForce),this._steeredForce.set(0,0),this.velocity.lengthSqr()>e*e&&this.velocity.multiplyScalar(e/this.velocity.length()),this._position.add(Q.set(this.velocity).multiplyScalar(t)),this.node.setPosition(this._position.x,0,this._position.y),this.attackTarget){var i=Q.set(-this.node.forward.x,-this.node.forward.z),r=p.toDegree(this.forward.signAngle(i)),a=Math.min(this.angularSpeed*t,Math.abs(r)),n=r<0?a:-a,s=this.node.getRotation(),o=this._rotateQuat(n,J.set(s.x,s.y,s.z,s.w));this.node.setRotation(o),this.lastAngle+=n;var l=y.subtract(B,this.attackTarget.position,this.position);I.set(-this.node.forward.x,-this.node.forward.z);y.angle(l,Q)}},s._rotateQuat=function(t,e){var i=c(0,1,0),r=-t;return m.rotateAround(U,e,i.normalize(),f.degreesToRadians(r))},s.bounce=function(t){var e=!1,i=this.position,r=this.velocity;return i.x>t.width+t.x?(i.x=t.width+t.x,r.x*=-1,e=!0):i.x<t.x&&(i.x=t.x,r.x*=-1,e=!0),i.y>t.height+t.y?(i.y=t.height+t.y,r.y*=-1,e=!0):i.y<t.y&&(i.y=t.y,r.y*=-1,e=!0),e},s.onLoad=function(){},s.seek=function(t){var e=Math.max(this.entityProperty.maxSpeed,this.assaultProperty.maxSpeed),i=y.subtract(q,t,this._position).normalize();i.multiplyScalar(e);var r=i.subtract(this.velocity);this._steeredForce.add(r)},s.flee=function(t){var e=y.subtract(q,t,this._position).normalize();e.multiplyScalar(this.entityProperty.maxSpeed);var i=e.subtract(this.velocity).multiplyScalar(.2);this._steeredForce.subtract(i)},s.arrive=function(t){var e=y.subtract(q,t,this._position).normalize(),i=y.distance(this._position,t);i>this.arrivalThreshold?e.multiplyScalar(this.entityProperty.maxSpeed):e.multiplyScalar(this.entityProperty.maxSpeed*i/this.arrivalThreshold);var r=e.subtract(this.velocity);this._steeredForce.add(r)},s.wander=function(){var t=Q.set(this.velocity.x,this.velocity.y);t.normalize().multiplyScalar(this.circleDistance);var e=I.set(0,-1);e.multiplyScalar(this.circleRadius),this.setAngle(e,this.wanderAngle),this.wanderAngle+=Math.random()*this.angleChange-.5*this.angleChange,t.add(e);var i=y.add(q,t,e);this._steeredForce.add(i)},s.setAngle=function(t,e){var i=t.length();t.x=Math.cos(e)*i,t.y=Math.sin(e)*i},s.separation=function(){this.isAssaultIng?this.isEnemy?v.ins.mySoldiers:v.ins.enemySoldiers:v.ins.steerEntities;var t=Q.set(0,0);return this.neighborCount=0,0!==this.neighborCount&&t.multiplyScalar(1/this.neighborCount).negative(),t.normalize().multiplyScalar(this.maxSeparation),this._steeredForce.add(t),!1},s.idle=function(){this.velocity.set(0,0),this._steeredForce.set(0,0)},n(e,[{key:"position",get:function(){return this._position},set:function(t){this._position.set(t),this.node.setPosition(this._position.x,0,this._position.y)}}]),e}(g)).prototype,"unitCat",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return S.SwordMan}}),P=e(C.prototype,"radius",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),E=e(C.prototype,"arrivalThreshold",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),D=e(C.prototype,"wanderAngle",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),T=e(C.prototype,"avoidDistance",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),M=e(C.prototype,"avoidBuffer",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),R=e(C.prototype,"max_seeAhead",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),G=e(C.prototype,"isGeneral",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),z=C))||z));s._RF.pop()}}}));

System.register("chunks:///_virtual/TimeUtil.ts",["cc","./Utils.ts"],(function(t){"use strict";var e,n,i;return{setters:[function(t){e=t.cclegacy,n=t._decorator},function(t){i=t.Utils}],execute:function(){e._RF.push({},"c5d36bY+dxLBbAwg7FZ5Pbf","TimeUtil",void 0);n.ccclass,n.property,t("TimeUtil",function(){function t(){}return t.GetNowTime=function(){return Date.now()},t.GetTimeInterval=function(t,e){var n=e-(Date.now()-t)/1e3;return i.FormatTime_HH_MM_SS(Math.floor(n))},t.GetTimeIntervalInt=function(t,e){return e-(Date.now()-t)/1e3},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/Turntable.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Utils.ts"],(function(e){"use strict";var t,n,l,i,a,r,s,o,h,d,u,c,g,p,f,w,C,b,L,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,l=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,s=e.Prefab,o=e.Node,h=e.UIOpacity,d=e.v3,u=e.log,c=e.tween,g=e.easing,p=e.instantiate,f=e.Graphics,w=e.Color,C=e.Label,b=e.math,L=e.Component},function(e){y=e.Utils}],execute:function(){var v,A,m,T,I,B,N;a._RF.push({},"327d3NaTOND95CK31EykCuz","Turntable",void 0);var k=r.ccclass,U=r.property;e("Turntable",(v=k("Turntable"),A=U(s),m=U(o),v((B=t((I=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,l(t,"UnitPrefab",B,i(t)),l(t,"Container",N,i(t)),t.targetId=0,t.defaultAngle=0,t.WheelCount=10,t.singleAngle=0,t.wheelList=[],t.endCallBack=null,t.endCallThis=null,t}n(t,e);var a=t.prototype;return a.onLoad=function(){this.singleAngle=360/this.WheelCount,this.wheelList.push({node:null,reward:1}),this.wheelList.push({node:null,reward:1}),this.wheelList.push({node:null,reward:1}),this.wheelList.push({node:null,reward:1}),this.wheelList.push({node:null,reward:1}),this.wheelList.push({node:null,reward:2}),this.wheelList.push({node:null,reward:2}),this.wheelList.push({node:null,reward:2}),this.wheelList.push({node:null,reward:3}),this.wheelList.push({node:null,reward:3})},a.startRotate=function(e,t){this.endCallBack=e,this.endCallThis=t,this.reset()},a.reset=function(){this.node.getComponent(h).opacity=255,this.node.scale=d(1,1,1),this.node.setPosition(d()),this.resetTurntableUI(),this.targetId=this.wheelList.findIndex((function(e){return 1===e.reward})),this.defaultAngle=0;var e=this.caculateFinalAngle();u(this.targetId,e,"degreedegree"),c(this.Container).set({angle:0}).to(5,{angle:-3600+e},{easing:g.quadInOut}).call(this.onRotateEnd.bind(this)).start()},a.onRotateEnd=function(){var e=this,t=this.wheelList[this.targetId].node.getChildByName("Label").children[0];c(t).call((function(){c(e.node).call((function(){c(e.node.getComponent(h)).to(.6,{opacity:0}).start()})).to(.6,{scale:d(0,0,0),position:d(0,0,0)},{easing:g.backIn}).start(),e.endCallBack&&e.endCallThis&&e.endCallBack.call(e.endCallThis,e.wheelList[e.targetId].reward)})).to(.4,{scale:d(1.2,1.2,1.2)},{easing:g.backOut}).start()},a.caculateFinalAngle=function(){return 360-this.targetId*this.singleAngle+this.defaultAngle},a.resetTurntableUI=function(){for(var e=y.randomSort(this.wheelList),t=!1,n=0;n<e.length;n++){if(null===e[n].node){var l=p(this.UnitPrefab);this.Container.addChild(l);var i=l.getChildByName("Graphics").getComponent(f);this.createArc(i,n),e[n].node=l}e[n].node.angle=this.singleAngle*n+90-this.singleAngle/2;var a=null;a=new w(t?"84a1f4":"a7bcf7");var r=e[n].node.getChildByName("Graphics").getComponent(f);r.fillColor=a,r.fill(),t=!t;var s=e[n].node.getChildByName("Label").children[0].getComponent(C);if(null!==s){var o=null;s.string="x"+e[n].reward,1==e[n].reward?o=w.YELLOW:2==e[n].reward?o=w.CYAN:3==e[n].reward&&(o=w.MAGENTA),s.color=o}}},a.createArc=function(e,t){e.fillColor=new w(t%2==0?"84a1f4":"a7bcf7");var n=b.toRadian(0),l=b.toRadian(this.singleAngle);e.arc(0,0,174,n,l,!0),e.lineTo(0,0),e.fill(),e.stroke(),e.node.parent.getChildByName("Label").angle=this.singleAngle/2},t}(L)).prototype,"UnitPrefab",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(I.prototype,"Container",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=I))||T));a._RF.pop()}}}));

System.register("chunks:///_virtual/U3dParticle2Cocos.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var o,a,t,i,r,l,n,s,c,p,u,d;return{setters:[function(e){o=e.inheritsLoose},function(e){a=e.cclegacy,t=e._decorator,i=e.Enum,r=e.CurveRange,l=e.ColorKey,n=e.AlphaKey,s=e.GradientRange,c=e.ParticleSystem,p=e.Burst,u=e.Node,d=e.Component}],execute:function(){var m;a._RF.push({},"b4ff2+1BCVC35AKHTpOF5Xc","U3dParticle2Cocos",void 0);var h,M,y=t.ccclass,v=(t.property,t.executeInEditMode);!function(e){e[e.Box=0]="Box",e[e.Circle=1]="Circle",e[e.Cone=2]="Cone",e[e.Sphere=3]="Sphere",e[e.Hemisphere=4]="Hemisphere"}(h||(h={})),function(e){e[e.Base=0]="Base",e[e.Edge=1]="Edge",e[e.Shell=2]="Shell",e[e.Volume=3]="Volume"}(M||(M={}));var g=i({Random:0,Loop:1,PingPong:2});e("U3dParticle2Cocos",y("U3dParticle2Cocos")(m=v(m=function(e){function a(){return e.apply(this,arguments)||this}o(a,e);var t=a.prototype;return t.start=function(){},t.update=function(e){},t.setColor=function(e,o){e.r=255*o.r,e.g=255*o.g,e.b=255*o.b,e.a=255*o.a},t.applyTransform=function(e,o){var a=o.m_LocalPosition;e.position=a,e.rotation=o.m_LocalRotation,e.scale=o.m_LocalScale},t.applyCurveRange=function(e,o){switch(e.mode=o.minMaxState,e.mode){case r.Mode.Constant:e.constant=o.scalar;break;case r.Mode.TwoConstants:e.constantMin=o.minScalar,e.constantMax=o.scalar}},t.applyGradient=function(e,o){e.mode=o.m_Mode;var a=[],t=[];if(o.m_NumColorKeys>0)for(var i=0;i<o.m_NumColorKeys;i++){var r=new l;this.setColor(r.color,o["key"+i]),a.push(r)}if(o.m_NUmAlphaKeys>0)for(var s=0;s<o.m_NUmAlphaKeys;s++){var c=new n;c.alpha=255*o["key"+s].a,t.push(c)}e.setKeys(a,t)},t.applyGradientRange=function(e,o){switch(e.mode=o.minMaxState,e.mode){case s.Mode.Color:this.setColor(e.color,o.maxColor);break;case s.Mode.Gradient:this.applyGradient(e.gradient,o.maxGradient);break;case s.Mode.TwoColors:this.setColor(e.colorMin,o.minColor),this.setColor(e.colorMax,o.maxColor);break;case s.Mode.TwoGradients:this.applyGradient(e.gradientMin,o.minGradient),this.applyGradient(e.gradientMax,o.maxGradient)}},t.applyShapeArc=function(e,o){e.arcMode=o.arc.mode,e.arc=o.arc.value,e.arcMode!=g.Loop&&e.arcMode!=g.PingPong||(e.arcSpread=o.arc.spreed,this.applyCurveRange(e.arcSpeed,o.arc.speed))},t.applyShapeModule=function(e,o){var a=e.shapeModule;switch(o.type){case 5:a.shapeType=h.Box,a.emitFrom=M.Volume;break;case 15:a.shapeType=h.Box,a.emitFrom=M.Shell;break;case 16:a.shapeType=h.Box,a.emitFrom=M.Edge;break;case 10:a.shapeType=h.Circle;break;case 4:a.shapeType=h.Cone,a.emitFrom=M.Base;break;case 8:a.shapeType=h.Cone,a.emitFrom=M.Volume;break;case 0:a.shapeType=h.Sphere;break;case 2:a.shapeType=h.Hemisphere}switch(a.position.set(o.m_Position),a.rotation.set(o.m_Rotation),a.scale.set(o.m_Scale),a.alignToDirection=!!o.alignToDirection,a.randomDirectionAmount=o.randomDirectionAmount,a.sphericalDirectionAmount=o.sphericalDirectionAmount,a.randomPositionAmount=o.randomPositionAmount,a.shapeType){case h.Box:a.boxThickness.set(o.boxThickness);break;case h.Circle:a.radius=o.radius.value,this.applyShapeArc(a,o);break;case h.Cone:a.radius=o.radius.value,a.radiusThickness=o.radiusThickness,a.angle=o.angle,this.applyShapeArc(a,o),a.length=o.length;break;case h.Sphere:case h.Hemisphere:a.radius=o.radius.value,a.radiusThickness=o.radiusThickness,this.applyShapeArc(a,o)}},t.applyVelocityOvertimeModule=function(e,o){var a=e.velocityOvertimeModule;this.applyCurveRange(a.x,o.x),this.applyCurveRange(a.y,o.y),this.applyCurveRange(a.z,o.z),this.applyCurveRange(a.speedModifier,o.speedModifier),0==o.inWorldSpace?a.space=1:1==o.inWorldSpace&&(a.space=0)},t.applyForceOvertimeModule=function(e,o){var a=e.forceOvertimeModule;this.applyCurveRange(a.x,o.x),this.applyCurveRange(a.y,o.y),this.applyCurveRange(a.z,o.z),0==o.inWorldSpace?a.space=1:1==o.inWorldSpace&&(a.space=0)},t.applySizeOvertimeModule=function(e,o){var a=e.sizeOvertimeModule;a.separateAxes=!!o.separateAxes,this.applyCurveRange(a.size,o.curve),a.separateAxes&&(this.applyCurveRange(a.x,o.curve),this.applyCurveRange(a.y,o.y),this.applyCurveRange(a.z,o.z))},t.applyRotationOvertimeModule=function(e,o){var a=e.rotationOvertimeModule;a.separateAxes=!!o.separateAxes,this.applyCurveRange(a.z,o.curve),a.separateAxes&&(this.applyCurveRange(a.x,o.x),this.applyCurveRange(a.y,o.y))},t.applyColorOverLifetimeModule=function(e,o){var a=e.colorOverLifetimeModule;this.applyGradientRange(a.color,o.gradient)},t.applyTextureAnimationModule=function(e,o){0!=o.mode&&console.warn("cocos creator的TextureAnimationModule目前只支持gird模式");var a=e.textureAnimationModule;a.numTilesX=o.tilesX,a.numTilesY=o.tilesY,a.animation=o.animationType,this.applyCurveRange(a.frameOverTime,o.frameOverTime),this.applyCurveRange(a.startFrame,o.startFrame),a.cycleCount=o.cycles,a.randomRow=1==o.rowMode,0==o.rowMode&&(a.rowIndex=o.rowIndex),2==o.rowMode&&console.warn("u3d粒子系统 textureAnimationModule中的rowMode模式meshIndex cocos creator中没有支持")},t.applyLimitVelocityOvertimeModule=function(e,o){var a=e.limitVelocityOvertimeModule;0==o.inWorldSpace?a.space=1:1==o.inWorldSpace&&(a.space=0),a.dampen=o.dampen,a.separateAxes=!!o.separateAxes,a.separateAxes?(this.applyCurveRange(a.limitX,o.x),this.applyCurveRange(a.limitY,o.y),this.applyCurveRange(a.limitZ,o.z)):this.applyCurveRange(a.limit,o.x)},t.applyTrailModule=function(e,o){0!=o.mode&&console.warn("cocos creator 粒子系统的拖尾目前支持支particles模式");var a=e.trailModule;this.applyCurveRange(a.lifeTime,o.lifeTime),a.minParticleDistance=o.minVertexDistance,0==o.inWorldSpace?a.space=1:1==o.inWorldSpace&&(a.space=0),a.widthFromParticle=!!o.sizeAffectsWidth,a.widthRatio=o.ratio,a.colorFromParticle=!!o.inheritParticleColor,this.applyGradientRange(a.colorOverTrail,o.colorOverTrail),this.applyGradientRange(a.colorOvertime,o.colorOverLifetime)},t.applyParticleSystem=function(e,o){var a=e.addComponent(c);if(a.duration=o.lengthInSec,a.capacity=o.InitialModule.maxNumParticles,a.loop=!!o.looping,a.playOnAwake=!!o.playOnAwake,a.simulationSpeed=o.simulationSpeed,this.applyCurveRange(a.startDelay,o.startDelay),this.applyCurveRange(a.startLifetime,o.InitialModule.startLifetime),this.applyGradientRange(a.startColor,o.InitialModule.startColor),a.scaleSpace=o.scalingMode,a.startSize3D=!!o.InitialModule.size3D,this.applyCurveRange(a.startSizeX,o.InitialModule.startSize),a.startSize3D&&(this.applyCurveRange(a.startSizeY,o.InitialModule.startSizeY),this.applyCurveRange(a.startSizeZ,o.InitialModule.startSizeZ)),this.applyCurveRange(a.startSpeed,o.InitialModule.startSpeed),a.startRotation3D=!!o.InitialModule.rotation3D,a.startRotation3D&&(this.applyCurveRange(a.startRotationX,o.InitialModule.startRotationX),this.applyCurveRange(a.startRotationX,o.InitialModule.startRotationY),this.applyCurveRange(a.startRotationX,o.InitialModule.startRotation)),this.applyCurveRange(a.gravityModifier,o.InitialModule.gravityModifier),this.applyCurveRange(a.rateOverTime,o.EmissionModule.rateOverTime),this.applyCurveRange(a.rateOverDistance,o.EmissionModule.rateOverDistance),o.EmissionModule.m_BurstCount>0){for(var t=[],i=0;i<o.EmissionModule.m_BurstCount;i++){var r=o.EmissionModule.m_Bursts[i],l=new p;l.repeatCount=0==r.cycleCount?1/0:r.cycleCount,this.applyCurveRange(l.count,r.countCurve),l.repeatInterval=r.repeatInterval,l.time=r.time,t.push(l)}a.bursts=t}a.noiseModule.enable=!!o.NoiseModule.enabled,a.noiseModule.enable&&(a.noiseModule.octaves=o.NoiseModule.octaves,a.noiseModule.octaves>1&&(a.noiseModule.octaveScale=o.NoiseModule.octaveScale,a.noiseModule.octaveMultiplier=o.NoiseModule.octaveMultiplier),a.noiseModule.noiseFrequency=o.NoiseModule.frequency,0!=o.NoiseModule.strength.minMaxState&&console.warn("cocos creator粒子系统的noiseModule的strength是一个固定值！"),0!=o.NoiseModule.strengthY.minMaxState&&console.warn("cocos creator粒子系统的noiseModule的strength是一个固定值！"),0!=o.NoiseModule.strengthZ.minMaxState&&console.warn("cocos creator粒子系统的noiseModule的strength是一个固定值！"),a.noiseModule.strengthX=o.NoiseModule.strength.scalar,a.noiseModule.strengthY=o.NoiseModule.strengthY.scalar,a.noiseModule.strengthZ=o.NoiseModule.strengthZ.scalar),a.shapeModule.enable=!!o.ShapeModule.enabled,a.shapeModule.enable&&this.applyShapeModule(a,o.ShapeModule),console.log("velocityOvertimeModule"),a.velocityOvertimeModule.enable=!!o.VelocityModule.enabled,a.velocityOvertimeModule.enable&&this.applyVelocityOvertimeModule(a,o.VelocityModule),console.log("forceOvertimeModule"),a.forceOvertimeModule.enable=!!o.ForceModule.enabled,a.forceOvertimeModule.enable&&this.applyForceOvertimeModule(a,o.ForceModule),console.log("sizeOvertimeModule"),a.sizeOvertimeModule.enable=!!o.SizeModule,a.sizeOvertimeModule.enable&&this.applySizeOvertimeModule(a,o.SizeModule),console.log("rotationOvertimeModule"),a.rotationOvertimeModule.enable=!!o.RotationModule.enabled,a.rotationOvertimeModule.enable&&this.applyRotationOvertimeModule(a,o.RotationModule),console.log("colorOverLifetimeModule"),a.colorOverLifetimeModule.enable=!!o.ColorModule.enabled,a.colorOverLifetimeModule.enable&&this.applyColorOverLifetimeModule(a,o.ColorModule),console.log("textureAnimationModule"),a.textureAnimationModule.enable=!!o.UVModule.enabled,a.textureAnimationModule.enable&&this.applyTextureAnimationModule(a,o.UVModule),console.log("limitVelocityOvertimeModule"),a.limitVelocityOvertimeModule.enable=!!o.ClampVelocityModule.enabled,a.limitVelocityOvertimeModule.enable&&this.applyLimitVelocityOvertimeModule(a,o.ClampVelocityModule),console.log("trailModule"),a.trailModule.enable=!!o.TrailModule.enabled,a.trailModule.enable&&this.applyTrailModule(a,o.TrailModule)},t.applyParticleSystemRenderer=function(e,o){e.getComponent(c).renderer.renderMode=o.m_RenderMode,5==o.m_RenderMode&&console.warn("cocos creator 暂不支持none模式的renderMode")},t.createNode=function(e,o,a){console.log("创建节点",o.json.m_Name);var t=new u;t.name=o.json.m_Name,e.addChild(t);for(var i=0;i<o.cmps.length;i++){var r=o.cmps[i];"Transform"==r.u3dType?this.applyTransform(t,r):"ParticleSystem"==r.u3dType?this.applyParticleSystem(t,r):"ParticleSystemRenderer"==r.u3dType&&this.applyParticleSystemRenderer(t,r)}if(o.children.length>0)for(var l=0;l<o.children.length;l++){var n=o.children[l].fileID,s=a[n];s||console.log("fileID:"+n+" child is not exist"),this.createNode(t,s,a)}},t.createPrefab=function(e){var o,a=[],t=[],i={},r=[];e.forEach((function(e){"GameObject"==e.u3dType?a.push({json:e,cmps:[]}):(r[e.fileID]=e,t.push(e))})),a.forEach((function(e){for(var a=0;a<e.json.m_Component.length;a++){var t=e.json.m_Component[a].component.fileID,l=r[t];e.cmps.push(l),"Transform"==l.u3dType&&(i[l.fileID]=e,e.children=l.m_Children,"id0"==l.m_Father.fileID&&(o=e))}})),o?(console.log("创建预制体",o.json.m_Name),this.createNode(this.node,o,i)):(console.log(t),console.log("no root"))},t.doConvert=function(e){for(var o=0;o<e.length;o++)this.createPrefab(e[o])},a}(d))||m)||m);a._RF.pop()}}}));

System.register("chunks:///_virtual/UIGray.ts",["cc"],(function(t){"use strict";var n,e;return{setters:[function(t){n=t.cclegacy,e=t.Sprite}],execute:function(){n._RF.push({},"3f0bdXplp1FZqaaTZNAVffC","UIGray",void 0);t("UIGray",function(){function t(){}return t.SetGray=function(t,n){void 0===n&&(n=!0),t.getComponentsInChildren(e).forEach((function(t){t.grayscale=n}))},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUI.ts","./loading.ts"],(function(t){"use strict";var e,n,i,r,a,o,s,u,c,h,l,p,d,f;return{setters:[function(t){e=t.createClass,n=t.asyncToGenerator,i=t.regeneratorRuntime},function(t){r=t.cclegacy,a=t.find,o=t.Node,s=t.Widget,u=t.resources,c=t.Prefab,h=t.log,l=t.instantiate,p=t.UIOpacity},function(t){d=t.LayerType},function(t){f=t.default}],execute:function(){r._RF.push({},"8ae88XUQIpHTJNF/e5Zpo2c","UIManager",void 0),t("default",function(){function t(){this._tipNode=null,this._uiRoot=null,this._layerList=[],this._uiNodeMap=new Map,this._prefabMap=new Map,this._showLoadingCount=0}var r=t.prototype;return r.init=function(){this._uiRoot=a("Canvas/uiContainer");for(var t=0;t<d.max;t++){var e=new o;e.name="layer"+(t+1);var n=e.addComponent(s);n.isAlignLeft=n.isAlignRight=n.isAlignTop=n.isAlignBottom=!0,n.top=n.bottom=n.left=n.right=0,this._uiRoot.addChild(e),this._layerList.push(e)}},r.showUI=function(){var t=n(i().mark((function t(e,n){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n=!1),r=this.getUI(e)){t.next=11;break}if(t.t0=n,!t.t0){t.next=7;break}return t.next=7,this.showLoading();case 7:return t.next=9,this.createUI(e);case 9:r=t.sent,n&&this.hideLoading();case 11:r.node.active?r.node.setSiblingIndex(1e4):r.onShow();case 12:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),r.OnMsg=function(t,e){var n=this.getUI(t);null!==n&&n.getComponent(t).OnMsg(e)},r.isShow=function(t){var e=this.getUI(t);return!!e&&e.node.active},r.closeUI=function(){var t=n(i().mark((function t(e,n){var r,a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n=!1),!(r=this.getUI(e))){t.next=6;break}return t.next=5,r.onHide(n);case 5:n&&((a=this._prefabMap.get(e.getUrl()))&&(a.decRef(),a=null,this._prefabMap.delete(e.getUrl())),this._uiNodeMap.delete(e.getUrl()));case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),r.getUI=function(t){return this._uiNodeMap.has(t.getUrl())?this._uiNodeMap.get(t.getUrl()):null},r.createUI=function(t){var e=this;return new Promise((function(n){u.load(t.getUrl(),c,(function(i,r){if(i)h(i);else if(!e.getUI(t)){var a=l(r);a.getComponent(p)||a.addComponent(p);var o=a.getComponent(t);o.node.active=!1,a.parent=e._layerList[o.layerType],e._uiNodeMap.set(t.getUrl(),o),e._prefabMap.set(t.getUrl(),r),r.addRef(),n(o)}}))}))},r.showLoading=function(){var t=n(i().mark((function t(){var e;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.getUI(f)){t.next=5;break}return t.next=4,this.createUI(f);case 4:e=t.sent;case 5:if(this._showLoadingCount++,!(this._showLoadingCount>1)){t.next=8;break}return t.abrupt("return");case 8:e.node.parent||(e.node.parent=this._layerList[e.layerType]),e.onShow();case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.hideLoading=function(t){if(void 0===t&&(t=!1),t&&(this._showLoadingCount=1),!(this._showLoadingCount<=0||(this._showLoadingCount--,this._showLoadingCount>0))){var e=this.getUI(f);e&&e.onHide()}},e(t,null,[{key:"ins",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=null,r._RF.pop()}}}));

System.register("chunks:///_virtual/UnitConfig.ts",["cc"],(function(i){"use strict";var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"950acxsik5H4plVf4jxMy0B","UnitConfig",void 0);i("UnitConfig",(function(){this.hp=void 0,this.attack=void 0,this.speed=void 0,this.attackSpeed=void 0,this.attackRange=void 0,this.damageRange=void 0,this.coinNum=void 0,this.intervalTime=void 0,this.averageCoinNum=void 0,this.powerValue=void 0})),i("UnitData",function(){function i(i){void 0===i&&(i=new Map),this.config=i}var t=i.prototype;return t.GetByLevel=function(i){return this.config.get(i)},t.Set=function(i,t){this.config.set(i,t)},i}());t._RF.pop()}}}));

System.register("chunks:///_virtual/Utils.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SmallestEnclosingCircle.ts"],(function(e){"use strict";var _,i,r,t,n,a,o,D;return{setters:[function(e){_=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){r=e.cclegacy,t=e.Vec2,n=e.resources,a=e.SpriteFrame},function(e){o=e.Point,D=e.SmallestEnclosingCircle}],execute:function(){r._RF.push({},"64be3piwsFCZZwH4goPvIuH","Utils",void 0),e("Utils",function(){function e(){}return e.getRandom=function(e,_){if(e>_){var i=e;e=_,_=i}return Math.round(e+Math.random()*(_-e))},e.ConvertIntToString=function(e){if(e<Math.pow(10,5))return e.toString();if(e<Math.pow(10,7)){var _=.001*e;return Math.round(_)+"k"}if(e<Math.pow(10,9)){var i=1e-6*e;return Math.round(i)+"m"}if(e<Math.pow(10,12)){var r=1e-9*e;return Math.round(r)+"b"}if(e<Math.pow(10,15)){var t=1e-12*e;return Math.round(t)+"t"}if(e<Math.pow(10,18)){var n=1e-15*e;return Math.round(n)+"q"}var a=1e-18*e;return Math.round(a)+"s"},e.randomSort=function(e){function _(e,_){return Math.random()>.5?-1:1}return e.sort(_),e},e.merge=function(e){for(var _=this,i=arguments.length,r=new Array(i>1?i-1:0),t=1;t<i;t++)r[t-1]=arguments[t];return r.reduce((function(e,i){return Object.keys(i).reduce((function(e,r){var t=i[r];return _.isObject(t)?e[r]=_.merge(e[r]?e[r]:{},t):_.isArray(t)?e[r]=t.map((function(i,t){if(_.isObject(i)){var n=e[r]?e[r]:[];return _.merge(n[t]?n[t]:{},i)}return i})):e[r]=t,e}),e)}),e)},e.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},e.isArray=function(e){return Array.isArray(e)},e.GetCenterPoint=function(e){this.tmpPoints.length=0;for(var _=e.length,i=0;i<_;i++){var r=e[i].position;this.tmpPoints.push(new o(r.x,r.y))}var n=D.MakeCircle(this.tmpPoints);return new t(n.c.x,n.c.y)},e.FormatTime_HH_MM_SS=function(e){var _=Math.floor(e/3600),i=_<10?"0"+_:_.toString(),r=Math.floor((e-3600*_)/60),t=r<10?"0"+r:r.toString(),n=Math.floor(e-3600*_-60*r);return i+":"+t+":"+(n<10?"0"+n:n.toString())},e}()).tmpPoints=[];e("UIUtils",function(){function e(){}return e.changeNodeLayer=function(e,_){e.layer=_,e.walk((function(e){}),(function(e){e.layer=_}))},e.GetSoldierSprite=function(){var e=_(i().mark((function e(_){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="",e.t0=_,e.next="sword"===e.t0?4:"hammer"===e.t0?6:"gun"===e.t0?8:"bow"===e.t0?10:"mage"===e.t0?12:"knight"===e.t0?14:"coin"===e.t0?16:"card"===e.t0?18:"Button_UIHome_Medal"===e.t0?20:"Jade"===e.t0?22:"Chequer"===e.t0?24:26;break;case 4:return r="Icon_UIGetSoldierPanel_Sword",e.abrupt("break",28);case 6:return r="Icon_UIGetSoldierPanel_Hatchet",e.abrupt("break",28);case 8:return r="Icon_UIGetSoldierPanel_Spear",e.abrupt("break",28);case 10:return r="Icon_UIGetSoldierPanel_Bow",e.abrupt("break",28);case 12:return r="Icon_UIGetSoldierPanel_Rod",e.abrupt("break",28);case 14:return r="Icon_UIGetSoldierPanel_Horse",e.abrupt("break",28);case 16:return r="Icon_UICommon_Gold_128",e.abrupt("break",28);case 18:return r="Icon_UIHome_Card",e.abrupt("break",28);case 20:return r="Button_UIHome_Medal",e.abrupt("break",28);case 22:return r="Icon_UICommon_Jade",e.abrupt("break",28);case 24:return r="Icon_UIHome_Chequer",e.abrupt("break",28);case 26:return r="Icon_UIGetSoldierPanel_Sword",e.abrupt("break",28);case 28:return e.abrupt("return",new Promise((function(e){n.load("imgs/"+r+"/spriteFrame",a,null,(function(_,i){e(i)}))})));case 29:case"end":return e.stop()}}),e)})));return function(_){return e.apply(this,arguments)}}(),e.GetSoldierDes=function(e){var _="";switch(e){case"sword":_=l.D_SoldierDes_Sword;break;case"hammer":_=l.D_SoldierDes_Axe;break;case"gun":_=l.D_SoldierDes_Spear;break;case"bow":_=l.D_SoldierDes_Archer;break;case"mage":_=l.D_SoldierDes_Mage;break;case"knight":_=l.D_SoldierDes_Paladin;break;default:_=l.D_SoldierDes_Sword}return _},e.getSoldierNameByType=function(e,_){void 0===_&&(_=!1);var i="",r="";switch(e){case"sword":i=l.D_SoldierName_Sword,r=l.D_SeniorSoldierName_Sword;break;case"hammer":i=l.D_SoldierName_Axe,r=l.D_SeniorSoldierName_Axe;break;case"gun":i=l.D_SoldierName_Spear,r=l.D_SeniorSoldierName_Spear;break;case"bow":i=l.D_SoldierName_Archer,r=l.D_SeniorSoldierName_Archer;break;case"mage":i=l.D_SoldierName_Mage,r=l.D_SeniorSoldierName_Mage;break;case"knight":i=l.D_SoldierName_Paladin,r=l.D_SeniorSoldierName_Paladin;break;default:i=l.D_SoldierName_Sword,r=l.D_SeniorSoldierName_Sword}return _?r:i},e}());var l=e("ScriptLocalization",(function(){}));l.D_Stage="D_Stage",l.D_SoldierName_Sword="D_SoldierName_Sword",l.D_SoldierName_Spear="D_SoldierName_Spear",l.D_SoldierName_Paladin="D_SoldierName_Paladin",l.D_SoldierName_Mage="D_SoldierName_Mage",l.D_SoldierName_Archer="D_SoldierName_Archer",l.D_SoldierDes_Sword="D_SoldierDes_Sword",l.D_SoldierDes_Spear="D_SoldierDes_Spear",l.D_SoldierDes_Paladin="D_SoldierDes_Paladin",l.D_SoldierDes_Mage="D_SoldierDes_Mage",l.D_SoldierDes_Axe="D_SoldierDes_Axe",l.D_SoldierDes_Archer="D_SoldierDes_Archer",l.D_NextRefreshTime="D_NextRefreshTime",l.D_SoldierName_Axe="D_SoldierName_Axe",l.D_Achievements_CombatFailure="D_Achievements_CombatFailure",l.D_Achievements_CommaderLevel="D_Achievements_CommaderLevel",l.D_Achievements_Compound="D_Achievements_Compound",l.D_Achievements_GridNum="D_Achievements_GridNum",l.D_Achievements_Kill="D_Achievements_Kill",l.D_Achievements_Level="D_Achievements_Level",l.D_Achievements_MaxLevel="D_Achievements_MaxLevel",l.D_Achievements_PerfectNum="D_Achievements_PerfectNum",l.D_Achievements_SoldiersBuy="D_Achievements_SoldiersBuy",l.D_AttributeConditions="D_AttributeConditions",l.D_AttributeDescribe="D_AttributeDescribe",l.D_AttributeName_ATKSpeed="D_AttributeName_ATKSpeed",l.D_AttributeName_ATT="D_AttributeName_ATT",l.D_AttributeName_HP="D_AttributeName_HP",l.D_Guide_Four="D_Guide_Four",l.D_Guide_One="D_Guide_One",l.D_Guide_Three="D_Guide_Three",l.D_Guide_Two="D_Guide_Two",l.D_Guide_Zero="D_Guide_Zero",l.D_AttributeName_Speed="D_AttributeName_Speed",l.D_Guide_Seven="D_Guide_Seven",l.D_Guide_Six="D_Guide_Six",l.D_Guide_Five="D_Guide_Five",l.D_Achievements_CoinNum="D_Achievements_CoinNum",l.D_FreeZoneInfo="D_FreeZoneInfo",l.D_Coin="D_Coin",l.D_LevelUp="D_LevelUp",l.D_Shop_Hint="D_Shop_Hint",l.D_Solider="D_Solider",l.D_Achievements_WatchVideo="D_Achievements_WatchVideo",l.D_tips_Attribute="D_tips_Attribute",l.D_tips_Achievements="D_tips_Achievements",l.D_Guide_eight="D_Guide_eight",l.Claim="Claim",l.D_Challenges_BOSSChallenge="D_Challenges_BOSSChallenge",l.D_Challenges_HeroChallenge="D_Challenges_HeroChallenge",l.D_Challenges_RaidChallenge="D_Challenges_RaidChallenge",l.D_FightingCapacity_FightingCapacity="D_FightingCapacity_FightingCapacity",l.D_FightingCapacity_RecommendedFightingCapacity="D_FightingCapacity_RecommendedFightingCapacity",l.D_Guide_Nine="D_Guide_Nine",l.D_Openlevel_Trailer="D_Openlevel_Trailer",l.ChallengeStage="ChallengeStage",l.D_M="D_M",l.D_Achievements_Special="D_Achievements_Special",l.D_AdButtonNextLevel="D_AdButtonNextLevel",l.D_settlement="D_settlement",l.D_settlement_Tips="D_settlement_Tips",l.D_special_hero="D_special_hero",l.D_BossInfo_FireMage="D_BossInfo_FireMage",l.D_BossInfo_Warrior="D_BossInfo_Warrior",l.D_BossInfo_Wizard="D_BossInfo_Wizard",l.D_Box_Coin="D_Box_Coin",l.D_Box_CoinBuff="D_Box_CoinBuff",l.D_FirstUfo="D_FirstUfo",l.D_HeroChallenge="D_HeroChallenge",l.D_Pay_Cancel="D_Pay_Cancel",l.D_Pay_Failure="D_Pay_Failure",l.D_RaidChallenge="D_RaidChallenge",l.D_Box_CoinTips="D_Box_CoinTips",l.D_Box_GiftBag="D_Box_GiftBag",l.D_Currency_Insufficient="D_Currency_Insufficient",l.D_Gird_Insufficient="D_Gird_Insufficient",l.D_Guide_eleven="D_Guide_eleven",l.D_Guide_fifteen="D_Guide_fifteen",l.D_Guide_fourteen="D_Guide_fourteen",l.D_Guide_ten="D_Guide_ten",l.D_Guide_thirteen="D_Guide_thirteen",l.D_Guide_twelve="D_Guide_twelve",l.D_ArcherSkill_Info="D_ArcherSkill_Info",l.D_ArcherSkill_Name="D_ArcherSkill_Name",l.D_AxeSkill_Info="D_AxeSkill_Info",l.D_AxeSkill_Name="D_AxeSkill_Name",l.D_MageSkill_Info="D_MageSkill_Info",l.D_MageSkill_Name="D_MageSkill_Name",l.D_PaladinSkill_Info="D_PaladinSkill_Info",l.D_PaladinSkill_Name="D_PaladinSkill_Name",l.D_SeniorSoldierName_Archer="D_SeniorSoldierName_Archer",l.D_SeniorSoldierName_Axe="D_SeniorSoldierName_Axe",l.D_SeniorSoldierName_Mage="D_SeniorSoldierName_Mage",l.D_SeniorSoldierName_Paladin="D_SeniorSoldierName_Paladin",l.D_SeniorSoldierName_Spear="D_SeniorSoldierName_Spear",l.D_SeniorSoldierName_Sword="D_SeniorSoldierName_Sword",l.D_SwordSkill_Info="D_SwordSkill_Info",l.D_SwordSkill_Name="D_SwordSkill_Name",l.D_SpearSkill_Info="D_SpearSkill_Info",l.D_SpearSkill_Name="D_SpearSkill_Name",l.Promotion_Tips="Promotion_Tips",l.D_Box_Promotioncard="D_Box_Promotioncard",l.D_Box_PromotioncardTips="D_Box_PromotioncardTips",l.D_Guide_sixteen="D_Guide_sixteen";var d=e("ScriptTerms",(function(){}));d.D_Stage="D_Stage",d.D_SoldierName_Sword="D_SoldierName_Sword",d.D_SoldierName_Spear="D_SoldierName_Spear",d.D_SoldierName_Paladin="D_SoldierName_Paladin",d.D_SoldierName_Mage="D_SoldierName_Mage",d.D_SoldierName_Archer="D_SoldierName_Archer",d.D_SoldierDes_Sword="D_SoldierDes_Sword",d.D_SoldierDes_Spear="D_SoldierDes_Spear",d.D_SoldierDes_Paladin="D_SoldierDes_Paladin",d.D_SoldierDes_Mage="D_SoldierDes_Mage",d.D_SoldierDes_Axe="D_SoldierDes_Axe",d.D_SoldierDes_Archer="D_SoldierDes_Archer",d.D_NextRefreshTime="D_NextRefreshTime",d.D_SoldierName_Axe="D_SoldierName_Axe",d.D_Achievements_CombatFailure="D_Achievements_CombatFailure",d.D_Achievements_CommaderLevel="D_Achievements_CommaderLevel",d.D_Achievements_Compound="D_Achievements_Compound",d.D_Achievements_GridNum="D_Achievements_GridNum",d.D_Achievements_Kill="D_Achievements_Kill",d.D_Achievements_Level="D_Achievements_Level",d.D_Achievements_MaxLevel="D_Achievements_MaxLevel",d.D_Achievements_PerfectNum="D_Achievements_PerfectNum",d.D_Achievements_SoldiersBuy="D_Achievements_SoldiersBuy",d.D_AttributeConditions="D_AttributeConditions",d.D_AttributeDescribe="D_AttributeDescribe",d.D_AttributeName_ATKSpeed="D_AttributeName_ATKSpeed",d.D_AttributeName_ATT="D_AttributeName_ATT",d.D_AttributeName_HP="D_AttributeName_HP",d.D_Guide_Four="D_Guide_Four",d.D_Guide_One="D_Guide_One",d.D_Guide_Three="D_Guide_Three",d.D_Guide_Two="D_Guide_Two",d.D_Guide_Zero="D_Guide_Zero",d.D_AttributeName_Speed="D_AttributeName_Speed",d.D_Guide_Seven="D_Guide_Seven",d.D_Guide_Six="D_Guide_Six",d.D_Guide_Five="D_Guide_Five",d.D_Achievements_CoinNum="D_Achievements_CoinNum",d.D_FreeZoneInfo="D_FreeZoneInfo",d.D_Coin="D_Coin",d.D_LevelUp="D_LevelUp",d.D_Shop_Hint="D_Shop_Hint",d.D_Solider="D_Solider",d.D_Achievements_WatchVideo="D_Achievements_WatchVideo",d.D_tips_Attribute="D_tips_Attribute",d.D_tips_Achievements="D_tips_Achievements",d.D_Guide_eight="D_Guide_eight",d.Claim="Claim",d.D_Challenges_BOSSChallenge="D_Challenges_BOSSChallenge",d.D_Challenges_HeroChallenge="D_Challenges_HeroChallenge",d.D_Challenges_RaidChallenge="D_Challenges_RaidChallenge",d.D_FightingCapacity_FightingCapacity="D_FightingCapacity_FightingCapacity",d.D_FightingCapacity_RecommendedFightingCapacity="D_FightingCapacity_RecommendedFightingCapacity",d.D_Guide_Nine="D_Guide_Nine",d.D_Openlevel_Trailer="D_Openlevel_Trailer",d.ChallengeStage="ChallengeStage",d.D_M="D_M",d.D_Achievements_Special="D_Achievements_Special",d.D_AdButtonNextLevel="D_AdButtonNextLevel",d.D_settlement="D_settlement",d.D_settlement_Tips="D_settlement_Tips",d.D_special_hero="D_special_hero",d.D_BossInfo_FireMage="D_BossInfo_FireMage",d.D_BossInfo_Warrior="D_BossInfo_Warrior",d.D_BossInfo_Wizard="D_BossInfo_Wizard",d.D_Box_Coin="D_Box_Coin",d.D_Box_CoinBuff="D_Box_CoinBuff",d.D_FirstUfo="D_FirstUfo",d.D_HeroChallenge="D_HeroChallenge",d.D_Pay_Cancel="D_Pay_Cancel",d.D_Pay_Failure="D_Pay_Failure",d.D_RaidChallenge="D_RaidChallenge",d.D_Box_CoinTips="D_Box_CoinTips",d.D_Box_GiftBag="D_Box_GiftBag",d.D_Currency_Insufficient="D_Currency_Insufficient",d.D_Gird_Insufficient="D_Gird_Insufficient",d.D_Guide_eleven="D_Guide_eleven",d.D_Guide_fifteen="D_Guide_fifteen",d.D_Guide_fourteen="D_Guide_fourteen",d.D_Guide_ten="D_Guide_ten",d.D_Guide_thirteen="D_Guide_thirteen",d.D_Guide_twelve="D_Guide_twelve",d.D_ArcherSkill_Info="D_ArcherSkill_Info",d.D_ArcherSkill_Name="D_ArcherSkill_Name",d.D_AxeSkill_Info="D_AxeSkill_Info",d.D_AxeSkill_Name="D_AxeSkill_Name",d.D_MageSkill_Info="D_MageSkill_Info",d.D_MageSkill_Name="D_MageSkill_Name",d.D_PaladinSkill_Info="D_PaladinSkill_Info",d.D_PaladinSkill_Name="D_PaladinSkill_Name",d.D_SeniorSoldierName_Archer="D_SeniorSoldierName_Archer",d.D_SeniorSoldierName_Axe="D_SeniorSoldierName_Axe",d.D_SeniorSoldierName_Mage="D_SeniorSoldierName_Mage",d.D_SeniorSoldierName_Paladin="D_SeniorSoldierName_Paladin",d.D_SeniorSoldierName_Spear="D_SeniorSoldierName_Spear",d.D_SeniorSoldierName_Sword="D_SeniorSoldierName_Sword",d.D_SwordSkill_Info="D_SwordSkill_Info",d.D_SwordSkill_Name="D_SwordSkill_Name",d.D_SpearSkill_Info="D_SpearSkill_Info",d.D_SpearSkill_Name="D_SpearSkill_Name",d.Promotion_Tips="Promotion_Tips",d.D_Box_Promotioncard="D_Box_Promotioncard",d.D_Box_PromotioncardTips="D_Box_PromotioncardTips",d.D_Guide_sixteen="D_Guide_sixteen",r._RF.pop()}}}));

System.register("chunks:///_virtual/WindowDataController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShopBuff.ts","./PlayerData.ts","./ReadTablesManager.ts","./TimeUtil.ts","./UIManager.ts","./ShopMainUI.ts","./PlayerFormationMgr.ts","./AdEvent.ts","./EventDispatcher.ts","./EventType.ts"],(function(t){"use strict";var e,i,a,s,n,o,r,l,d,h,c,u,D,y,m,T;return{setters:[function(t){e=t.createForOfIteratorHelperLoose,i=t.createClass},function(t){a=t.cclegacy,s=t._decorator,n=t.math},function(t){o=t.ShopItemData},function(t){r=t.PlayerData},function(t){l=t.ReadTablesManager},function(t){d=t.TimeUtil},function(t){h=t.default},function(t){c=t.default},function(t){u=t.PlayerFormationMgr},function(t){D=t.AdEventType,y=t.AdEvent},function(t){m=t.EventDispatcher},function(t){T=t.EventType}],execute:function(){t({ShopIdEnum:void 0,ShopType:void 0}),a._RF.push({},"5676c51Bt9CXYCfBZY7Wr1n","WindowDataController",void 0);var f,v;s.ccclass,s.property;!function(t){t[t.OneLevelCard=1]="OneLevelCard",t[t.TwoLevelCard=2]="TwoLevelCard",t[t.FreeCoin=3]="FreeCoin",t[t.DailySelect=4]="DailySelect",t[t.BuyCoin=5]="BuyCoin",t[t.BuySoldier=6]="BuySoldier",t[t.BuySoldierPlus=7]="BuySoldierPlus"}(f||(f=t("ShopIdEnum",{}))),function(t){t[t.Selection=1]="Selection",t[t.FreeRegion=2]="FreeRegion",t[t.RealMonyBuy=3]="RealMonyBuy",t[t.RareGoods=4]="RareGoods"}(v||(v=t("ShopType",{})));var C=t("IAPSettings",(function(){}));C.ProductId_coin="ProductId_coin",C.ProductId_magelv="ProductId_magelv",C.ProductId_paladinlv="ProductId_paladinlv",C.ProductId_gift="ProductId_gift",t("WindowDataController",function(){function t(){this.GoodID_TO_Flag=new Map([[5,C.ProductId_coin],[6,C.ProductId_magelv],[7,C.ProductId_paladinlv],[8,C.ProductId_gift]]),this.GoodID_TO_Price=new Map,this.CdTimes={},this.weights=new Map,this.daySelectData=null,this.randomCardData=[],this.RareGoodsData=[],this.GiftData=null,this.RareGoodList=[],this.DailySelectionDatas=[],this.currFreeData=null}var a=t.prototype;return a.init=function(){this.InitData(),0===r.ins.DailySelectionDatas.length?this.InitDailyViewData():this.DailySelectionDatas=r.ins.DailySelectionDatas,0==Object.keys(r.ins.DailyRefreshTime).length?this.IniFreeViewData():this.CdTimes=r.ins.DailyRefreshTime,this.InitRareGoodsList(),m.ins.addEventListener(T.AD_EVENT,this.Handler,this),m.ins.addEventListener(T.Main_Time,this.TimeRunning,this)},a.IniFreeViewData=function(){this.CdTimes={};var t=new o;t.startTime=d.GetNowTime(),t.state=0,t.CdTime=this.daySelectData.value5,t.gooodsType=this.daySelectData.goodsType,t.goodsInfo=this.daySelectData.goodsInfo,t.shopData=this.daySelectData,this.CdTimes[this.daySelectData.id]=t;for(var e=0;e<this.randomCardData.length;e++){var i=new o;i.state=1,i.CdTime=this.randomCardData[e].value5,i.level=this.randomCardData[e].value1,i.id=this.randomCardData[e].id,i.gooodsType=this.randomCardData[e].goodsType,i.goodsInfo=this.randomCardData[e].goodsInfo,i.shopData=this.randomCardData[e],this.CdTimes[this.randomCardData[e].id]=i}},a.InitData=function(){var t=[];this.randomCardData=l.ins.GetShopDataListByShopType(v.FreeRegion),(t=l.ins.GetShopDataListByShopType(v.Selection)).length>0&&(this.daySelectData=t[0]),this.RareGoodsData=l.ins.GetShopDataListByShopType(v.RareGoods),(t=l.ins.GetShopDataListByShopType(v.RealMonyBuy)).length>0&&(this.GiftData=t[0]);for(var e=this.daySelectData.value3,i=this.daySelectData.value4,a=0;a<e.length;a++)this.weights.set(e[a],i[a])},a.InitDailyViewData=function(){this.DailySelectionDatas.length=0;for(var t=0;t<this.daySelectData.value2;t++){var e=new o;e.type=this.GetRandomSoldier(),e.level=this.daySelectData.value1,e.order=t+1,e.state=1,this.DailySelectionDatas.push(e)}r.ins.DailySelectionDatas=this.DailySelectionDatas},a.InitRareGoodsList=function(){this.RareGoodList.length=0;for(var t=0;t<this.RareGoodsData.length;t++){var e=new o,i=this.RareGoodsData[t];e.id=i.id,e.shopData=i,this.RareGoodList.push(e)}},a.GetRandom=function(t){var i=0;t.forEach((function(t){i+=t}));for(var a,s=n.randomRangeInt(0,i),o=null,r=e(t);!(a=r()).done;){var l=a.value,d=l[0],h=l[1];if(s<=h){o=d;break}s-=h}return o},a.GetRandomSoldier=function(){return this.GetRandom(this.weights)},a.GetSelectionDataList=function(){return this.CdTimes},a.GetTimeStrByType=function(t){return d.GetTimeInterval(this.CdTimes[t].startTime,this.CdTimes[t].CdTime)},a.GetNowFreeCoinNum=function(t){void 0===t&&(t=1);var e=l.ins.GetNextCardData(0,r.ins.CardLevel).coinNum;return e=1==t?2*e+500:5*e>=2e4?5*e:2e4},a.RestartDailyView=function(){this.InitDailyViewData();var t=this.CdTimes[this.daySelectData.id];t.startTime=d.GetNowTime(),t.state=1,t.CdTime=this.daySelectData.value5,r.ins.DailyRefreshTime=this.CdTimes,h.ins.isShow(c)&&h.ins.OnMsg(c,"InitDailySelectionView")},a.RestartFreeCoinView=function(t){var e=this.CdTimes[t.id];e.startTime=d.GetNowTime(),e.state=1,r.ins.DailyRefreshTime=this.CdTimes,h.ins.isShow(c)&&h.ins.OnMsg(c,"IniFreeItemView")},a.Handler=function(t){if(t.eventType,D.CompleteAndClosed,t.eventType==D.CompleteAndClosed)if(r.ins.OnAdTimesChange(),h.ins.isShow(c),"daily1"==t.tag||"daily2"==t.tag||"daily3"==t.tag){var e="";"daily1"==t.tag?(this.DailySelectionDatas[0].state=0,e=this.DailySelectionDatas[0].type):"daily2"==t.tag?(this.DailySelectionDatas[1].state=0,e=this.DailySelectionDatas[1].type):"daily3"==t.tag&&(this.DailySelectionDatas[2].state=0,e=this.DailySelectionDatas[2].type),r.ins.DailySelectionDatas=this.DailySelectionDatas,h.ins.closeUI(c),console.log(e,this.daySelectData.value1,"this.daySelectData.value1"),u.ins.BuySoldier(e,this.daySelectData.value1);l.ins.GetNextCardData(0,r.ins.CardLevel).coinNum}else if("free"==t.tag){if(null==this.currFreeData)return;if(2==this.currFreeData.goodsInfo){h.ins.closeUI(c),m.ins.dispatchEvent(T.PLAY_COINBURST_EFFECT,this.GetNowFreeCoinNum());var i=this.CdTimes[this.currFreeData.id];i.startTime=d.GetNowTime(),i.state=0,r.ins.DailyRefreshTime=this.CdTimes}else{h.ins.closeUI(c);var a=this.GetRandom(this.weights);u.ins.BuySoldier(a,this.currFreeData.level);l.ins.GetNextCardData(0,r.ins.CardLevel).coinNum;var s=this.CdTimes[this.currFreeData.id];s.startTime=d.GetNowTime(),s.state=0,r.ins.DailyRefreshTime=this.CdTimes}}},a.FreeViewBtnClick=function(t){this.currFreeData=t;var e=new y;e.tag="free",e.eventType=D.CompleteAndClosed,t.id,m.ins.dispatchEvent(T.AD_EVENT,e)},a.countTime=function(){0==this.daySelectData.value5||d.GetTimeIntervalInt(this.CdTimes[f.DailySelect].startTime,this.CdTimes[f.DailySelect].CdTime)<=0&&this.RestartDailyView();for(var t in this.CdTimes){if(2==this.CdTimes[t].gooodsType)if(0!=this.CdTimes[t].CdTime)d.GetTimeIntervalInt(this.CdTimes[t].startTime,this.CdTimes[t].CdTime)<=0&&this.RestartFreeCoinView(this.CdTimes[t])}},a.TimeRunning=function(){this.countTime()},i(t,null,[{key:"ins",get:function(){return t._instance||(t._instance=new t),t._instance}}]),t}())._instance=null,a._RF.pop()}}}));
